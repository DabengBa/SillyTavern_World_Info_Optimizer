{
  "id": "0266db8e-add9-49c0-bfca-3b237bbb1eaf",
  "name": "世界书&正则管理器",
  "content": "var ue=\"regex-lore-hub-panel\",Je=\"regex-lore-hub-button\";var nt=\"\\u4E16\\u754C\\u4E66&\\u6B63\\u5219\\u7BA1\\u7406\\u5668\",Rt=\"\\u4E16\\u754C\\u4E66&\\u6B63\\u5219\\u7BA1\\u7406\\u5668\",it=\"rlh-close-btn\",er=\"rlh-search-input\",Er=\"rlh-refresh-btn\",Lr=\"rlh-core-toolbar\",Cr=\"rlh-replace-tool-container\";var br=\"rlh-replace-input\",mr=\"rlh-toggle-collapse-btn\",At=\"rlh-toggle-recursion-btn\",Mt=\"rlh-fix-keywords-btn\",fr=\"rlh-sort-menu\",rr=\"rlh-sort-menu-btn\",Qe=\"rlh-position-menu\",qe=\"rlh-position-menu-btn\",gr=\"rlh-unified-status-menu\",tr=\"rlh-unified-status-btn\",Ur=\"rlh-create-primary-btn\",Hr=\"rlh-character-book-switch\",Pr=\"rlh-prefetch-indicator\",zr=\"rlh-prefetch-progress-text\",Fr=\"rlh-prefetch-progress-bar\",We={TOOLBAR_SHELL:\"regex-lore-hub-toolbar-shell\",TOGGLE_TOOLBAR_BTN:\"regex-lore-hub-toggle-toolbar-btn\"},st=e=>!e||typeof e!=\"string\"?\"\":e.replace(/\\\\/g,\"/\").replace(/\\/+$/,\"\"),Mo=()=>{try{let e=new URL(\"./\",import.meta.url).href;return st(e)}catch(e){return console.warn(\"[RegexLoreHub] \\u65E0\\u6CD5\\u89E3\\u6790\\u811A\\u672C\\u6839\\u8DEF\\u5F84\\uFF1A\",e),\"\"}},Oo=()=>{try{let e=window.parent||window,r=e?.document;if(!r)return\"\";let o=r.querySelectorAll(\"script[src]\");for(let a of o){let l=a.getAttribute(\"src\");if(!(!l||!/regex[-_]lore[-_]hub/i.test(l)))try{let n=new URL(l,e.location?.href||window.location.href),i=st(n.href);if(!i)continue;let b=i.replace(/\\/[^/]*$/,\"\");if(b)return b}catch(n){console.warn(\"[RegexLoreHub] \\u5BBF\\u4E3B\\u811A\\u672C\\u6839\\u8DEF\\u5F84\\u89E3\\u6790\\u5931\\u8D25\\uFF1A\",n)}}}catch(e){console.warn(\"[RegexLoreHub] \\u65E0\\u6CD5\\u4ECE\\u5BBF\\u4E3B DOM \\u63A8\\u65AD\\u6839\\u8DEF\\u5F84\\uFF1A\",e)}return\"\"},lt=st(Oo())||Mo(),Do=[{id:\"constant\",label:\"\\u6C38\\u4E45\\u6FC0\\u6D3B\",shortLabel:\"\\u6C38\\u4E45\",description:\"\\u5FFD\\u7565\\u5173\\u952E\\u8BCD\\u9650\\u5236\\uFF0C\\u53EA\\u8981\\u6761\\u76EE\\u542F\\u7528\\u4E14\\u6EE1\\u8DB3\\u6982\\u7387\\u5C31\\u59CB\\u7EC8\\u5C1D\\u8BD5\\u6FC0\\u6D3B\\u3002\",strategyType:\"constant\",toastLabel:\"\\u6C38\\u4E45\\u6FC0\\u6D3B\",accentVar:\"--rlh-status-constant\",badgeClass:\"rlh-status-badge--constant\",order:0},{id:\"selective\",label:\"\\u5173\\u952E\\u8BCD\\u89E6\\u53D1\",shortLabel:\"\\u5173\\u952E\\u8BCD\",description:\"\\u5339\\u914D\\u4E3B\\u8981/\\u6B21\\u8981\\u5173\\u952E\\u8BCD\\u540E\\u6FC0\\u6D3B\\uFF0C\\u53EF\\u7ED3\\u5408\\u6982\\u7387\\u4E0E\\u626B\\u63CF\\u6DF1\\u5EA6\\u63A7\\u5236\\u89E6\\u53D1\\u3002\",strategyType:\"selective\",toastLabel:\"\\u5173\\u952E\\u8BCD\\u89E6\\u53D1\",accentVar:\"--rlh-status-selective\",badgeClass:\"rlh-status-badge--selective\",order:1},{id:\"vectorized\",label:\"\\u5411\\u91CF\\u5316\",shortLabel:\"\\u5411\\u91CF\",description:\"\\u4F9D\\u8D56\\u5411\\u91CF\\u76F8\\u4F3C\\u5EA6\\u6FC0\\u6D3B\\uFF0C\\u9002\\u7528\\u4E8E\\u8BED\\u4E49\\u53EC\\u56DE\\u573A\\u666F\\u3002\",strategyType:\"vectorized\",toastLabel:\"\\u5411\\u91CF\\u5316\",accentVar:\"--rlh-status-vectorized\",badgeClass:\"rlh-status-badge--vectorized\",order:2}],Ot=Do.map(e=>Object.freeze({...e,id:String(e.id).toLowerCase(),strategyType:String(e.strategyType??e.id).toLowerCase(),toastLabel:e.toastLabel??e.label,shortLabel:e.shortLabel??e.label})),at={};Ot.forEach(e=>{at[e.id]=e,at[e.strategyType]=e});var ct=Object.freeze(at),jr=Object.freeze([...Ot].sort((e,r)=>e.order-r.order)),Te=ct.constant,Wr=Te?.id??\"constant\",Tr=e=>{if(!e&&e!==0)return null;let r=String(e).trim().toLowerCase();return ct[r]?.id??null},Ge=e=>{let r=Tr(e);return r?ct[r]??null:null};var Ke={position:{before_character_definition:\"\\u89D2\\u8272\\u5B9A\\u4E49\\u524D\",after_character_definition:\"\\u89D2\\u8272\\u5B9A\\u4E49\\u540E\",before_example_messages:\"\\u804A\\u5929\\u793A\\u4F8B\\u524D\",after_example_messages:\"\\u804A\\u5929\\u793A\\u4F8B\\u540E\",before_author_note:\"\\u4F5C\\u8005\\u7B14\\u8BB0\\u524D\",after_author_note:\"\\u4F5C\\u8005\\u7B14\\u8BB0\\u540E\",at_depth_as_system:\"@D \\u2699 \\u7CFB\\u7EDF\",at_depth_as_assistant:\"@D \\u{1F5E8}\\uFE0F \\u89D2\\u8272\",at_depth_as_user:\"@D \\u{1F464} \\u7528\\u6237\"},logic:{and_any:\"\\u4EFB\\u4E00 AND\",and_all:\"\\u6240\\u6709 AND\",not_any:\"\\u4EFB\\u4E00 NOT\",not_all:\"\\u6240\\u6709 NOT\"}},xr={bookName:\"\\u4E66\\u540D\",entryName:\"\\u6761\\u76EE\\u540D\",keywords:\"\\u5173\\u952E\\u8BCD\",content:\"\\u5185\\u5BB9\"},dt={entryName:\"\\u540D\\u79F0\",content:\"\\u5185\\u5BB9\"},Dt={bookName:{id:\"rlh-filter-book-name\"},entryName:{id:\"rlh-filter-entry-name\"},keywords:{id:\"rlh-filter-keywords\"},content:{id:\"rlh-filter-content\"}},Bt={status:{value:\"status\",label:\"\\u6309\\u542F\\u7528\\u72B6\\u6001\"},name:{value:\"name\",label:\"\\u540D\\u79F0\\u6392\\u5E8F\"}},t={regexes:{global:[],character:[]},lorebooks:{character:[]},chatLorebook:null,allLorebooks:[],lorebookEntries:new Map,pendingLorebookUpdates:new Map,pendingRegexUpdates:new Set,lorebookUsage:new Map,activeTab:\"global-lore\",activeView:\"global-lore-list\",activeBookName:null,activeCharacterBook:null,charLoreInitialSynced:!1,pendingHighlightEntry:null,isDataLoaded:!1,isLoadingTabData:!1,loadingBookName:null,searchFilters:{bookName:!0,entryName:!0,keywords:!0,content:!0},multiSelectMode:!1,multiSelectTarget:\"book\",selectedItems:new Set,globalSearch:{term:\"\",replace:\"\"},searchFilterContextsInitialized:new Set,collapseStateByContext:new Map,sortModeByContext:new Map,characterContext:{name:null,id:null},saveStatus:\"idle\",saveRetryAttempt:0,isToolbarCollapsed:!0,isDragSortDisabled:!1,paths:{rlhRoot:lt,vendor:lt?`${lt}/vendor`:\"\"}},te=e=>{try{(!t.lorebookEntries||!(t.lorebookEntries instanceof Map))&&(console.warn(\"[RegexLoreHub] appState.lorebookEntries is not a Map, reinitializing...\"),t.lorebookEntries=new Map),typeof t.lorebookEntries.get!=\"function\"&&(console.warn(\"[RegexLoreHub] appState.lorebookEntries.get is not a function, reinitializing...\"),t.lorebookEntries=new Map);let r=t.lorebookEntries.get(e);return Array.isArray(r)?r:[]}catch(r){return console.error(\"[RegexLoreHub] Error in safeGetLorebookEntries:\",r),t.lorebookEntries=new Map,[]}},Ae=(e,r)=>{try{(!t.lorebookEntries||!(t.lorebookEntries instanceof Map))&&(console.warn(\"[RegexLoreHub] appState.lorebookEntries is not a Map, reinitializing...\"),t.lorebookEntries=new Map),typeof t.lorebookEntries.set!=\"function\"&&(console.warn(\"[RegexLoreHub] appState.lorebookEntries.set is not a function, reinitializing...\"),t.lorebookEntries=new Map),t.lorebookEntries.set(e,Array.isArray(r)?r:[])}catch(o){console.error(\"[RegexLoreHub] Error in safeSetLorebookEntries:\",o),t.lorebookEntries=new Map,t.lorebookEntries.set(e,Array.isArray(r)?r:[])}},Nr=e=>{try{if(!t.lorebookEntries||!(t.lorebookEntries instanceof Map)){console.warn(\"[RegexLoreHub] appState.lorebookEntries is not a Map, reinitializing...\"),t.lorebookEntries=new Map;return}if(typeof t.lorebookEntries.delete!=\"function\"){console.warn(\"[RegexLoreHub] appState.lorebookEntries.delete is not a function, reinitializing...\"),t.lorebookEntries=new Map;return}t.lorebookEntries.delete(e)}catch(r){console.error(\"[RegexLoreHub] Error in safeDeleteLorebookEntries:\",r),t.lorebookEntries=new Map}},ht=()=>{try{if(!t.lorebookEntries||!(t.lorebookEntries instanceof Map)){console.warn(\"[RegexLoreHub] appState.lorebookEntries is not a Map, reinitializing...\"),t.lorebookEntries=new Map;return}if(typeof t.lorebookEntries.clear!=\"function\"){console.warn(\"[RegexLoreHub] appState.lorebookEntries.clear is not a function, reinitializing...\"),t.lorebookEntries=new Map;return}t.lorebookEntries.clear()}catch(e){console.error(\"[RegexLoreHub] Error in safeClearLorebookEntries:\",e),t.lorebookEntries=new Map}},pt=e=>{try{return!t.lorebookEntries||!(t.lorebookEntries instanceof Map)?(console.warn(\"[RegexLoreHub] appState.lorebookEntries is not a Map, reinitializing...\"),t.lorebookEntries=new Map,!1):typeof t.lorebookEntries.has!=\"function\"?(console.warn(\"[RegexLoreHub] appState.lorebookEntries.has is not a function, reinitializing...\"),t.lorebookEntries=new Map,!1):t.lorebookEntries.has(e)}catch(r){return console.error(\"[RegexLoreHub] Error in safeHasLorebookEntries:\",r),t.lorebookEntries=new Map,!1}};function _e(){return window.parent||window}function be(){return _e().document}var D=e=>{if(typeof e!=\"string\")return String(e);let r=be().createElement(\"div\");return r.textContent=e,r.innerHTML},cr=(e,r)=>{if(!r||!e)return D(e);let o=D(e),a=D(r),l=new Set([\".\",\"*\",\"+\",\"?\",\"^\",\"$\",\"{\",\"}\",\"(\",\")\",\"|\",\"[\",\"]\",\"\\\\\\\\\"]),n=\"\";for(let b of a)n+=l.has(b)?\"\\\\\"+b:b;let i=new RegExp(`(${n})`,\"gi\");return o.replace(i,'<mark class=\"rlh-highlight\">$1</mark>')},me=(e,r=\"success\",o=2e3)=>{let a=ce(),l=be();if(!a||!l)return;let n=a(`#${ue}`,l);if(n.length===0)return;n.find(\".rlh-toast-notification\").remove();let i={success:\"fa-check-circle\",error:\"fa-times-circle\",info:\"fa-info-circle\"}[r],b=`\n    <div class=\"rlh-toast-notification ${r}\">\n      <i class=\"fa-solid ${i}\"></i> ${D(e)}\n    </div>\n  `,m=a(b);n.append(m),setTimeout(()=>m.addClass(\"visible\"),10),setTimeout(()=>{m.removeClass(\"visible\"),setTimeout(()=>m.remove(),300)},o)},or=(e=\"\\u6B63\\u5728\\u5904\\u7406...\")=>{let r=ce(),o=be();if(!r||!o)return{update:()=>{},remove:()=>{}};let a=r(`#${ue}`,o);if(a.length===0)return{update:()=>{},remove:()=>{}};a.find(\".rlh-progress-toast\").remove();let l=`<div class=\"rlh-progress-toast\"><i class=\"fa-solid fa-spinner fa-spin\"></i> <span class=\"rlh-progress-text\">${D(e)}</span></div>`,n=r(l);return a.append(n),setTimeout(()=>n.addClass(\"visible\"),10),{update:m=>{n.find(\".rlh-progress-text\").html(D(m))},remove:()=>{n.removeClass(\"visible\"),setTimeout(()=>n.remove(),300)}}},X=e=>{let r=ce(),o=be();return!r||!o?Promise.reject():new Promise((a,l)=>{let{type:n=\"alert\",title:i=\"\\u901A\\u77E5\",text:b=\"\",html:m=\"\",placeholder:u=\"\",value:h=\"\"}=e||{},f=\"\";n===\"alert\"?f='<button class=\"rlh-modal-btn rlh-modal-ok\">\\u786E\\u5B9A</button>':n===\"confirm\"?f='<button class=\"rlh-modal-btn rlh-modal-cancel\">\\u53D6\\u6D88</button><button class=\"rlh-modal-btn rlh-modal-ok\">\\u786E\\u8BA4</button>':n===\"prompt\"&&(f='<button class=\"rlh-modal-btn rlh-modal-cancel\">\\u53D6\\u6D88</button><button class=\"rlh-modal-btn rlh-modal-ok\">\\u786E\\u5B9A</button>');let w=n===\"prompt\"?`<input type=\"text\" class=\"rlh-modal-input\" placeholder=\"${D(u)}\" value=\"${D(h)}\">`:\"\",E=m||`<p>${D(b)}</p>`,S=`<div class=\"rlh-modal-overlay\"><div class=\"rlh-modal-content\"><div class=\"rlh-modal-header\">${D(i)}</div><div class=\"rlh-modal-body\">${E}${w}</div><div class=\"rlh-modal-footer\">${f}</div></div></div>`,x=r(S).hide(),N=r(`#${ue}`,o);N.length>0?N.append(x):r(\"body\",o).append(x),x.fadeIn(200);let s=x.find(\".rlh-modal-input\");n===\"prompt\"&&s.focus().select();let v=(k,A)=>{x.fadeOut(200,()=>{x.remove(),k?a(A):l()})};x.on(\"click\",\".rlh-modal-ok\",()=>{let k=n===\"prompt\"?s.val():!0;if(n===\"prompt\"&&!String(k).trim()){s.addClass(\"rlh-input-error\"),setTimeout(()=>s.removeClass(\"rlh-input-error\"),500);return}v(!0,k)}),x.on(\"click\",\".rlh-modal-cancel\",()=>v(!1)),n===\"prompt\"&&s.on(\"keydown\",k=>{k.key===\"Enter\"?x.find(\".rlh-modal-ok\").click():k.key===\"Escape\"&&x.find(\".rlh-modal-cancel\").click()})})},R=(e,r=\"RegexLoreHub\",o={})=>{let{notify:a=\"toast\",toastType:l=\"error\",toastDuration:n=4e3,toastMessage:i=\"\\u64CD\\u4F5C\\u53D1\\u751F\\u5F02\\u5E38\\uFF0C\\u8BF7\\u67E5\\u770B\\u63A7\\u5236\\u53F0\\u83B7\\u53D6\\u8BE6\\u7EC6\\u4FE1\\u606F\\u3002\",modalTitle:b=\"\\u811A\\u672C\\u5F02\\u5E38\",modalText:m=\"\\u64CD\\u4F5C\\u4E2D\\u53D1\\u751F\\u672A\\u77E5\\u9519\\u8BEF\\uFF0C\\u8BF7\\u68C0\\u67E5\\u5F00\\u53D1\\u8005\\u63A7\\u5236\\u53F0\\u83B7\\u53D6\\u8BE6\\u7EC6\\u4FE1\\u606F\\u3002\"}=o??{};return async(...u)=>{try{return await e(...u)}catch(h){if(!h)return;if(console.error(`[${r}] Error:`,h),a===\"modal\"){await X({type:\"alert\",title:b,text:m});return}a===\"toast\"&&me(i,l,n)}}};function ut(e,r){let o;return function(...a){let l=this;clearTimeout(o),o=setTimeout(()=>e.apply(l,a),r)}}var Ut=(e,r)=>{let o=e.replace(/[.*+?^${}()|[\\]\\/\\\\]/g,\"\\\\$&\"),a=r?\"g\":\"gi\";return new RegExp(o,a)},Ht={INSERT_RULES_TITLE:\"\\u63D2\\u5165\\u89C4\\u5219\"};var vr=e=>e.instanceKey||e.id||\"default\",dr=e=>{let r=vr(e);return t.collapseStateByContext.get(r)??\"expanded\"},Pt=(e,r)=>{let o=vr(e);t.collapseStateByContext.set(o,r)},lr=e=>{let r=Array.isArray(e.sortOptions)?e.sortOptions:[];if(!r.length)return null;let o=vr(e),a=t.sortModeByContext.get(o);if(a&&r.includes(a))return a;let l=r[0];return t.sortModeByContext.set(o,l),l},zt=(e,r)=>{if(!(e.sortOptions??[]).includes(r))return;let a=vr(e);t.sortModeByContext.set(a,r)},Rr=e=>D(String(e??\"\")),Kr=e=>Ge(e)??Te,Yr=(e,{shortLabel:r=!1,withIcon:o=!0}={})=>{let a=Kr(e),l=r?a.shortLabel:a.label,n=o?'<i class=\"fa-solid fa-circle\"></i>':\"\";return`<span class=\"rlh-status-badge ${a.badgeClass??\"\"}\" data-status-id=\"${Rr(a.id)}\">${n}<span class=\"rlh-status-badge__text\">${D(l)}</span></span>`},Bo=()=>jr.map(e=>{let r=Yr(e.id,{shortLabel:!0});return`<li role=\"presentation\"><button type=\"button\" class=\"rlh-unified-status-option\" data-status-id=\"${Rr(e.id)}\" role=\"option\" aria-selected=\"false\">${r}<span class=\"rlh-unified-status-option__label\">${D(e.label)}</span></button></li>`}).join(\"\"),Uo=(e,r)=>{let o=e.visibleFilters??[];if(!o.length)return\"\";let a=o.map(l=>{let n=Dt[l];if(!n)return\"\";let i=e.filterLabels?.[l]??xr[l]??l,b=r[l];return`<label class=\"rlh-filter-item\"><input type=\"checkbox\" id=\"${n.id}\" data-filter-key=\"${l}\" ${b?\"checked\":\"\"}>${i}</label>`}).filter(Boolean).join(\"\");return a?`<div class=\"rlh-filter-list\" id=\"rlh-search-filters-container\">${a}</div>`:\"\"},Ho=(e,r)=>{let o=Array.isArray(e.sortOptions)?e.sortOptions:[];if(!o.length)return\"\";let a=o.map(n=>{let i=Bt[n];if(!i)return\"\";let b=i.value===r;return`<li role=\"presentation\"><button type=\"button\" class=\"rlh-sort-option${b?\" active\":\"\"}\" data-sort-value=\"${i.value}\" role=\"option\" aria-selected=\"${b?\"true\":\"false\"}\">${i.label}</button></li>`}).filter(Boolean).join(\"\");if(!a)return\"\";let l=`${fr}-list`;return`<div class=\"rlh-sort-menu\" id=\"${fr}\" data-open=\"false\"><button type=\"button\" id=\"${rr}\" class=\"rlh-toolbar-btn\" data-current-sort=\"${r??\"\"}\" aria-haspopup=\"listbox\" aria-expanded=\"false\" aria-controls=\"${l}\"><i class=\"fa-solid fa-sort\"></i><span>\\u6392\\u5E8F</span></button><ul class=\"rlh-sort-menu-list\" id=\"${l}\" role=\"listbox\" aria-labelledby=\"${rr}\">${a}</ul></div>`},Po=e=>{if(!e.showPositionMenu)return\"\";let r=new Map;t.selectedItems.forEach(x=>{if(typeof x!=\"string\"||!x.startsWith(\"lore:\"))return;let N=x.lastIndexOf(\":\");if(N===-1)return;let s=x.slice(5,N),v=x.slice(N+1);v&&(r.has(s)||r.set(s,[]),r.get(s).push(v))});let o=e.activeBookName?.toString().trim()??\"\";!o&&r.size===1&&(o=[...r.keys()][0]??\"\");let a=o?te(o):[],l=a.length>0,n=t.multiSelectMode&&t.multiSelectTarget===\"entry\",i=o?r.get(o)??[]:[],b=!!o&&(n?i.length>0:l),m;o?!l&&!n?m=`\\u300C${o}\\u300D\\u6682\\u65E0\\u6761\\u76EE\\u53EF\\u8C03\\u6574`:n?m=i.length>0?`\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u5C06\\u5BF9\\u5DF2\\u9009\\u4E2D\\u7684 ${i.length} \\u4E2A\\u6761\\u76EE\\u7EDF\\u4E00\\u4F4D\\u7F6E`:\"\\u5DF2\\u5F00\\u542F\\u591A\\u9009\\uFF0C\\u8BF7\\u5148\\u52FE\\u9009\\u8981\\u8C03\\u6574\\u4F4D\\u7F6E\\u7684\\u6761\\u76EE\":m=`\\u5C06\\u5BF9\\u300C${o}\\u300D\\u4E2D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u7EDF\\u4E00\\u4F4D\\u7F6E`:m=r.size>0?\"\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u672A\\u80FD\\u8BC6\\u522B\\u9009\\u4E2D\\u7684\\u6761\\u76EE\\u5F52\\u5C5E\\uFF0C\\u8BF7\\u91CD\\u65B0\\u9009\\u62E9\":\"\\u8BF7\\u5148\\u6253\\u5F00\\u9700\\u8981\\u7EDF\\u4E00\\u4F4D\\u7F6E\\u7684\\u4E16\\u754C\\u4E66\";let u=new Set(a.map(x=>(x?.position??\"before_character_definition\").toString())),h=u.size===1?u.values().next().value:null,f=`${Qe}-list`,w=['type=\"button\"',`id=\"${qe}\"`,'class=\"rlh-toolbar-btn\"','aria-haspopup=\"listbox\"','aria-expanded=\"false\"',`aria-controls=\"${f}\"`,`title=\"${D(m)}\"`];b||w.push(\"disabled\"),o&&w.push(`data-book-name=\"${D(o)}\"`);let E=Object.entries(Ke.position).map(([x,N])=>{let s=l&&h===x,v=['type=\"button\"',`class=\"rlh-position-option${s?\" active\":\"\"}\"`,`data-position-value=\"${D(x)}\"`,'role=\"option\"',`aria-selected=\"${s?\"true\":\"false\"}\"`];return o&&v.push(`data-book-name=\"${D(o)}\"`),`<li role=\"presentation\"><button ${v.join(\" \")}>${D(N)}</button></li>`}).join(\"\"),S=['class=\"rlh-position-menu\"',`id=\"${Qe}\"`,'data-open=\"false\"'];return o&&S.push(`data-book-name=\"${D(o)}\"`),`<div ${S.join(\" \")}><button ${w.join(\" \")}><i class=\"fa-solid fa-map-pin\"></i><span>\\u7EDF\\u4E00\\u4F4D\\u7F6E</span></button><ul class=\"rlh-position-menu-list\" id=\"${f}\" role=\"listbox\" aria-labelledby=\"${qe}\">${E}</ul></div>`},Ft=(e,{$toolbar:r,$replaceContainer:o})=>{let a=dr(e),l=e.sortOptions?.length??0?lr(e):null,n=[\"rlh-toolbar-btn\"];t.multiSelectMode&&n.push(\"active\"),e.supportsMultiSelect||n.push(\"disabled\");let i=['type=\"button\"','id=\"rlh-multi-select-btn\"',`class=\"${n.join(\" \")}\"`,`data-target=\"${e.supportsMultiSelect?e.multiSelectTarget:\"\"}\"`];e.supportsMultiSelect||i.push(\"disabled\");let b=`<button ${i.join(\" \")}><i class=\"fa-solid fa-check-double\"></i><span>\\u591A\\u9009\\u6A21\\u5F0F</span></button>`,m=[\"rlh-multi-select-controls\"];t.multiSelectMode&&m.push(\"active\");let u=e.supportsMultiSelect?`\n        <div id=\"rlh-multi-select-controls\" class=\"${m.join(\" \")}\">\n          <div class=\"rlh-multi-select-actions\">\n            <button class=\"rlh-multi-select-action-btn\" id=\"rlh-select-all-btn\" title=\"\\u5168\\u9009\">\\u5168</button>\n            <button class=\"rlh-multi-select-action-btn\" id=\"rlh-select-none-btn\" title=\"\\u6E05\\u9664\">\\u6E05</button>\n            <button class=\"rlh-multi-select-action-btn\" id=\"rlh-select-invert-btn\" title=\"\\u53CD\\u9009\">\\u53CD</button>\n            <button class=\"rlh-multi-select-action-btn enable\" id=\"rlh-batch-enable-btn\" title=\"\\u542F\\u7528\">\\u5F00</button>\n            <button class=\"rlh-multi-select-action-btn disable\" id=\"rlh-batch-disable-btn\" title=\"\\u7981\\u7528\">\\u5173</button>\n            <button class=\"rlh-multi-select-action-btn disable\" id=\"rlh-batch-delete-btn\" title=\"\\u5220\\u9664\">\\u5220</button>\n          </div>\n          <span class=\"rlh-selection-count\" id=\"rlh-selection-count\">\\u5DF2\\u9009\\u62E9: ${t.selectedItems.size}</span>\n        </div>\n      `:\"\",h=`\n        <div class=\"rlh-multi-select-module\">\n          ${b}\n          ${u}\n        </div>\n      `,f=e.supportsMultiSelect&&e.multiSelectTarget===\"entry\"?(()=>{let y=`${gr}`,_=`${gr}-list`,z=Bo(),I=[\"rlh-unified-status\"];t.multiSelectMode&&I.push(\"is-multiselect\");let O=new Map;t.selectedItems.forEach(Se=>{if(typeof Se!=\"string\"||!Se.startsWith(\"lore:\"))return;let Be=Se.lastIndexOf(\":\");if(Be===-1)return;let ye=Se.slice(5,Be),Ye=Se.slice(Be+1);Ye&&(O.has(ye)||O.set(ye,[]),O.get(ye).push(Ye))});let F=[e.activeBookName,t.activeBookName,t.activeCharacterBook,t.chatLorebook].find(Se=>typeof Se==\"string\"&&Se.trim().length>0)?.toString().trim()??\"\";!F&&O.size===1&&(F=[...O.keys()][0]??\"\");let ee=(F?te(F):[]).length>0,pe=t.multiSelectMode&&t.multiSelectTarget===\"entry\",fe=F?O.get(F)??[]:[],ve=Array.from(O.values()).reduce((Se,Be)=>Se+(Array.isArray(Be)?Be.length:0),0),Ie=!!F&&(pe?fe.length>0:ee),Fe;return F?!ee&&!pe?Fe=`\\u300C${F}\\u300D\\u6682\\u65E0\\u6761\\u76EE\\u53EF\\u8C03\\u6574`:pe?Fe=fe.length>0?`\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u5C06\\u5BF9\\u5DF2\\u9009\\u4E2D\\u7684 ${fe.length} \\u4E2A\\u6761\\u76EE\\u7EDF\\u4E00\\u72B6\\u6001`:\"\\u5DF2\\u5F00\\u542F\\u591A\\u9009\\uFF0C\\u8BF7\\u5148\\u52FE\\u9009\\u8981\\u8C03\\u6574\\u72B6\\u6001\\u7684\\u6761\\u76EE\":Fe=`\\u5C06\\u5BF9\\u300C${F||\"\\u5F53\\u524D\\u4E16\\u754C\\u4E66\"}\\u300D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u7EDF\\u4E00\\u72B6\\u6001`:Fe=O.size>0?\"\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u672A\\u80FD\\u8BC6\\u522B\\u9009\\u4E2D\\u7684\\u6761\\u76EE\\u5F52\\u5C5E\\uFF0C\\u8BF7\\u91CD\\u65B0\\u9009\\u62E9\":\"\\u8BF7\\u5148\\u6253\\u5F00\\u9700\\u8981\\u7EDF\\u4E00\\u72B6\\u6001\\u7684\\u4E16\\u754C\\u4E66\",`\n            <div class=\"${I.join(\" \")}\" id=\"${y}\" data-open=\"false\">\n              <button type=\"button\" id=\"${tr}\" class=\"rlh-toolbar-btn\" aria-haspopup=\"listbox\" aria-expanded=\"false\" aria-controls=\"${_}\" ${Ie?\"\":\"disabled\"} title=\"${D(Fe)}\">\n                <i class=\"fa-solid fa-layer-group\"></i><span>\\u7EDF\\u4E00\\u72B6\\u6001</span>\n              </button>\n              <ul class=\"rlh-unified-status-menu\" id=\"${_}\" role=\"listbox\">\n                ${z}\n              </ul>\n            </div>\n          `})():\"\",w=\"\";e.showCollapseToggle&&(w=`<button type=\"button\" id=\"${mr}\" class=\"rlh-toolbar-btn\" data-collapse-state=\"${a}\"><i class=\"fa-solid ${a===\"collapsed\"?\"fa-expand-arrows-alt\":\"fa-compress-arrows-alt\"}\"></i><span>${a===\"collapsed\"?\"\\u5168\\u90E8\\u5C55\\u5F00\":\"\\u5168\\u90E8\\u6298\\u53E0\"}</span></button>`);let E=e.showRecursion?(()=>{let y=e.activeBookName??\"\",_=['type=\"button\"',`id=\"${At}\"`,'class=\"rlh-toolbar-btn rlh-batch-recursion-btn\"'];return y?_.push(`data-book-name=\"${D(y)}\"`):_.push(\"disabled\"),`<button ${_.join(\" \")}><i class=\"fa-solid fa-shield-halved\"></i><span>\\u5168\\u5F00\\u9632\\u9012\\u5F52</span></button>`})():\"\",S=e.showFixKeywords?(()=>{let y=e.activeBookName??\"\",_=['type=\"button\"',`id=\"${Mt}\"`,'class=\"rlh-toolbar-btn rlh-fix-keywords-btn\"'];return y?_.push(`data-book-name=\"${D(y)}\"`):_.push(\"disabled\"),`<button ${_.join(\" \")}><i class=\"fa-solid fa-check-double\"></i><span>\\u4FEE\\u590D\\u5173\\u952E\\u8BCD</span></button>`})():\"\",x=Po(e),N=Ho(e,l),s=Uo(e,t.searchFilters),v=D(e.scopeLabel),k=D(e.searchPlaceholder),A=Rr(t.globalSearch.term??\"\"),J=`<div class=\"rlh-search-row\">${`<label class=\"rlh-search-field\">\n          <input type=\"search\" id=\"${er}\" class=\"rlh-search-input\" placeholder=\"${k}\" value=\"${A}\" autocomplete=\"off\" />\n        </label>`}<button type=\"button\" id=\"rlh-search-clear-btn\" class=\"rlh-toolbar-icon-btn\" title=\"\\u6E05\\u7A7A\"><i class=\"fa-solid fa-eraser\"></i></button></div>`,de=Rr(t.globalSearch.replace??\"\"),H=e.showReplace?`<div class=\"rlh-replace-body\"><input type=\"text\" id=\"${br}\" class=\"rlh-replace-input\" placeholder=\"\\u66FF\\u6362\\u4E3A...\" value=\"${de}\" /><button type=\"button\" id=\"rlh-replace-btn\" class=\"rlh-toolbar-icon-btn rlh-replace-action\" title=\"\\u66FF\\u6362\"><i class=\"fa-solid fa-repeat\"></i></button></div>`:\"\",V=`<div class=\"rlh-search-meta\">\n          ${s}\n          <span class=\"rlh-search-scope\">${v}</span>\n        </div>`,B=`<div class=\"rlh-search-box\">${J}${H}${V}</div>`,Q=\"\";if(e.primaryAction?.visible&&e.primaryAction.scope===\"entry\"){let y=e.activeBookName??\"\",_=!y,z=[\"rlh-toolbar-btn\",\"rlh-create-entry-btn\"];_&&z.push(\"disabled\");let I=['type=\"button\"',`class=\"${z.join(\" \")}\"`],O=e.primaryAction.title??e.primaryAction.label??\"\";O&&I.push(`title=\"${D(O)}\"`),_?I.push(\"disabled\"):I.push(`data-book-name=\"${D(y)}\"`);let K=e.primaryAction.icon?e.primaryAction.icon:\"fa-file-circle-plus\",F=D(e.primaryAction.label??\"\\u65B0\\u5EFA\\u6761\\u76EE\");Q=`<button ${I.join(\" \")}><i class=\"fa-solid ${K}\"></i><span>${F}</span></button>`}let he=\"\";if(e.primaryAction?.visible&&e.primaryAction.scope===\"book\"){let _=['type=\"button\"','id=\"regex-lore-hub-create-lorebook-btn\"',`class=\"${[\"rlh-toolbar-btn\",\"rlh-create-book-btn\"].join(\" \")}\"`],z=e.primaryAction.title??e.primaryAction.label??\"\";z&&_.push(`title=\"${D(z)}\"`);let I=e.primaryAction.icon?e.primaryAction.icon:\"fa-plus\",O=D(e.primaryAction.label??\"\\u65B0\\u5EFA\\u4E16\\u754C\\u4E66\");he=`<button ${_.join(\" \")}><i class=\"fa-solid ${I}\"></i><span>${O}</span></button>`}let ae=`\n    <div class=\"rlh-toolbar-section rlh-toolbar-section--search\">\n      <div class=\"rlh-search-section-grid\">\n        <div class=\"rlh-search-section-main\">\n          ${B}\n        </div>\n        <div class=\"rlh-search-section-multiselect\">\n          ${h}\n        </div>\n      </div>\n    </div>\n  `,se=[he,Q,e.showCollapseToggle?w:\"\",E,S,f,x,N].filter(Boolean),re=se.length?`\n        <div class=\"rlh-toolbar-section rlh-toolbar-section--actions\">\n          <div class=\"rlh-toolbar-actions\">\n            ${se.join(\"\")}\n          </div>\n        </div>\n      `:\"\",g=`\n    <div class=\"rlh-toolbar-inner\">\n      ${[ae,re].filter(Boolean).join(\"\")}\n    </div>\n\n  `;if(r.html(g),e.supportsMultiSelect&&e.multiSelectTarget===\"entry\"){let _=[e.activeBookName,t.activeBookName,t.activeCharacterBook,t.chatLorebook].find(pe=>typeof pe==\"string\"&&pe.trim().length>0)?.toString().trim()??\"\",z=_?te(_):[],I=z.length>0,O=t.multiSelectMode&&t.multiSelectTarget===\"entry\",K=O&&z.length>0&&[...t.selectedItems].some(pe=>pe.startsWith(`lore:${_}:`)),F=I&&(!O||K),q=I?O?K?\"\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u4EC5\\u5BF9\\u9009\\u4E2D\\u7684\\u6761\\u76EE\\u7EDF\\u4E00\\u72B6\\u6001\":\"\\u5DF2\\u5F00\\u542F\\u591A\\u9009\\uFF0C\\u8BF7\\u5148\\u52FE\\u9009\\u8981\\u8C03\\u6574\\u72B6\\u6001\\u7684\\u6761\\u76EE\":`\\u5C06\\u5BF9\\u300C${_||\"\\u5F53\\u524D\\u4E16\\u754C\\u4E66\"}\\u300D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u7EDF\\u4E00\\u72B6\\u6001`:_?`\\u300C${_}\\u300D\\u6682\\u65E0\\u6761\\u76EE\\u53EF\\u8C03\\u6574`:\"\\u8BF7\\u5148\\u6253\\u5F00\\u9700\\u8981\\u7EDF\\u4E00\\u72B6\\u6001\\u7684\\u4E16\\u754C\\u4E66\",ee=$(`#${tr}`,r);ee.length&&(ee.attr(\"title\",q),F?ee.removeAttr(\"disabled\"):ee.attr(\"disabled\",\"disabled\"))}o.empty()},Ar=(e,r)=>{let o=r.toLowerCase();return!!(!o||t.searchFilters.entryName&&(e.name||\"\").toLowerCase().includes(o)||t.searchFilters.keywords&&e.keys.join(\" \").toLowerCase().includes(o)||t.searchFilters.content&&e.content&&e.content.toLowerCase().includes(o))},jt=(e,r)=>{let o=r.toLowerCase();return!!(t.searchFilters.entryName&&(e.script_name||\"\").toLowerCase().includes(o)||t.searchFilters.content&&(e.find_regex||\"\").toLowerCase().includes(o)||t.searchFilters.content&&(e.replace_string||\"\").toLowerCase().includes(o))},Wt=(e,r,o,a)=>{let l=ce(),n=t.lorebookUsage.get(e.name)||[],i=n.length>0?`<div class=\"rlh-used-by-chars\">\\u4F7F\\u7528\\u8005: ${n.map(s=>`<span>${D(s)}</span>`).join(\", \")}</div>`:\"\",b=cr(e.name,r),m=t.multiSelectMode&&t.multiSelectTarget===\"book\",u=`book:${e.name}`,h=m&&t.selectedItems.has(u),f=m?`<label class=\"rlh-selection-control\"><input type=\"checkbox\" class=\"rlh-multi-select-checkbox\" data-select-key=\"${D(u)}\" ${h?\"checked\":\"\"}></label>`:\"\",w=l(`\n      <div class=\"rlh-book-group\" data-book-name=\"${D(e.name)}\" data-select-key=\"${D(u)}\">\n          <div class=\"rlh-global-book-header rlh-clickable-header\">\n              ${f}\n              <div class=\"rlh-book-title-wrapper\">\n                  <span class=\"rlh-item-name\">${b}</span>\n                  <div class=\"rlh-book-stats\">\\u6761\\u76EE: ${e.enabledEntryCount} / ${e.entryCount}</div>\n              </div>\n              <div class=\"rlh-item-controls\">\n                  <button class=\"rlh-action-btn-icon rlh-rename-book-btn\" title=\"\\u91CD\\u547D\\u540D\\u4E16\\u754C\\u4E66\"><i class=\"fa-solid fa-pen-to-square\"></i></button>\n                  <button class=\"rlh-toggle-btn rlh-global-toggle\" title=\"\\u542F\\u7528/\\u7981\\u7528\\u6574\\u4E2A\\u4E16\\u754C\\u4E66\"><i class=\"fa-solid fa-power-off\"></i></button>\n                  <button class=\"rlh-action-btn-icon rlh-delete-book-btn\" title=\"\\u5220\\u9664\\u4E16\\u754C\\u4E66\"><i class=\"fa-solid fa-folder-minus\"></i></button>\n              </div>\n          </div>\n          ${n.length>0?`<div class=\"rlh-book-summary\">${i}</div>`:\"\"}\n          <div class=\"rlh-collapsible-content\"></div>\n      </div>\n    `);w.toggleClass(\"enabled\",e.enabled),w.find(\".rlh-global-book-header\").toggleClass(\"enabled\",e.enabled),w.toggleClass(\"selected\",h);let E=w.find(\".rlh-collapsible-content\"),S=l(`<div class=\"rlh-entry-actions\"><button class=\"rlh-action-btn rlh-create-entry-btn\" data-book-name=\"${D(e.name)}\"><i class=\"fa-solid fa-plus\"></i> \\u65B0\\u5EFA\\u6761\\u76EE</button><button class=\"rlh-action-btn rlh-batch-recursion-btn\" data-book-name=\"${D(e.name)}\"><i class=\"fa-solid fa-shield-halved\"></i> \\u5168\\u5F00\\u9632\\u9012\\u5F52</button><button class=\"rlh-action-btn rlh-fix-keywords-btn\" data-book-name=\"${D(e.name)}\"><i class=\"fa-solid fa-check-double\"></i> \\u4FEE\\u590D\\u5173\\u952E\\u8BCD</button></div>`);E.append(S);let x=[...te(e.name)].sort((s,v)=>(s.display_index??Number.MAX_SAFE_INTEGER)-(v.display_index??Number.MAX_SAFE_INTEGER)),N=o?x:a||[];if(N&&N.length>0){let s=l('<div class=\"rlh-entry-list-wrapper\"></div>');N.forEach(v=>s.append(ar(v,\"lore\",e.name,r,{enableDrag:!1}))),E.append(s)}else r&&E.append('<div class=\"rlh-info-text-small\">\\u65E0\\u5339\\u914D\\u9879</div>');return w},Gr=e=>typeof e==\"string\"?e.replace(/\\r?\\n/g,\"<br>\"):e,Ir=e=>`<span class=\"rlh-viewer-empty\">${D(e)}</span>`,Vr=(e,r)=>{let o=Kr(e?.statusId),a=Yr(o.id),n=(Array.isArray(e?.keys)?e.keys:[]).join(\", \"),i=n?Gr(r?cr(n,r):D(n)):Ir(\"\\u6682\\u65E0\\u5173\\u952E\\u8BCD\"),b=e?.content??\"\",m=b?Gr(r?cr(b,r):D(b)):Ir(\"\\u6682\\u65E0\\u5185\\u5BB9\"),u=B=>B!=null&&B!==\"\",h=(B,Q=\"\\u672A\\u8BBE\\u7F6E\")=>u(B)?D(String(B)):Ir(Q),f=B=>{if(!B)return\"\";let{label:Q,value:he,placeholder:ae,html:se}=B,re=se!==void 0?se:h(he,ae);return`\n      <div class=\"rlh-editor-field rlh-viewer-field\">\n        <label>${Q}</label>\n        <div class=\"rlh-viewer-text\">${re}</div>\n      </div>\n    `},w=(B,Q,he={})=>{if(!Q.length)return\"\";let ae=he.layout??\"grid\",se=B?`<h5>${B}</h5>`:\"\",re=\"\";return ae===\"grid\"?re=`\n        <div class=\"rlh-editor-grid\">${Q.map(g=>`\n          <div class=\"rlh-grid-item\">${f(g)}</div>`).join(\"\")}\n        </div>\n      `:re=Q.map(f).join(\"\"),`\n      <div class=\"rlh-editor-group rlh-viewer-group\">\n        ${se}\n        ${re}\n      </div>\n    `},E=(()=>{let B=e?.position;return u(B)?typeof B==\"object\"&&B!==null&&typeof B.type==\"string\"&&B.type?Ke.position?.[B.type]??B.type:typeof B==\"string\"?Ke.position?.[B]??B:null:null})(),S=u(e?.depth)?e.depth:null,x=u(e?.order)?e.order:null,N=u(e?.logic),s=N?e.logic:\"and_any\",v=Ke.logic?.[s]??s,k=N?v:`${v} (\\u9ED8\\u8BA4)`,A=u(e?.probability)?`${e.probability}%`:\"100% (\\u9ED8\\u8BA4)\",M=f({label:\"\\u5173\\u952E\\u8BCD\",html:i}),T=f({label:\"\\u5185\\u5BB9\",html:`<article class=\"rlh:prose rlh:dark:rlh:prose-invert max-w-none\">${m}</article>`}),J=w(Ht.INSERT_RULES_TITLE,[{label:\"\\u4F4D\\u7F6E\",value:E,placeholder:\"\\u672A\\u8BBE\\u7F6E\"},{label:\"\\u6DF1\\u5EA6\",value:S,placeholder:\"\\u672A\\u8BBE\\u7F6E\"},{label:\"\\u987A\\u5E8F\",value:x,placeholder:\"\\u672A\\u8BBE\\u7F6E\"}],{layout:\"grid\"}),de=w(\"\\u6FC0\\u6D3B\\u903B\\u8F91\",[{label:\"\\u6982\\u7387\",value:A,placeholder:\"100% (\\u9ED8\\u8BA4)\"},{label:\"\\u5173\\u952E\\u8BCD\\u903B\\u8F91\",value:k,placeholder:\"\\u4EFB\\u4E00 AND (\\u9ED8\\u8BA4)\"}],{layout:\"grid\"}),H=w(\"\\u5339\\u914D\\u4E0E\\u9012\\u5F52\",[{label:\"\\u5927\\u5C0F\\u5199\\u654F\\u611F\",value:e?.case_sensitive?\"\\u5F00\\u542F\":\"\\u5173\\u95ED\",placeholder:\"\\u5173\\u95ED\"},{label:\"\\u5168\\u8BCD\\u5339\\u914D\",value:e?.match_whole_words?\"\\u5F00\\u542F\":\"\\u5173\\u95ED\",placeholder:\"\\u5173\\u95ED\"},{label:\"\\u9632\\u6B62\\u9012\\u5F52\",value:e?.prevent_recursion?\"\\u5F00\\u542F\":\"\\u5173\\u95ED\",placeholder:\"\\u5173\\u95ED\"},{label:\"\\u4E0D\\u53EF\\u88AB\\u9012\\u5F52\",value:e?.exclude_recursion?\"\\u5F00\\u542F\":\"\\u5173\\u95ED\",placeholder:\"\\u5173\\u95ED\"}],{layout:\"grid\"});return`\n    <div class=\"rlh-entry-viewer\" data-mode=\"view\">\n      ${w(\"\\u72B6\\u6001\",[{label:\"\\u5F53\\u524D\\u72B6\\u6001\",html:a}],{layout:\"grid\"})}\n      ${M}\n      ${T}\n      ${J}\n      ${de}\n      ${H}\n    </div>\n  `},bt=(e,r)=>{let o=e?.find_regex??\"\",a=e?.replace_string??\"\",l=typeof r==\"string\"?r:\"\",n=o?Gr(l?cr(o,l):D(o)):Ir(\"\\u6682\\u65E0\\u67E5\\u627E\\u6B63\\u5219\"),i=a?Gr(l?cr(a,l):D(a)):Ir(\"\\u6682\\u65E0\\u66FF\\u6362\\u5185\\u5BB9\"),b=e?.destination??{},m=e?.source??{},u=e?.min_depth,h=e?.max_depth,f=[];b.display&&f.push(\"\\u4EC5\\u683C\\u5F0F\\u663E\\u793A\"),b.prompt&&f.push(\"\\u4EC5\\u683C\\u5F0F\\u63D0\\u793A\\u8BCD\");let w=f.length?f.join(\" / \"):\"\\u683C\\u5F0F\\u4E0E\\u63D0\\u793A\\u8BCD\",S=Object.entries({user_input:\"\\u7528\\u6237\\u8F93\\u5165\",ai_output:\"AI\\u8F93\\u51FA\",slash_command:\"\\u659C\\u6760\\u547D\\u4EE4\",world_info:\"\\u4E16\\u754C\\u4E66\"}).filter(([M])=>!!m?.[M]).map(([,M])=>M),x=S.length===0?\"\\u672A\\u9009\\u62E9\\u4F5C\\u7528\\u8303\\u56F4\":S.length===4?\"\\u5168\\u90E8\\u6765\\u6E90\":S.join(\" / \"),N=u!=null&&u!==\"\",s=h!=null&&h!==\"\",v=\"\\u65E0\\u6DF1\\u5EA6\\u9650\\u5236\";N&&s?v=`${u} - ${h}`:N?v=`>= ${u}`:s&&(v=`<= ${h}`);let A=[{label:\"\\u8F93\\u51FA\\u8BBE\\u7F6E\",value:w},{label:\"\\u4F5C\\u7528\\u8303\\u56F4\",value:x},{label:\"\\u6DF1\\u5EA6\\u8303\\u56F4\",value:v}].map(M=>`\n      <div class=\"rlh-editor-field rlh-viewer-field\">\n        <label>${M.label}</label>\n        <div class=\"rlh-viewer-text\">${D(String(M.value??\"\"))}</div>\n      </div>\n    `).join(\"\");return`\n    <div class=\"rlh-regex-viewer\" data-mode=\"view\">\n      <div class=\"rlh-editor-field rlh-viewer-field\">\n        <label>\\u67E5\\u627E\\u6B63\\u5219\\u8868\\u8FBE\\u5F0F</label>\n        <article class=\"rlh:prose rlh:dark:rlh:prose-invert max-w-none\">${n}</article>\n      </div>\n      <div class=\"rlh-editor-field rlh-viewer-field\">\n        <label>\\u66FF\\u6362\\u4E3A</label>\n        <article class=\"rlh:prose rlh:dark:rlh:prose-invert max-w-none\">${i}</article>\n      </div>\n      ${A}\n    </div>\n  `},ar=(e,r,o=\"\",a=\"\",l={})=>{let n=ce(),i=r===\"lore\",b=i?e.uid:e.id,m=i?e.name||\"\\u65E0\\u6807\\u9898\\u6761\\u76EE\":e.script_name||\"\\u672A\\u547D\\u540D\\u6B63\\u5219\",u=e.source===\"card\",h=l.collapseState??\"expanded\",f=l.isExpanded??!1,E=(l.enableDrag??!0)&&!u,S=E&&t.isDragSortDisabled,x=S?\"\\u62D6\\u62FD\\u529F\\u80FD\\u4E0D\\u53EF\\u7528\\uFF1A\\u6392\\u5E8F\\u811A\\u672C\\u672A\\u52A0\\u8F7D\":\"\\u62D6\\u62FD\\u6392\\u5E8F\",N=S?' data-disabled=\"true\" aria-disabled=\"true\" style=\"cursor: not-allowed; opacity: 0.6;\"':\"\",s=E?`<span class=\"rlh-drag-handle${S?\" rlh-drag-handle--disabled\":\"\"}\" title=\"${D(x)}\"${N}><i class=\"fa-solid fa-grip-vertical\"></i></span>`:\"\",v=l.selectionKey??(i?`lore:${o}:${b}`:`regex:${b}`),k=t.multiSelectTarget,A=t.multiSelectMode&&(k===\"entry\"&&i||k===\"regex\"&&!i),M=A&&t.selectedItems.has(v),T=\"\";i?T=`\n      <button class=\"rlh-action-btn-icon rlh-rename-btn\" title=\"\\u91CD\\u547D\\u540D\\u5E76\\u7F16\\u8F91\"><i class=\"fa-solid fa-pencil\"></i></button>\n      <button class=\"rlh-toggle-btn rlh-item-toggle\" title=\"\\u542F\\u7528/\\u7981\\u7528\\u6B64\\u6761\\u76EE\"><i class=\"fa-solid fa-power-off\"></i></button>\n      <button class=\"rlh-action-btn-icon rlh-delete-entry-btn\" title=\"\\u5220\\u9664\\u6761\\u76EE\"><i class=\"fa-solid fa-trash-can\"></i></button>\n    `:u?T='<button class=\"rlh-toggle-btn rlh-item-toggle\" title=\"\\u542F\\u7528/\\u7981\\u7528\\u6B64\\u6761\\u76EE\"><i class=\"fa-solid fa-power-off\"></i></button>':T=`\n      <button class=\"rlh-action-btn-icon rlh-rename-btn\" title=\"\\u91CD\\u547D\\u540D\\u5E76\\u7F16\\u8F91\"><i class=\"fa-solid fa-pencil\"></i></button>\n      <button class=\"rlh-toggle-btn rlh-item-toggle\" title=\"\\u542F\\u7528/\\u7981\\u7528\\u6B64\\u6761\\u76EE\"><i class=\"fa-solid fa-power-off\"></i></button>\n    `;let J=A?`<label class=\"rlh-selection-control\"><input type=\"checkbox\" class=\"rlh-multi-select-checkbox\" data-select-key=\"${D(v)}\" ${M?\"checked\":\"\"}></label>`:\"\",de=u?\"\\u6B64\\u6761\\u76EE\\u6765\\u81EA\\u89D2\\u8272\\u5361\\uFF0C\\u90E8\\u5206\\u64CD\\u4F5C\\u53D7\\u9650\":A?\"\\u70B9\\u51FB\\u9009\\u62E9/\\u53D6\\u6D88\\u9009\\u62E9\":\"\\u70B9\\u51FB\\u5C55\\u5F00/\\u7F16\\u8F91\",H=cr(m,a),V=i?Kr(e.statusId):null,B=i?Yr(V.id,{shortLabel:!0}):\"\",Q=\"\";if(i){let c=(e.position??\"before_character_definition\").toString(),g=Ke.position?.[c]??\"\\u9ED8\\u8BA4\\u4F4D\\u7F6E\",y=D(g),_=Number(e.order),z=Number(e.display_index),I=Number.isFinite(_)?`#${_}`:Number.isFinite(z)?`#${z}`:\"\\u672A\\u8BBE\\u7F6E\",O=D(I);Q=`\n          <div class=\"rlh-item-meta\" title=\"\\u63D2\\u5165\\u4E0E\\u987A\\u5E8F\\u4FE1\\u606F\">\n            <span class=\"rlh-item-meta-chip\"><i class=\"fa-solid fa-map-pin\"></i>\\u63D2\\u5165 ${y}</span>\n            <span class=\"rlh-item-meta-chip\"><i class=\"fa-solid fa-list-ol\"></i>\\u987A\\u5E8F ${O}</span>\n          </div>\n        `}let he=E?` data-drag-enabled=\"${S?\"false\":\"true\"}\"${S?' data-drag-disabled=\"true\"':\"\"}`:\"\",ae=n(`<div class=\"rlh-item-container ${u?\"from-card\":\"\"}\" data-type=\"${r}\" data-id=\"${b}\" ${i?`data-book-name=\"${D(o)}\"`:\"\"} data-select-key=\"${D(v)}\"${i?` data-status-id=\"${Rr(V.id)}\"`:\"\"}${he}>\n      <div class=\"rlh-item-header\" title=\"${de}\">\n        ${J}\n        ${s}\n        <div class=\"rlh-item-header-main\">\n          <div class=\"rlh-item-title-row\">\n            <span class=\"rlh-item-name\">${H}</span>\n            ${B}\n          </div>\n          ${Q}\n        </div>\n        <div class=\"rlh-item-controls\">${T}</div>\n      </div>\n      <div class=\"rlh-collapsible-content\"></div>\n    </div>`);ae.data(\"searchTerm\",a),ae.attr(\"data-search-term\",typeof a==\"string\"?a:\"\"),ae.toggleClass(\"enabled\",e.enabled),ae.toggleClass(\"selected\",M);let se=ae.find(\".rlh-collapsible-content\"),re=l.initialMode;if(!re&&a&&(re=\"viewer\"),f)ae.removeClass(\"rlh-collapsed\"),se.show(),ae.attr(\"data-entry-mode\",\"edit\");else if(re===\"viewer\"){let c=i?Vr(e,a):bt(e,a);se.html(c),se.show(),ae.removeClass(\"rlh-collapsed\"),ae.attr(\"data-entry-mode\",\"view\")}else h===\"collapsed\"?(ae.addClass(\"rlh-collapsed\"),se.hide(),ae.attr(\"data-entry-mode\",re??\"collapsed\")):(ae.removeClass(\"rlh-collapsed\"),ae.attr(\"data-entry-mode\",re??\"collapsed\"));return ae},Gt=(e,r)=>{let o=ce(),a=be(),l=o(\".rlh-entry-list-wrapper\",a);if(l.length>0){l.find(\".rlh-info-text\").remove();let n=ar(e,\"lore\",r,\"\",{isExpanded:!0,enableDrag:!1});return l.prepend(n),n}return null},qr=()=>{let e=ce(),r=be();e(\"#rlh-selection-count\",r).text(`\\u5DF2\\u9009\\u62E9: ${t.selectedItems.size}`)},Xr=(e,r,o)=>{let a=ce(),l=be(),i=r!=null?Number(r):NaN,b=Number.isInteger(i),m=S=>{if(S==null)return!1;if(b){let x=Number(S);if(Number.isInteger(x))return x===i}return String(S)===String(r)},u=a('.rlh-item-container[data-type=\"lore\"]',l).filter((S,x)=>{let N=a(x),s=N.data(\"book-name\")??N.attr(\"data-book-name\");if(String(s)!==String(e))return!1;let v=N.data(\"id\");return m(v)?!0:m(N.attr(\"data-id\"))}).first();if(!u.length)return;let h=Kr(o),f=Yr(h.id,{shortLabel:!0});u.attr(\"data-status-id\",h.id);let w=u.find(\".rlh-item-title-row\").first();if(w.length){let S=w.find(\".rlh-status-badge\").first();S.length?S.replaceWith(f):w.append(f)}let E=u.find(\".rlh-collapsible-content\");if(E.length&&u.attr(\"data-entry-mode\")===\"view\"){let x=te(e).find(N=>Number(N?.uid)===numericId);if(x){let N=Vr(x,u.data(\"searchTerm\")??\"\");E.html(N)}}},Kt=(e,r,o,a,l,n)=>{let i=\"\",b=\"\",m=\"\",u=h=>Object.entries(h).filter(([,f])=>f>0).map(([f,w])=>`<li>- ${D(f)}\\uFF1A<strong>${w}</strong> \\u4E2A</li>`).join(\"\");if(n===\"lorebook\"){let h=new Set(e.map(E=>E.bookName)).size+(o?.length??0),f=e.length;i=`\n      <div class=\"rlh-replace-stats\">\n        <p>- \\u5171\\u5339\\u914D\\u5230 ${h} \\u672C\\u4E16\\u754C\\u4E66\\uFF0C\\u5176\\u4E2D ${f} \\u4E2A\\u6761\\u76EE\\u5C06\\u88AB\\u4FEE\\u6539\\u3002</p>\n        <p>- \\u547D\\u4E2D\\u8BE6\\u60C5\\uFF1A</p>\n        <ul>\n          <li>- \\u4E66\\u540D\\uFF1A<strong>${r.bookName}</strong> \\u4E2A</li>\n          <li>- \\u6761\\u76EE\\u540D\\uFF1A<strong>${r.entryName}</strong> \\u4E2A</li>\n          <li>- \\u5173\\u952E\\u8BCD\\uFF1A<strong>${r.keywords}</strong> \\u4E2A</li>\n          <li>- \\u5185\\u5BB9\\uFF1A<strong>${r.content}</strong> \\u4E2A</li>\n        </ul>\n      </div>\n    `,b=`<ul class=\"rlh-confirm-entry-list\">${e.map(({bookName:E,entry:S,matchedFields:x})=>{let N=[];x&&(x.entryName&&N.push(\"\\u6761\\u76EE\\u540D\"),x.keywords>0&&N.push(\"\\u5173\\u952E\\u8BCD\"),x.content&&N.push(\"\\u5185\\u5BB9\"));let s=N.join(\"\\u3001\"),v=D(S.name||\"\\u65E0\\u6807\\u9898\\u6761\\u76EE\"),k=s?`\\uFF08${s}\\uFF09`:\"\";return`<li class=\"rlh-confirm-entry-item\">${D(E)}: ${v}${k}</li>`}).join(\"\")}</ul>`,o&&o.length>0&&(m=`\n        <hr>\n        <h4>\\u4EC5\\u4E66\\u540D\\u5339\\u914D (\\u4E0D\\u4F1A\\u88AB\\u66FF\\u6362):</h4>\n        <div class=\"rlh-confirm-scroll-list rlh-confirm-scroll-list--secondary\">\n          <ul class=\"rlh-confirm-entry-list\">${o.map(S=>`<li class=\"rlh-confirm-entry-item\">${D(S)}</li>`).join(\"\")}</ul>\n        </div>\n      `)}else if(n===\"regex\"){let h={\\u540D\\u79F0\\u5339\\u914D:r.name,\\u5185\\u5BB9\\u5339\\u914D:r.content},f=u(h);f&&(i=`<div class=\"rlh-replace-stats\"><h4>\\u66FF\\u6362\\u7EDF\\u8BA1\\u6458\\u8981\\uFF1A</h4><ul>${f}</ul></div>`),b=`<ul class=\"rlh-confirm-entry-list\">${e.map(w=>`<li class=\"rlh-confirm-entry-item\">${D(w.script_name||\"\\u672A\\u547D\\u540D\\u6B63\\u5219\")}</li>`).join(\"\")}</ul>`}return`\n    <div class=\"rlh-replace-confirm-modal\">\n      <p>\\u786E\\u5B9A\\u8981\\u5C06 <strong>\"${D(a)}\"</strong> \\u66FF\\u6362\\u4E3A <strong>\"${D(l)}\"</strong> \\u5417\\uFF1F</p>\n      <p>\\u6B64\\u64CD\\u4F5C\\u4E0D\\u53EF\\u64A4\\u9500\\u3002</p>\n      <hr>\n      ${i}\n      <hr>\n      <h4>\\u5C06\\u8981\\u4FEE\\u6539\\u7684\\u6761\\u76EE\\u5217\\u8868\\uFF1A</h4>\n      <div class=\"rlh-confirm-scroll-list\">\n        ${b}\n      </div>\n      ${m}\n    </div>\n  `},Jr=()=>{let e=ce(),r=be(),o=e(\"#regex-lore-hub-save-status\",r);if(!o.length)return;let a=t.saveStatus,l=\"\",n=\"\";switch(a){case\"saving\":l='<i class=\"fa-solid fa-spinner fa-spin\"></i> \\u6B63\\u5728\\u4FDD\\u5B58...',n=\"saving\";break;case\"retrying\":l=`<i class=\"fa-solid fa-triangle-exclamation fa-fade\"></i> \\u81EA\\u52A8\\u4FDD\\u5B58\\u5931\\u8D25\\uFF0C\\u6B63\\u5728\\u91CD\\u8BD5... (${t.saveRetryAttempt}/3)`,n=\"retrying\";break;case\"success\":l='<i class=\"fa-solid fa-check-circle\"></i> \\u6570\\u636E\\u5DF2\\u4FDD\\u5B58',n=\"success\";break;case\"failed\":l='<i class=\"fa-solid fa-circle-xmark\"></i> \\u81EA\\u52A8\\u4FDD\\u5B58\\u5931\\u8D25\\uFF0C\\u8BF7\\u68C0\\u67E5\\u8FDE\\u63A5\\u6216\\u624B\\u52A8\\u4FDD\\u5B58\\u3002',n=\"failed\";break;case\"idle\":default:l=\"\",n=\"idle\";break}o.html(l),o.attr(\"class\",`rlh-save-status ${n}`)},zo=(e,r)=>{let o=te(e);if(!Array.isArray(o)||!o.length||!Array.isArray(r)||r.length!==o.length)return null;let a=new Map(o.map(n=>[String(n.uid??\"\"),n])),l=[];return r.forEach(n=>{let i=String(n??\"\");a.has(i)&&(l.push(a.get(i)),a.delete(i))}),l.length?(a.forEach(n=>l.push(n)),l.forEach((n,i)=>{n.display_index=i,(n.order===void 0||n.order===null||Number.isNaN(Number(n.order)))&&(n.order=i)}),Ae(e,l),l):null},mt=(e,r,o={})=>{let a=_e(),l=o.enabled??!1,n=!!e?.length,i=()=>{n&&(e.attr(\"data-drag-disabled\",\"true\"),e.find(\".rlh-drag-disabled-tip\").length||e.prepend('<p class=\"rlh-info-text-small rlh-drag-disabled-tip\">\\u62D6\\u62FD\\u6392\\u5E8F\\u529F\\u80FD\\u6682\\u65F6\\u4E0D\\u53EF\\u7528\\u3002</p>'))};if(!l||!n){n&&(e.removeAttr(\"data-drag-disabled\"),e.find(\".rlh-drag-disabled-tip\").remove());return}if(t.isDragSortDisabled){i();return}if(!a?.Sortable)return;let b=e[0];!b||e.find(\".rlh-item-container\").length<2||(e.removeAttr(\"data-drag-disabled\"),e.find(\".rlh-drag-disabled-tip\").remove(),a.Sortable.create(b,{animation:150,handle:\".rlh-drag-handle\",ghostClass:\"sortable-ghost\",chosenClass:\"sortable-chosen\",onEnd:R(async u=>{let{oldIndex:h,newIndex:f}=u;if(h===f)return;let w=Array.from(b.querySelectorAll(\".rlh-item-container\")).map(E=>E.getAttribute(\"data-id\")).filter(Boolean);zo(r,w)&&await nr()},\"RegexLoreHub.Sortable\")}))};var Yt=6,ir=null,Me=null,ft=()=>{if(!ir&&!Me)return;let e=_e();if(ir){let{type:r,id:o}=ir;if(r===\"idle\"&&e?.cancelIdleCallback)e.cancelIdleCallback(o);else if(r===\"raf\"&&e?.cancelAnimationFrame)e.cancelAnimationFrame(o);else if(r===\"timeout\"){let a=e?.clearTimeout??(typeof clearTimeout==\"function\"?clearTimeout:null);a&&a(o)}ir=null}Me&&(Me.remove(),Me=null)},gt=(e,r)=>{let o=Array.isArray(e)?[...e]:[];return r===\"status\"?o.sort((a,l)=>{let n=Number(l.enabled)-Number(a.enabled);return n!==0?n:(a.name||\"\").localeCompare(l.name||\"\",\"zh\")}):o.sort((a,l)=>(a.name||\"\\u65E0\\u6807\\u9898\\u6761\\u76EE\").localeCompare(l.name||\"\\u65E0\\u6807\\u9898\\u6761\\u76EE\",\"zh\"))},Vt=(e,r=!1)=>{let o=[],a=[],l={bookName:0,entryName:0,keywords:0,content:0};if(!e)return{matches:o,stats:l,booksMatchedByNameOnly:a};let n=t.allLorebooks,i=r?\"\":\"i\",b=new RegExp(e.replace(/[.*+?^${}()|[\\/\\\\]/g,\"\\\\$&\"),i),m=new Set,u=new Set,h=new Set,f=new Set,w=new Set;for(let E of n){let S=te(E.name),x=b.test(E.name),N=!1;x&&m.add(E.name);for(let s of S){let v={bookName:!1,entryName:!1,keywords:0,content:!1},k=!1;if(b.test(s.name||\"\")&&(u.add(s.uid),v.entryName=!0,k=!0),Array.isArray(s.keys)){let A=s.keys.filter(M=>b.test(M)).length;A>0&&(v.keywords=A,h.add(s.uid),k=!0)}b.test(s.content||\"\")&&(f.add(s.uid),v.content=!0,k=!0),k&&(N=!0,w.has(s.uid)||(o.push({bookName:E.name,entry:s,matchedFields:v}),w.add(s.uid)))}x&&!N&&a.push(E.name)}return l.bookName=m.size,l.entryName=u.size,l.keywords=h.size,l.content=f.size,{matches:o,stats:l,booksMatchedByNameOnly:a}},qt=(e,r,o)=>{e.view===\"global-lore-detail\"?jo(e,r,o):Fo(e,r,o)},Fo=(e,r,o)=>{ft();let a=ce(),l=be(),n=_e(),i=typeof r==\"string\"?r:\"\",b=lr(e),m=[...t.allLorebooks];if(b===\"status\"?m.sort((s,v)=>{let k=Number(v.enabled)-Number(s.enabled);return k!==0?k:s.name.localeCompare(v.name,\"zh\")}):m.sort((s,v)=>s.name.localeCompare(v.name,\"zh\")),!m.length){o.html(`\n      <div class=\"rlh-empty-state\">\n        <div class=\"rlh-empty-icon\"><i class=\"fa-solid fa-book-bookmark\"></i></div>\n        <h4>\\u6CA1\\u6709\\u4E16\\u754C\\u4E66</h4>\n        <p>\\u70B9\\u51FB\\u53F3\\u4E0A\\u89D2\\u7684\\u201C<i class=\"fa-solid fa-plus\"></i>\\u201D\\u6309\\u94AE\\u6765\\u521B\\u5EFA\\u4F60\\u7684\\u7B2C\\u4E00\\u4E2A\\u4E16\\u754C\\u4E66\\u5427\\uFF01</p>\n      </div>\n    `);return}let u=i?m.filter(s=>t.searchFilters.bookName&&s.name.toLowerCase().includes(i)?!0:te(s.name).some(A=>Ar(A,i))):m;if(!u.length){o.html('<p class=\"rlh-info-text\">\\u672A\\u627E\\u5230\\u5339\\u914D\\u7684\\u4E16\\u754C\\u4E66\\u3002</p>');return}o.empty();let h=u.length,f=h<=Yt?h:Math.min(Yt,Math.max(3,Math.ceil(h/5))),w=0;Me=h>f?a('<p class=\"rlh-info-text-small\" aria-live=\"polite\"></p>'):null;let E=()=>{if(!Me)return;let s=Math.min(w,h);Me.text(`\\u6B63\\u5728\\u52A0\\u8F7D\\u4E16\\u754C\\u4E66\\u5217\\u8868 (${s}/${h})\\uFF0C\\u8BF7\\u7A0D\\u5019...`).appendTo(o)},S=s=>{if(!s.length)return;let v=l&&typeof l.createDocumentFragment==\"function\"?l.createDocumentFragment():null;v?(s.forEach(k=>v.appendChild(k)),o.append(v)):s.forEach(k=>o.append(k))},x=()=>{let s=Math.min(w+f,h),v=[];for(let k=w;k<s;k++){let M=Wt(u[k],r,!0,null).get(0);M&&v.push(M)}if(S(v),w=s,E(),w>=h&&Me){let k=Me;(n?.setTimeout??setTimeout)(()=>{Me===k&&(k.remove(),Me=null)},320)}},N=()=>{let s=()=>{ir=null,x(),w<h&&N()};n?.requestIdleCallback?ir={type:\"idle\",id:n.requestIdleCallback(s,{timeout:120})}:n?.requestAnimationFrame?ir={type:\"raf\",id:n.requestAnimationFrame(s)}:ir={type:\"timeout\",id:(n?.setTimeout??setTimeout)(s,16)}};x(),w<h?N():Me&&(Me.remove(),Me=null)},jo=(e,r,o)=>{ft();let a=ce(),l=e?.activeBookName??t.activeBookName;if(!t.allLorebooks.find(E=>E.name===l)){o.html(`<p class=\"rlh-info-text\">\\u9519\\u8BEF\\uFF1A\\u672A\\u627E\\u5230\\u540D\\u4E3A \"${D(l)}\" \\u7684\\u4E16\\u754C\\u4E66\\u3002</p>`);return}if(t.loadingBookName===l){let E=`\n        <div class=\"rlh-detail-view\" data-book-name=\"${D(l)}\">\n          <header class=\"rlh-detail-header\">\n            <button class=\"rlh-action-btn-icon rlh-back-to-list-btn\" title=\"\\u8FD4\\u56DE\\u4E16\\u754C\\u4E66\\u5217\\u8868\"><i class=\"fa-solid fa-arrow-left\"></i></button>\n            <h2>${D(l)}</h2>\n            <div class=\"rlh-item-controls\">\n              <button class=\"rlh-toolbar-btn rlh-rename-book-btn\" title=\"\\u91CD\\u547D\\u540D\\u4E16\\u754C\\u4E66\">\\u91CD\\u547D\\u540D</button>\n              <button class=\"rlh-toolbar-btn rlh-delete-book-btn\" title=\"\\u5220\\u9664\\u4E16\\u754C\\u4E66\">\\u5220\\u9664</button>\n            </div>\n          </header>\n          <div class=\"rlh-detail-content\">\n            <p class=\"rlh-info-text\">\\u52A0\\u8F7D\\u4E2D...</p>\n          </div>\n        </div>\n      `;o.html(E);return}o.append(`<div class=\"rlh-info-text-small\">\\u5F53\\u524D\\u4E16\\u754C\\u4E66\\uFF1A${D(l)}</div>`);let i=lr(e),b=dr(e),m=gt(te(l),i),u=`\n        <div class=\"rlh-detail-view\" data-book-name=\"${D(l)}\">\n          <header class=\"rlh-detail-header\">\n            <button class=\"rlh-action-btn-icon rlh-back-to-list-btn\" title=\"\\u8FD4\\u56DE\\u4E16\\u754C\\u4E66\\u5217\\u8868\"><i class=\"fa-solid fa-arrow-left\"></i></button>\n            <h2>${D(l)}</h2>\n            <div class=\"rlh-item-controls\">\n              <button class=\"rlh-toolbar-btn rlh-rename-book-btn\" title=\"\\u91CD\\u547D\\u540D\\u4E16\\u754C\\u4E66\">\\u91CD\\u547D\\u540D</button>\n              <button class=\"rlh-toolbar-btn rlh-delete-book-btn\" title=\"\\u5220\\u9664\\u4E16\\u754C\\u4E66\">\\u5220\\u9664</button>\n            </div>\n          </header>\n          <div class=\"rlh-detail-content\">\n          </div>\n        </div>\n      `;o.html(u);let h=r?m.filter(E=>Ar(E,r)):m,f=o.find(\".rlh-detail-content\");if(!h.length){let E=m.length?\"\\u65E0\\u5339\\u914D\\u6761\\u76EE\":\"\\u8FD9\\u672C\\u4E66\\u8FD8\\u6CA1\\u6709\\u6761\\u76EE\\uFF0C\\u70B9\\u51FB\\u5DE5\\u5177\\u680F\\u7684\\u201C\\u65B0\\u5EFA\\u6761\\u76EE\\u201D\\u6309\\u94AE\\uFF0C\\u4E3A\\u5B83\\u6DFB\\u52A0\\u5185\\u5BB9\\u3002\";f.html(`<p class=\"rlh-info-text\">${E}</p>`);return}let w=`\n    <p class=\"rlh-info-text-small\">\\u5171 ${m.length} \\u4E2A\\u6761\\u76EE</p>\n    <div class=\"rlh-entry-list-wrapper\">\n      ${h.map(E=>ar(E,\"lore\",l,r,{collapseState:b,enableDrag:!1}).prop(\"outerHTML\")).join(\"\")}\n    </div>\n  `;f.html(w)};var Xt=(e,r,o)=>{let a=ce(),l=t.lorebooks.character,n=t.characterContext.name??\"\";if(!(t.characterContext.id!==null)){o.html('<p class=\"rlh-info-text\">\\u8BF7\\u5148\\u52A0\\u8F7D\\u4E00\\u4E2A\\u89D2\\u8272\\u4EE5\\u7BA1\\u7406\\u89D2\\u8272\\u4E16\\u754C\\u4E66\\u3002</p>');return}if(l.length===0){o.html('<p class=\"rlh-info-text\">\\u5F53\\u524D\\u89D2\\u8272\\u6CA1\\u6709\\u7ED1\\u5B9A\\u7684\\u4E16\\u754C\\u4E66\\u3002\\u70B9\\u51FB\\u540C\\u6B65\\u6309\\u94AE\\u5237\\u65B0\\u3002</p>');return}let b=t.activeCharacterBook;(!b||!l.includes(b))&&(b=l[0],t.activeCharacterBook=b);let m=lr(e),u=dr(e);if(l.length>1){let w=l.map(E=>`<option value=\"${D(E)}\"${E===b?\" selected\":\"\"}>${D(E)}</option>`).join(\"\");o.append(`<div class=\"rlh-book-switcher\"><label>\\u5F53\\u524D\\u89D2\\u8272\\u540D\\uFF1A${D(n)}<select id=\"${Hr}\" class=\"rlh-input\">${w}</select></label></div>`)}else o.append(`<div class=\"rlh-info-text-small\">\\u5F53\\u524D\\u89D2\\u8272\\u540D\\uFF1A${D(n)}</div>`);let f=(w=>{let E=a(`<div class=\"rlh-book-group\" data-book-name=\"${D(w)}\">\n        <div class=\"rlh-book-group-header\">\n          <h2 class=\"rlh-book-group-title\">${D(w)}</h2>\n          <div class=\"rlh-item-controls\">\n            <button class=\"rlh-toolbar-btn rlh-rename-book-btn\" title=\"\\u91CD\\u547D\\u540D\\u4E16\\u754C\\u4E66\">\\u91CD\\u547D\\u540D</button>\n            <button class=\"rlh-toolbar-btn rlh-delete-book-btn\" title=\"\\u5220\\u9664\\u4E16\\u754C\\u4E66\">\\u5220\\u9664</button>\n          </div>\n        </div>\n        <div class=\"rlh-entry-list-wrapper\"></div>\n      </div>`),S=E.find(\".rlh-entry-list-wrapper\"),x=t.allLorebooks.find(T=>T.name===w);if(x&&!x.entriesLoaded)return x.loadingEntries||(x.loadingEntries=!0,Le(w).finally(()=>{x.loadingEntries=!1,le()})),S.append('<p class=\"rlh-info-text\">\\u52A0\\u8F7D\\u4E2D...</p>'),E;let N=[...te(w)].sort((T,J)=>(T.display_index??Number.MAX_SAFE_INTEGER)-(J.display_index??Number.MAX_SAFE_INTEGER)),s=gt(N,m),v=!r||t.searchFilters.bookName&&w.toLowerCase().includes(r),k=r?s.filter(T=>Ar(T,r)):s,A=v&&!r?s:k,M=!1;return A.length?A.forEach(T=>{S.append(ar(T,\"lore\",w,r,{collapseState:u,enableDrag:M}))}):r?S.append('<p class=\"rlh-info-text-small\">\\u65E0\\u5339\\u914D\\u6761\\u76EE</p>'):S.append('<p class=\"rlh-info-text-small\">\\u8FD9\\u672C\\u4E16\\u754C\\u4E66\\u6682\\u65F6\\u6CA1\\u6709\\u6761\\u76EE\\u3002</p>'),mt(S,w,{enabled:M}),E})(b);f?(f.attr(\"data-active\",\"true\"),o.append(f)):r?o.append('<p class=\"rlh-info-text\">\\u672A\\u627E\\u5230\\u5339\\u914D\\u7684\\u6761\\u76EE\\u3002</p>'):o.append('<p class=\"rlh-info-text\">\\u672A\\u80FD\\u52A0\\u8F7D\\u5F53\\u524D\\u4E16\\u754C\\u4E66\\uFF0C\\u8BF7\\u5C1D\\u8BD5\\u5237\\u65B0\\u6570\\u636E\\u3002</p>')};var Jt=(e,r,o)=>{let a=ce(),l=t.chatLorebook,n=_e(),i=t.characterContext.name??\"\";if(!(n.SillyTavern?.getContext?.()?.chatId!==null)){o.html('<p class=\"rlh-info-text\">\\u8BF7\\u5148\\u6253\\u5F00\\u4E00\\u4E2A\\u804A\\u5929\\u4EE5\\u7BA1\\u7406\\u804A\\u5929\\u4E16\\u754C\\u4E66\\u3002</p>');return}if(!l){o.html(`\n      <div class=\"rlh-chat-lore-empty\">\n        <p class=\"rlh-info-text\">\\u5F53\\u524D\\u804A\\u5929\\u6CA1\\u6709\\u7ED1\\u5B9A\\u7684\\u4E16\\u754C\\u4E66\\u3002</p>\n        <button class=\"rlh-action-btn\" id=\"rlh-create-chat-lore-btn\"><i class=\"fa-solid fa-plus\"></i> \\u521B\\u5EFA\\u5E76\\u7ED1\\u5B9A\\u804A\\u5929\\u4E16\\u754C\\u4E66</button>\n      </div>\n    `);return}o.append(`<div class=\"rlh-info-text-small\">\\u5F53\\u524D\\u804A\\u5929\\u89D2\\u8272\\u540D\\uFF1A${D(i)}</div>`);let m=lr(e),u=dr(e),h=a(`<div class=\"rlh-book-group\" data-book-name=\"${D(l)}\">\n      <div class=\"rlh-book-group-header\">\n        <h2 class=\"rlh-book-group-title\">${D(l)} (\\u804A\\u5929\\u4E13\\u7528)</h2>\n        <div class=\"rlh-item-controls\">\n          <button class=\"rlh-toolbar-btn rlh-rename-book-btn\" title=\"\\u91CD\\u547D\\u540D\\u4E16\\u754C\\u4E66\">\\u91CD\\u547D\\u540D</button>\n          <button class=\"rlh-toolbar-btn rlh-unlink-chat-lore-btn\" title=\"\\u89E3\\u9664\\u7ED1\\u5B9A\">\\u89E3\\u9664\\u7ED1\\u5B9A</button>\n        </div>\n      </div>\n      <div class=\"rlh-entry-list-wrapper\"></div>\n    </div>`),f=h.find(\".rlh-entry-list-wrapper\"),w=t.allLorebooks.find(s=>s.name===l);if(w&&!w.entriesLoaded){w.loadingEntries||(w.loadingEntries=!0,Le(l).finally(()=>{w.loadingEntries=!1,le()})),f.append('<p class=\"rlh-info-text\">\\u52A0\\u8F7D\\u4E2D...</p>'),o.append(h);return}let E=[...te(l)].sort((s,v)=>(s.display_index??Number.MAX_SAFE_INTEGER)-(v.display_index??Number.MAX_SAFE_INTEGER)),S=gt(E,m),x=r?S.filter(s=>Ar(s,r)):S,N=!1;if(x.length)x.forEach(s=>{f.append(ar(s,\"lore\",l,r,{collapseState:u,enableDrag:N}))});else{let s=S.length?\"\\u65E0\\u5339\\u914D\\u6761\\u76EE\":\"\\u8FD9\\u672C\\u4E66\\u8FD8\\u6CA1\\u6709\\u6761\\u76EE\\u3002\";f.append(`<p class=\"rlh-info-text-small\">${s}</p>`)}mt(f,l,{enabled:N}),o.append(h)},Qt=()=>ft();var Wo=(e,r)=>{let o=Array.isArray(e)?[...e]:[];return r===\"status\"?o.sort((a,l)=>{let n=Number(l.enabled)-Number(a.enabled);return n!==0?n:(a.script_name||\"\").localeCompare(l.script_name||\"\",\"zh\")}):r===\"name\"?o.sort((a,l)=>(a.script_name||\"\").localeCompare(l.script_name||\"\",\"zh\")):o},Zt=(e,r=!1)=>{let o=[],a={name:0,content:0};if(!e)return{matches:o,stats:a};let l=[...t.regexes.global,...t.regexes.character],n=r?\"\":\"i\",i=new RegExp(e.replace(/[.*+?^${}()|[\\/\\\\]/g,\"\\\\$&\"),n),b=new Set,m=new Set,u=new Set;for(let h of l){let f=!1;i.test(h.script_name||\"\")&&(b.add(h.script_name),f=!0);let w=`${h.find_regex||\"\"} ${h.replace_string||\"\"}`;i.test(w)&&(m.add(h.script_name),f=!0),f&&!u.has(h.id)&&(o.push(h),u.add(h.id))}return a.name=b.size,a.content=m.size,{matches:o,stats:a}},Qr=(e,r,o,a,l)=>{let n=ce(),i=_e(),b=lr(e),m=dr(e),u=Wo(r??[],b),h=l??(e.id===\"char-regex\"?\"\\u89D2\\u8272\\u6B63\\u5219\":\"\\u5168\\u5C40\\u6B63\\u5219\");if(e.id===\"char-regex\"){let s=i.SillyTavern?.getContext?.()||{};if(!(s.characterId!==void 0&&s.characterId!==null)){a.html('<p class=\"rlh-info-text\">\\u8BF7\\u5148\\u52A0\\u8F7D\\u4E00\\u4E2A\\u89D2\\u8272\\u4EE5\\u7BA1\\u7406\\u89D2\\u8272\\u6B63\\u5219\\u3002</p>');return}}if(!u.length){a.html(`<p class=\"rlh-info-text\">\\u6CA1\\u6709${h}\\u3002\\u70B9\\u51FB\\u540C\\u6B65\\u6309\\u94AE\\u5237\\u65B0\\u3002</p>`);return}let f=o?u.filter(s=>jt(s,o)):u;if(!f.length){a.html(`<p class=\"rlh-info-text\">\\u6CA1\\u6709\\u5339\\u914D\\u7684${h}\\u3002</p>`);return}let w=`rlh-regex-list-${e.id}`,E=n(`<div id=\"${w}\" class=\"rlh-regex-list\"></div>`);a.append(E);let S=!o;f.forEach((s,v)=>{let k=ar(s,\"regex\",\"\",o,{collapseState:m,selectionKey:`regex:${s.id}`,enableDrag:S});k.find(\".rlh-item-name\").prepend(`<span class=\"rlh-order-indicator\">#${v+1}</span> `),E.append(k)});let x=E[0],N=\"rlh-drag-disabled-banner\";if(a.find(`.${N}`).remove(),S&&t.isDragSortDisabled?(E.attr(\"data-drag-disabled\",\"true\"),a.prepend(`<p class=\"rlh-info-text-small ${N}\">\\u63D0\\u793A\\uFF1A\\u62D6\\u62FD\\u6392\\u5E8F\\u529F\\u80FD\\u6682\\u65F6\\u4E0D\\u53EF\\u7528\\uFF0C\\u8BF7\\u4F7F\\u7528\\u6309\\u94AE\\u8C03\\u6574\\u987A\\u5E8F\\u3002</p>`)):E.removeAttr(\"data-drag-disabled\"),S&&!t.isDragSortDisabled&&x&&i.Sortable){let s=i.Sortable.create(x,{animation:150,handle:\".rlh-drag-handle\",forceFallback:!0,fallbackOnBody:!0,fallbackTolerance:6,delayOnTouchOnly:!0,touchStartThreshold:8,fallbackClass:\"rlh-sorting-fallback\",onStart:()=>{E.addClass(\"sorting-active\")},onEnd:R(async v=>{E.removeClass(\"sorting-active\");let{oldIndex:k,newIndex:A}=v;if(k===A)return;let M=e.id===\"global-regex\"?\"global\":\"character\",T=t.regexes[M];if(!Array.isArray(T))return;let[J]=T.splice(k,1);J&&(T.splice(A,0,J),Xe(T),t.pendingRegexUpdates instanceof Set||(t.pendingRegexUpdates=new Set),t.pendingRegexUpdates.add(M),await nr({silent:!0}),a.empty(),Qr(e,T,o,a,l))},\"RegexLoreHub.RegexSortable\")})}};var Go=e=>e?.toString().trim().toLowerCase()??\"\",Ne=()=>{let e=t.activeTab,r=t.activeView,o={tab:e,view:r,id:`${e}`,instanceKey:`${e}`,activeBookName:t.activeBookName,type:\"lore\",scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u5F53\\u524D\\u89C6\\u56FE\",replaceScopeLabel:\"\\u5728\\u5F53\\u524D\\u89C6\\u56FE\\u4E2D\\u66FF\\u6362\",searchPlaceholder:\"\\u641C\\u7D22...\",visibleFilters:[\"entryName\",\"keywords\",\"content\"],filterLabels:xr,defaultFilters:{entryName:!0,keywords:!0,content:!0},showReplace:!0,showRecursion:!1,showFixKeywords:!1,showCollapseToggle:!1,showPositionMenu:!1,sortOptions:[],multiSelectTarget:\"entry\",supportsMultiSelect:!0,primaryAction:{visible:!1}};if(e===\"global-lore\"){if(r===\"global-lore-detail\"){let a=t.activeBookName??\"\";return{...o,id:\"global-lore-detail\",instanceKey:a?`global-lore-detail:${a}`:\"global-lore-detail\",activeBookName:a,scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u5F53\\u524D\\u4E16\\u754C\\u4E66\",replaceScopeLabel:\"\\u5728\\u5F53\\u524D\\u4E16\\u754C\\u4E66\\u4E2D\\u66FF\\u6362\",searchPlaceholder:\"\\u641C\\u7D22...\",visibleFilters:[\"bookName\",\"entryName\",\"keywords\",\"content\"],defaultFilters:{bookName:!1,entryName:!0,keywords:!0,content:!0},showRecursion:!0,showFixKeywords:!0,showCollapseToggle:!0,showPositionMenu:!0,sortOptions:[\"status\",\"name\"],multiSelectTarget:\"entry\",primaryAction:{visible:!0,icon:\"fa-file-circle-plus\",label:\"\\u65B0\\u5EFA\\u6761\\u76EE\",title:\"\\u65B0\\u5EFA\\u6761\\u76EE\",scope:\"entry\"}}}return{...o,id:\"global-lore-list\",instanceKey:\"global-lore-list\",activeBookName:null,scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u5168\\u90E8\\u4E16\\u754C\\u4E66\",replaceScopeLabel:\"\\u5728\\u5339\\u914D\\u5230\\u7684\\u4E16\\u754C\\u4E66\\u6216\\u6761\\u76EE\\u4E2D\\u66FF\\u6362\",visibleFilters:[\"bookName\",\"entryName\",\"keywords\",\"content\"],defaultFilters:{bookName:!0,entryName:!0,keywords:!0,content:!0},showReplace:!0,showRecursion:!1,showFixKeywords:!1,showCollapseToggle:!1,showPositionMenu:!1,showCleanOrphanBooks:!0,sortOptions:[\"status\",\"name\"],multiSelectTarget:\"book\",primaryAction:{visible:!0,icon:\"fa-plus\",label:\"\\u65B0\\u5EFA\\u4E16\\u754C\\u4E66\",title:\"\\u65B0\\u5EFA\\u4E16\\u754C\\u4E66\",scope:\"book\"}}}if(e===\"char-lore\"){let a=t.activeCharacterBook;if(!a){let n=(Array.isArray(t.lorebooks?.character)?t.lorebooks.character:[]).find(i=>typeof i==\"string\"&&i.trim().length);n&&(a=n,t.activeCharacterBook=n)}return{...o,id:\"char-lore\",instanceKey:\"char-lore\",activeBookName:a,scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u5F53\\u524D\\u4E16\\u754C\\u4E66\",replaceScopeLabel:\"\\u5728\\u5F53\\u524D\\u4E16\\u754C\\u4E66\\u4E2D\\u66FF\\u6362\",visibleFilters:[\"entryName\",\"keywords\",\"content\"],defaultFilters:{bookName:!1,entryName:!0,keywords:!0,content:!0},showRecursion:!0,showFixKeywords:!0,showCollapseToggle:!0,showPositionMenu:!0,sortOptions:[\"status\",\"name\"],multiSelectTarget:\"entry\",primaryAction:{visible:!0,icon:\"fa-file-circle-plus\",label:\"\\u65B0\\u5EFA\\u6761\\u76EE\",title:\"\\u65B0\\u5EFA\\u6761\\u76EE\",scope:\"entry\"}}}return e===\"chat-lore\"?{...o,id:\"chat-lore\",instanceKey:\"chat-lore\",activeBookName:t.chatLorebook,scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u5F53\\u524D\\u4E16\\u754C\\u4E66\",replaceScopeLabel:\"\\u5728\\u5F53\\u524D\\u4E16\\u754C\\u4E66\\u4E2D\\u66FF\\u6362\",visibleFilters:[\"entryName\",\"keywords\",\"content\"],defaultFilters:{bookName:!1,entryName:!0,keywords:!0,content:!0},showRecursion:!0,showFixKeywords:!0,showCollapseToggle:!0,showPositionMenu:!0,sortOptions:[\"status\",\"name\"],multiSelectTarget:\"entry\",primaryAction:{visible:!0,icon:\"fa-file-circle-plus\",label:\"\\u65B0\\u5EFA\\u6761\\u76EE\",title:\"\\u65B0\\u5EFA\\u6761\\u76EE\",scope:\"entry\"}}:e===\"global-regex\"?{...o,id:\"global-regex\",instanceKey:\"global-regex\",type:\"regex\",scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u5168\\u5C40\\u6B63\\u5219\\u8868\\u8FBE\\u5F0F\",replaceScopeLabel:\"\\u5728\\u5168\\u5C40\\u6B63\\u5219\\u4E2D\\u66FF\\u6362\",visibleFilters:[\"entryName\",\"content\"],filterLabels:{...xr,...dt},defaultFilters:{bookName:!1,entryName:!0,keywords:!1,content:!0},showRecursion:!1,showFixKeywords:!1,showCollapseToggle:!0,showPositionMenu:!1,sortOptions:[],multiSelectTarget:\"regex\",supportsMultiSelect:!0,primaryAction:{visible:!1}}:e===\"char-regex\"?{...o,id:\"char-regex\",instanceKey:\"char-regex\",type:\"regex\",scopeLabel:\"\\u641C\\u7D22\\u8303\\u56F4\\uFF1A\\u89D2\\u8272\\u6B63\\u5219\\u8868\\u8FBE\\u5F0F\",replaceScopeLabel:\"\\u5728\\u89D2\\u8272\\u6B63\\u5219\\u4E2D\\u66FF\\u6362\",visibleFilters:[\"entryName\",\"content\"],filterLabels:{...xr,...dt},defaultFilters:{bookName:!1,entryName:!0,keywords:!1,content:!0},showRecursion:!1,showFixKeywords:!1,showCollapseToggle:!0,showPositionMenu:!1,sortOptions:[],multiSelectTarget:\"regex\",supportsMultiSelect:!1,primaryAction:{visible:!1}}:{...o,id:\"unknown\",instanceKey:\"unknown\",supportsMultiSelect:!1}},Ko=e=>{let r=e.id;r&&(t.searchFilterContextsInitialized.has(r)||((e.visibleFilters??[]).forEach(o=>{t.searchFilters[o]=!0}),t.searchFilterContextsInitialized.add(r)),(e.id===\"char-lore\"||e.id===\"chat-lore\")&&t.searchFilters.keywords===void 0&&(t.searchFilters.keywords=!0))},le=()=>{let e=ce(),r=be(),o=e(`#${ue}`,r),a=()=>{if(!o.length){let x=e([]);return{$toolbarRow:x,$toolbar:x,$replaceContainer:x,$content:x}}let h=o.find(\".rlh-toolbar-shell\").first();if(!h.length){let x=o.find(\".rlh-tab-nav\").first();h=e('<div class=\"rlh-toolbar-shell\"></div>'),x.length?h.insertAfter(x):o.prepend(h)}let f=h.find(`#${Lr}`);f.length||(f=e(`<div id=\"${Lr}\" class=\"rlh-toolbar-container\"></div>`),h.append(f));let w=h.find(`#${Cr}`);w.length||(w=e(`<div id=\"${Cr}\" class=\"rlh-replace-container\"></div>`),h.append(w));let E=o.find(\".rlh-content-pane\").first();E.length||(E=e('<div class=\"rlh-content-pane\"></div>'),E.insertAfter(h));let S=E.find(`#${ue}-content`);return S.length||(S=e(`<div id=\"${ue}-content\"></div>`),E.append(S)),{$toolbarRow:h,$toolbar:f,$replaceContainer:w,$content:S}},l=Go(t.globalSearch.term??\"\");[[\"bookName\",\"#rlh-filter-book-name\"],[\"entryName\",\"#rlh-filter-entry-name\"],[\"keywords\",\"#rlh-filter-keywords\"],[\"content\",\"#rlh-filter-content\"]].forEach(([h,f])=>{let w=o.find(f);w.length&&(t.searchFilters[h]=w.is(\":checked\"))});let{$toolbar:i,$replaceContainer:b,$content:m}=a();i.empty(),b.empty(),m.empty();let u=Ne();if(Ko(u),u.tab!==\"global-lore\"&&Qt(),!u.supportsMultiSelect&&t.multiSelectMode&&(t.multiSelectMode=!1,t.selectedItems.clear()),t.multiSelectMode?t.multiSelectTarget!==u.multiSelectTarget&&(t.multiSelectTarget=u.multiSelectTarget,t.selectedItems.clear()):t.multiSelectTarget=u.multiSelectTarget,o.toggleClass(\"rlh-multi-select-mode\",t.multiSelectMode),Ft(u,{$toolbar:i,$replaceContainer:b}),Jr(),qr(),t.isLoadingTabData){m.html('<p class=\"rlh-info-text\">\\u52A0\\u8F7D\\u4E2D...</p>');return}switch(u.tab){case\"global-lore\":qt(u,l,m);break;case\"char-lore\":Xt(u,l,m);break;case\"chat-lore\":Jt(u,l,m);break;case\"global-regex\":Qr(u,t.regexes.global,l,m,\"\\u5168\\u5C40\\u6B63\\u5219\");break;case\"char-regex\":Qr(u,t.regexes.character,l,m,\"\\u89D2\\u8272\\u6B63\\u5219\");break;default:m.html('<p class=\"rlh-info-text\">\\u5F53\\u524D\\u89C6\\u56FE\\u672A\\u5B9E\\u73B0\\u3002</p>');break}};var rt=Object.freeze({and_any:0,not_all:1,not_any:2,and_all:3}),Zr=Object.freeze({0:\"and_any\",1:\"not_all\",2:\"not_any\",3:\"and_all\"}),Yo=Object.freeze({system:0,user:1,assistant:2}),eo=Object.freeze({0:\"system\",1:\"user\",2:\"assistant\"}),xt=Object.freeze({before_character_definition:{type:\"before_character_definition\"},after_character_definition:{type:\"after_character_definition\"},before_example_messages:{type:\"before_example_messages\"},after_example_messages:{type:\"after_example_messages\"},before_author_note:{type:\"before_author_note\"},after_author_note:{type:\"after_author_note\"},at_depth_as_system:{type:\"at_depth\",role:\"system\"},at_depth_as_assistant:{type:\"at_depth\",role:\"assistant\"},at_depth_as_user:{type:\"at_depth\",role:\"user\"}}),Vo=Object.freeze({0:\"before_character_definition\",1:\"after_character_definition\",2:\"before_author_note\",3:\"after_author_note\",4:\"at_depth_as_system\",5:\"before_example_messages\",6:\"after_example_messages\"}),et=Object.freeze({before_char:\"before_character_definition\",after_char:\"after_character_definition\",before_an:\"before_author_note\",after_an:\"after_author_note\",before_em:\"before_example_messages\",after_em:\"after_example_messages\",at_depth:\"at_depth_as_system\",depth_system:\"at_depth_as_system\",depth_character:\"at_depth_as_assistant\",depth_user:\"at_depth_as_user\"}),hr=e=>e?JSON.parse(JSON.stringify(e)):{},Dr=e=>Array.isArray(e)?e.map(r=>{if(typeof r==\"string\")return r.trim();if(r instanceof RegExp)return r.source;if(r&&typeof r==\"object\"){if(typeof r.pattern==\"string\")return r.pattern.trim();if(typeof r.source==\"string\")return r.source.trim()}if(r!=null&&typeof r.toString==\"function\"){let o=r.toString();return typeof o==\"string\"?o.trim():\"\"}return\"\"}).filter(Boolean):[],qo=[\"order\",\"displayIndex\",\"display_index\",\"sort_order\",\"script_order\"],Xe=(e=[])=>{!Array.isArray(e)||e.length===0||e.forEach((r,o)=>{!r||typeof r!=\"object\"||r.source===\"card\"||(qo.forEach(a=>{r[a]=o}),r?.position&&typeof r.position==\"object\"&&\"order\"in r.position&&(r.position.order=o))})},Xo=e=>{if(!Array.isArray(e)||e.length===0)return e;let r=new Map([[\"global\",[]],[\"character\",[]]]);return e.forEach(o=>{if(!o||typeof o!=\"object\"||o.source===\"card\")return;let a=o.scope===\"character\"?\"character\":\"global\";r.get(a).push(o)}),r.forEach(o=>Xe(o)),e},Or=e=>{if(e===!0||e===!1)return e;if(e==null)return!1;if(typeof e==\"string\"){let r=e.trim().toLowerCase();return[\"1\",\"true\",\"yes\",\"on\"].includes(r)}return!!e},De=e=>{if(e===\"\"||e===null||e===void 0)return null;let r=Number(e);return Number.isNaN(r)?null:r},ao=e=>{if(e==null)return\"and_any\";if(typeof e==\"number\"&&!Number.isNaN(e))return Zr[e]??Zr[e.toString()]??\"and_any\";let r=e.toString().trim().toLowerCase();return rt[r]!==void 0?r:Zr[r]!==void 0?Zr[r]:\"and_any\"};var wr=e=>{if(typeof e==\"string\"){let r=e.trim().toLowerCase();if(Yo[r]!==void 0)return r}if(typeof e==\"number\"&&!Number.isNaN(e)){let r=eo[e]??eo[e.toString()];if(r)return r}return null},kt=(e,r)=>{if(e==null)return\"before_character_definition\";if(typeof e==\"object\"&&e!==null){if(typeof e.type==\"string\"&&e.type){let o=(et[e.type]??e.type).trim();if(o===\"at_depth\"||o===\"at_depth_as_system\"){let a=wr(e.role??r)??\"system\";return a===\"assistant\"?\"at_depth_as_assistant\":a===\"user\"?\"at_depth_as_user\":\"at_depth_as_system\"}return o.startsWith(\"at_depth_as_\"),o}if(typeof e.position==\"number\"&&!Number.isNaN(e.position))return kt(e.position,e.role??r)}if(typeof e==\"string\"){let o=(et[e]??e).trim();if(o===\"at_depth\"){let a=wr(r)??\"system\";return a===\"assistant\"?\"at_depth_as_assistant\":a===\"user\"?\"at_depth_as_user\":\"at_depth_as_system\"}return o}if(typeof e==\"number\"&&!Number.isNaN(e)){if(e===4){let a=wr(r)??\"system\";return a===\"assistant\"?\"at_depth_as_assistant\":a===\"user\"?\"at_depth_as_user\":\"at_depth_as_system\"}let o=Vo[e];if(o)return o}return\"before_character_definition\"};var no=(e,{fallbackRole:r=null,fallbackDepth:o=null,fallbackOrder:a=null}={})=>{let l=wr(r),n={type:\"before_character_definition\",role:null,depth:null,order:De(a),uiKey:\"before_character_definition\"},i=u=>{let h=De(u);h!==null&&(n.order=h)},b=u=>{let h=De(u);h!==null&&(n.depth=h)};if(i(a),b(o),e&&typeof e==\"object\"){if(typeof e.type==\"string\"&&e.type){let u=(et[e.type]??e.type).trim();n.type=u===\"at_depth_as_system\"?\"at_depth\":u;let h=wr(e.role)??l;return n.type===\"at_depth\"?(n.role=h??\"system\",b(e.depth),n.uiKey=n.role===\"assistant\"?\"at_depth_as_assistant\":n.role===\"user\"?\"at_depth_as_user\":\"at_depth_as_system\"):(n.role=null,n.depth=null,n.uiKey=n.type),i(e.order),n}if(typeof e.position==\"number\"&&!Number.isNaN(e.position)){let u=wr(e.role)??l,h=kt(e.position,u);return n.uiKey=h,h.startsWith(\"at_depth\")?(n.type=\"at_depth\",n.role=u??\"system\",b(e.depth)):(n.type=h,n.role=null,n.depth=null),i(e.order),n}}let m=kt(e,l);return n.uiKey=m,m.startsWith(\"at_depth\")?(n.type=\"at_depth\",n.role=m===\"at_depth_as_assistant\"?\"assistant\":m===\"at_depth_as_user\"?\"user\":\"system\",n.depth===null&&(n.depth=De(o))):(n.type=m,n.role=null,n.depth=null),n},Jo=(e,{depth:r,order:o,basePosition:a}={})=>{let l=no(a??null),n=(et[e]??e??l.uiKey).toString().trim()||l.uiKey||\"before_character_definition\",i=xt[n]??xt[l.uiKey]??xt.before_character_definition,b={type:i.type},m=De(o),u=m!==null?m:l.order!==null&&l.order!==void 0?l.order:0;if(b.order=u,i.type===\"at_depth\"){let h=i.role??l.role??\"system\";b.role=h;let f=De(r),w=f!==null?f:l.depth!==null&&l.depth!==void 0?l.depth:0;b.depth=w}return b},Ze=e=>{if(!e||typeof e!=\"object\")return e;let r=hr(e);(!r.strategy||typeof r.strategy!=\"object\")&&(r.strategy={});let o=r.strategy,a=Ge(St(r))??Te;o.type=a.strategyType,r.type=a.strategyType,r.statusId=a.id;let l=Dr(o.keys??r.keys??r.key??r.keywords);o.keys=[...l],r.keys=[...l],r.key=[...l],r.keywords=[...l];let n=Dr(o.keys_secondary?.keys??r.keysecondary??r.key_secondary??[]);(!o.keys_secondary||typeof o.keys_secondary!=\"object\")&&(o.keys_secondary={logic:\"and_any\",keys:[]}),o.keys_secondary.keys=[...n],r.keysecondary=[...n];let i=ao(o.keys_secondary.logic??r.logic??r.selectiveLogic);o.keys_secondary.logic=i,r.logic=i,r.selectiveLogic=rt[i];let b=no(r.position,{fallbackRole:r.role,fallbackDepth:r.depth,fallbackOrder:r.order??r.insertion_order??r.displayIndex});r.position=b.uiKey,r.depth=b.type===\"at_depth\"?b.depth??0:null,r.order=b.order??0,r.role=b.role;let m=De(r.probability);return r.probability=m===null?100:m,(!r.recursion||typeof r.recursion!=\"object\")&&(r.recursion={prevent_incoming:!1,prevent_outgoing:!1,delay_until:null}),r.prevent_recursion=Or(r.prevent_recursion??r.preventRecursion??r.recursion.prevent_outgoing),r.exclude_recursion=Or(r.exclude_recursion??r.excludeRecursion??r.recursion.prevent_incoming),r.recursion.prevent_outgoing=r.prevent_recursion,r.recursion.prevent_incoming=r.exclude_recursion,r.case_sensitive=Or(r.case_sensitive??r.caseSensitive??!1),r.caseSensitive=r.case_sensitive,r.match_whole_words=Or(r.match_whole_words??r.matchWholeWords??!1),r.matchWholeWords=r.match_whole_words,r.enabled=r.disable!==void 0?!r.disable:r.enabled??!0,r},Qo=(e,r={})=>{let o=hr(r),a=hr(e),l=Ge(a.statusId??a.strategy?.type??a.type)??Te;(!o.strategy||typeof o.strategy!=\"object\")&&(o.strategy={}),o.strategy.type=l.strategyType,o.type=l.strategyType,o.statusId=l.id,a.statusId=l.id,(!a.strategy||typeof a.strategy!=\"object\")&&(a.strategy={}),a.strategy.type=l.strategyType,a.type=l.strategyType;let n=De(a.uid);n!==null&&(o.uid=n),a.name!==void 0&&(o.name=a.name),a.comment!==void 0&&(o.comment=a.comment),a.content!==void 0&&(o.content=a.content),(!o.strategy||typeof o.strategy!=\"object\")&&(o.strategy={});let i=o.strategy,b=Dr(a.keys??i.keys??o.keys??o.key??o.keywords);i.keys=[...b],o.keys=[...b],o.key=[...b],o.keywords=[...b];let m=Dr(a.keysecondary??i.keys_secondary?.keys??o.keysecondary);(!i.keys_secondary||typeof i.keys_secondary!=\"object\")&&(i.keys_secondary={logic:\"and_any\",keys:[]}),i.keys_secondary.keys=[...m],o.keysecondary=[...m];let u=ao(a.logic??i.keys_secondary.logic??o.logic??o.selectiveLogic);i.keys_secondary.logic=u,o.logic=u,o.selectiveLogic=rt[u],a.enabled!==void 0&&(o.enabled=!!a.enabled,o.disable=!o.enabled);let h=De(a.probability);h!==null?(o.probability=h,o.useProbability=h!==100):o.probability!==void 0&&(o.useProbability=o.probability!==100);let f=De(a.order),w=De(a.depth),E=Jo(a.position??o.position,{depth:w,order:f,basePosition:o.position});o.position=E,E.type===\"at_depth\"?(o.depth=E.depth??0,o.role=E.role??\"system\"):(o.depth=null,o.role=null),E.order!==void 0&&(o.order=E.order,o.insertion_order=E.order,o.displayIndex=E.order),(!o.recursion||typeof o.recursion!=\"object\")&&(o.recursion={prevent_incoming:!1,prevent_outgoing:!1,delay_until:null});let S=o.recursion;a.prevent_recursion!==void 0&&(S.prevent_outgoing=!!a.prevent_recursion),a.exclude_recursion!==void 0&&(S.prevent_incoming=!!a.exclude_recursion),o.preventRecursion=S.prevent_outgoing,o.prevent_recursion=S.prevent_outgoing,o.excludeRecursion=S.prevent_incoming,o.exclude_recursion=S.prevent_incoming;let x=(v,k)=>v===void 0?k:Or(v),N=x(a.case_sensitive,o.caseSensitive??o.case_sensitive);N!==void 0&&(o.caseSensitive=N,o.case_sensitive=N);let s=x(a.match_whole_words,o.matchWholeWords??o.match_whole_words);return s!==void 0&&(o.matchWholeWords=s,o.match_whole_words=s),o},_r=e=>{if(typeof e==\"number\"&&Number.isInteger(e))return e;let r=Number(e);return Number.isInteger(r)?r:null},St=e=>{if(!e||typeof e!=\"object\")return Wr;let r=e?.strategy?.type??e?.type;return Tr(r)??Wr},wt=e=>e&&typeof e==\"object\"?{uid:_r(e.uid??e.id??e.entryUid??e.entry_id??null),tempUid:e.tempUid??e.temp_uid??null,name:e.name??\"\"}:{uid:_r(e),tempUid:null,name:\"\"},ro=(e,r={})=>{let o=wt(e),a=wt(r);return{uid:o.uid??a.uid??null,tempUid:e?.tempUid??e?.temp_uid??a.tempUid??null,name:e?.name??a.name??\"\",previousStatus:St(e??{})}},Zo=e=>{let r=wt(e);return{uid:r.uid,tempUid:r.tempUid,name:r.name,previousStatus:null}},yr=(e,r={})=>({uid:e?.uid??null,tempUid:e?.tempUid??null,name:e?.name??\"\",previousStatus:e?.previousStatus??null,newStatus:r.newStatus??null,alreadyApplied:!!r.alreadyApplied,reason:r.reason??null,error:r.error??null}),kr=Object.freeze({UNSAVED_ENTRY:\"UNSAVED_ENTRY\",DUPLICATE_SELECTION:\"DUPLICATE_SELECTION\",ENTRY_NOT_FOUND:\"ENTRY_NOT_FOUND\",API_ERROR:\"API_ERROR\",STATUS_NOT_APPLIED:\"STATUS_NOT_APPLIED\"}),el=e=>Dr(e),to=e=>{if(!e)return!1;let r=String(e?.message??e??\"\").toLowerCase();return r.includes(\"\\u672A\\u627E\\u5230\\u540D\\u4E3A\")||r.includes(\"character\")&&r.includes(\"not found\")},G={createWorldbook:R(async e=>await ge().createWorldbook(e,[])),deleteWorldbook:R(async e=>await ge().deleteWorldbook(e)),getWorldbooks:R(async()=>await ge().getWorldbookNames()),getCharData:R(async()=>await ge().getCharData()),getRegexes:R(async()=>await ge().getTavernRegexes({scope:\"all\"})),replaceRegexes:R(async(e,r={})=>{let o=r?.scope??\"all\",a=Array.isArray(e)?e:[];Xo(a),await ge().replaceTavernRegexes(a,{scope:o})}),getGlobalWorldbookNames:R(async()=>await ge().getGlobalWorldbookNames()),rebindGlobalWorldbooks:R(async e=>await ge().rebindGlobalWorldbooks(e)),getCharWorldbookNames:R(async e=>{try{let r=e?.name;return r?await ge().getCharWorldbookNames(r):(console.warn(\"[RegexLoreHub] getCharWorldbookNames \\u8C03\\u7528\\u7F3A\\u5C11\\u89D2\\u8272\\u540D\\u79F0\\u3002\"),null)}catch(r){if(to(r))return console.warn(\"[RegexLoreHub] \\u672A\\u627E\\u5230\\u6307\\u5B9A\\u89D2\\u8272\\u5361\\uFF0C\\u8DF3\\u8FC7\\u89D2\\u8272\\u4E16\\u754C\\u4E66\\u52A0\\u8F7D\\u3002\",r),null;throw r}}),getCurrentCharWorldbookNames:R(async()=>{try{return await ge().getCharWorldbookNames(\"current\")}catch(e){if(to(e))return console.warn(\"[RegexLoreHub] \\u672A\\u627E\\u5230\\u5F53\\u524D\\u89D2\\u8272\\u5361\\uFF0C\\u8DF3\\u8FC7\\u89D2\\u8272\\u4E16\\u754C\\u4E66\\u52A0\\u8F7D\\u3002\",e),null;throw e}}),getChatWorldbookName:R(async()=>await ge().getChatWorldbookName(\"current\")),getOrCreateChatWorldbook:R(async e=>await ge().getOrCreateChatWorldbook(\"current\",e)),rebindChatWorldbook:R(async e=>await ge().rebindChatWorldbook(\"current\",e)),getWorldbook:R(async e=>await ge().getWorldbook(e)),updateWorldbookWith:R(async(e,r)=>await ge().updateWorldbookWith(e,r)),replaceWorldbook:R(async(e,r)=>await ge().replaceWorldbook(e,r)),createWorldbookEntries:R(async(e,r)=>await ge().createWorldbookEntries(e,r)),deleteWorldbookEntries:R(async(e,r)=>{let o=new Set(r);return await ge().deleteWorldbookEntries(e,a=>o.has(a.uid))}),saveSettings:R(async()=>await ge().builtin.saveSettings()),rebindCharWorldbooks:R(async e=>await ge().rebindCharWorldbooks(\"current\",e)),get Character(){return ge().Character}},Pe=R(async(e,r)=>{if(!Array.isArray(r)||r.length===0)return;let o=new Map,a=new Set;if(r.forEach(u=>{if(!u||typeof u!=\"object\")return;let h=De(u.uid);if(h===null)return;a.add(h);let f=o.get(h)??{};o.set(h,{...f,...u})}),a.size===0)return;let l=te(e),n=new Map(l.map(u=>[De(u?.uid),u]).filter(([u])=>u!==null)),i=u=>u.map(h=>{let f=De(h?.uid);if(f===null||!a.has(f))return h;let w=n.get(f);if(!w)return h;let E=hr(w),S=o.get(f);return S&&typeof S==\"object\"&&Object.entries(S).forEach(([x,N])=>{x===\"uid\"||x===\"tempUid\"||(Array.isArray(N)?E[x]=N.map(s=>typeof s==\"object\"&&s!==null?hr(s):s):N&&typeof N==\"object\"?E[x]=hr(N):E[x]=N)}),Qo(E,h)}),b=await G.updateWorldbookWith(e,i),m=Array.isArray(b)?b.map(Ze):[];return Ae(e,m),pr(e),await G.saveSettings(),b}),oo=(e,r,o,a,l)=>{let n=r.length,i=o.length,b=a.length,m=r.filter(w=>w.alreadyApplied).length,u=n-m,h=a.filter(w=>w.reason===kr.UNSAVED_ENTRY).length,f=\"skipped\";return n>0&&i===0?f=\"success\":n>0&&i>0?f=\"partial\":i>0&&(f=\"failed\"),{status:f,successCount:n,failedCount:i,ignoredCount:b,alreadyAppliedCount:m,appliedCount:u,ignoredUnsavedCount:h,requestedCount:l,targetStatusId:e.id,targetStatusLabel:e.label}},io=async(e,r,o,a={})=>{let l=Array.isArray(r)?r.filter(s=>s!=null):r!=null?[r]:[],n=l.length,i=Ge(o);if(!i)return{ok:!1,targetStatusId:Tr(o),targetStatusLabel:\"\",targetStrategyType:null,success:[],failed:[],ignored:[],summary:{status:\"failed\",successCount:0,failedCount:0,ignoredCount:0,alreadyAppliedCount:0,appliedCount:0,ignoredUnsavedCount:0,requestedCount:n,targetStatusId:Tr(o),targetStatusLabel:\"\"},errorCode:\"INVALID_STATUS\"};if(!e||typeof e!=\"string\"){let s=Te;return{ok:!1,targetStatusId:s.id,targetStatusLabel:s.label,targetStrategyType:s.strategyType,success:[],failed:[],ignored:[],summary:oo(s,[],[],[],n),errorCode:\"INVALID_BOOK_NAME\"}}let b=te(e),m=new Map(b.map(s=>[_r(s?.uid),s])),u=new Set,h=[],f=[],w=[],E=[],S=new Map;l.forEach(s=>{let v=Zo(s);if(v.uid===null){w.push(yr(v,{reason:kr.UNSAVED_ENTRY}));return}if(u.has(v.uid)){let T=m.get(v.uid),J=T?ro(T,v):v;w.push(yr(J,{reason:kr.DUPLICATE_SELECTION}));return}u.add(v.uid);let k=m.get(v.uid);if(!k){f.push(yr(v,{reason:kr.ENTRY_NOT_FOUND}));return}let A=ro(k,v);if(A.previousStatus===i.id){h.push(yr(A,{newStatus:i.id,alreadyApplied:!0}));return}let M=hr(k.strategy??{});M.type=i.strategyType,E.push({uid:A.uid,statusId:i.id,strategy:M,type:i.strategyType}),S.set(A.uid,A)});let x;if(E.length>0&&(x=await Pe(e,E)),S.size>0){let s=te(e),v=new Map(s.map(A=>[_r(A?.uid),A])),k=E.length>0&&!Array.isArray(x);S.forEach(A=>{let M=v.get(A.uid),T=St(M);if(!M||T!==i.id){f.push(yr(A,{reason:k?kr.API_ERROR:kr.STATUS_NOT_APPLIED}));return}h.push(yr(A,{newStatus:i.id}))})}let N=oo(i,h,f,w,n);return{ok:N.status===\"success\",targetStatusId:i.id,targetStatusLabel:i.label,targetStrategyType:i.strategyType,targetToastLabel:i.toastLabel??i.label,success:h,failed:f,ignored:w,summary:N,options:a}};var rl=e=>(t.pendingLorebookUpdates.has(e)||t.pendingLorebookUpdates.set(e,new Map),t.pendingLorebookUpdates.get(e)),$t=(e,r,o={})=>{if(!e||!o||typeof o!=\"object\")return;let a=_r(r),l=String(r),n=rl(e),i=n.get(l)??{uid:a,tempUid:a==null?l:null,data:{}};a!=null&&(i.uid=a),(!i.data||typeof i.data!=\"object\")&&(i.data={});let b={...o};Array.isArray(b.keys)&&(b.keys=el(b.keys)),Object.entries(b).forEach(([m,u])=>{u!==void 0&&(i.data[m]=u)}),n.set(l,i)},so=e=>{e!=null&&t.pendingRegexUpdates.add(e)},tl=(e,r,o)=>{let a=_r(o);if(!e||r==null||a==null)return;let l=t.pendingLorebookUpdates.get(e);if(!l||!(l instanceof Map))return;let n=String(r),i=l.get(n);if(!i)return;l.delete(n);let b=String(a),m=l.get(b)??{uid:a,tempUid:null,data:{}};m.uid=a,(!m.data||typeof m.data!=\"object\")&&(m.data={}),i.data&&typeof i.data==\"object\"&&(m.data={...i.data,...m.data}),l.set(b,m)},Mr=null,ol=async()=>{let e=ce(),r=be(),o=_e(),a=ge(),l=e(`#${ue}-content`,r);Br();let i=(()=>{l.html(`\n      <div class=\"rlh-loading\">\n        <div class=\"rlh-loading-spinner\" aria-hidden=\"true\"></div>\n        <div class=\"rlh-loading-text\">\n          <p class=\"rlh-loading-title\">\\u6B63\\u5728\\u52A0\\u8F7D\\u6570\\u636E...</p>\n          <p class=\"rlh-loading-status\">\\u521D\\u59CB\\u5316...</p>\n          <div class=\"rlh-loading-bar\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\">\n            <div class=\"rlh-loading-bar-inner\"></div>\n          </div>\n          <div class=\"rlh-loading-progress\">0%</div>\n          <p class=\"rlh-loading-detail\"></p>\n        </div>\n      </div>\n    `);let f=l.find(\".rlh-loading-status\"),w=l.find(\".rlh-loading-detail\"),E=l.find(\".rlh-loading-progress\"),S=l.find(\".rlh-loading-bar-inner\"),x=l.find(\".rlh-loading-bar\"),N=1,s=0,v=()=>{let k=Math.max(1,N),A=Math.min(s/k,1),M=Math.round(A*100);S.css(\"width\",`${M}%`),x.attr(\"aria-valuenow\",M),E.text(`${M}%`)};return v(),{setProgress(k,A,M,T){N=Math.max(1,A),s=Math.max(0,Math.min(k,N)),M&&f.text(M),T!==void 0&&w.text(T),v()},setStatus(k,A){k&&f.text(k),A!==void 0&&w.text(A)}}})(),b=4,m=0,u=(h,f)=>{m=Math.min(m+1,b),i.setProgress(m,b,h,f)};i.setProgress(m,b,\"\\u51C6\\u5907\\u52A0\\u8F7D\\u6570\\u636E...\",\"\\u6B63\\u5728\\u68C0\\u67E5\\u8FD0\\u884C\\u73AF\\u5883\");try{if(!o.SillyTavern||!o.SillyTavern.getContext){console.warn(\"[RegexLoreHub] SillyTavern API not available, initializing with empty data\"),t.regexes.global=[],t.regexes.character=[],t.allLorebooks=[],t.lorebooks.character=[],t.chatLorebook=null,ht(),t.isDataLoaded=!0,le();return}u(\"\\u83B7\\u53D6\\u57FA\\u7840\\u6570\\u636E...\",\"\\u6B63\\u5728\\u5411 SillyTavern \\u8BF7\\u6C42\\u6570\\u636E\");let h=o.SillyTavern?.getContext?.()||{},f=Array.isArray(h.characters)?h.characters:[],w=h.characterId!==void 0&&h.characterId!==null,E=h.chatId!==void 0&&h.chatId!==null,S=null,x=null,N=null,s=[G.getRegexes().catch(()=>[]),G.getGlobalWorldbookNames().catch(()=>[]),G.getWorldbooks().catch(()=>[])];w?(s.push(G.getCharData().catch(()=>null)),s.push(G.getCurrentCharWorldbookNames().catch(()=>null))):s.push(Promise.resolve(null),Promise.resolve(null)),E?s.push(G.getChatWorldbookName().catch(H=>(console.warn(\"[RegexLoreHub] Failed to get chat worldbook:\",H),null))):s.push(Promise.resolve(null));let v=await Promise.allSettled(s);u(\"\\u89E3\\u6790\\u6570\\u636E\\u7ED3\\u6784...\",`\\u68C0\\u6D4B\\u5230 ${f.length} \\u4E2A\\u89D2\\u8272\\uFF0C\\u6B63\\u5728\\u6574\\u7406\\u6570\\u636E`);let k=v[0].status===\"fulfilled\"?v[0].value:[],A=v[1].status===\"fulfilled\"?v[1].value:[],M=v[2].status===\"fulfilled\"?v[2].value:[];S=v[3]?.status===\"fulfilled\"?v[3].value:null,x=v[4]?.status===\"fulfilled\"?v[4].value:null,N=v[5]?.status===\"fulfilled\"?v[5].value:null,Br({charData:S}),t.regexes.global=Array.isArray(k)?k.filter(H=>H.scope===\"global\"):[],Xe(t.regexes.global),bo(k,S),ht(),t.pendingLorebookUpdates instanceof Map?t.pendingLorebookUpdates.clear():t.pendingLorebookUpdates=new Map,t.pendingRegexUpdates instanceof Set?t.pendingRegexUpdates.clear():t.pendingRegexUpdates=new Set,t.lorebookUsage.clear();let T=new Set(Array.isArray(M)?M:[]);if(Array.isArray(f)&&f.length>0)try{await Promise.all(f.map(async H=>{if(!(!H||!H.name))try{let V=null;try{let B=a.getCharWorldbookNames(H.name);B&&typeof B.then==\"function\"?V=await B:V=B}catch(B){console.warn(`[RegexLoreHub] Error getting worldbooks for character \"${H.name}\":`,B),V=null}if(V&&typeof V==\"object\"){let B=new Set;V.primary&&typeof V.primary==\"string\"&&B.add(V.primary),Array.isArray(V.additional)&&V.additional.forEach(Q=>typeof Q==\"string\"&&B.add(Q)),B.forEach(Q=>{typeof Q==\"string\"&&(t.lorebookUsage.has(Q)||t.lorebookUsage.set(Q,[]),t.lorebookUsage.get(Q).push(H.name),T.add(Q),console.log(`[RegexLoreHub] Character \"${H.name}\" uses worldbook \"${Q}\"`))})}}catch(V){console.warn(`[RegexLoreHub] Error processing character ${H.name}:`,V)}}))}catch(H){console.warn(\"[RegexLoreHub] Error processing characters:\",H)}let J=new Set(Array.isArray(A)?A:[]);t.allLorebooks=(Array.isArray(M)?M:[]).map(H=>({name:H,enabled:J.has(H),entryCount:0,enabledEntryCount:0,entriesLoaded:!1}));let de=new Set;x&&typeof x==\"object\"&&(x.primary&&typeof x.primary==\"string\"&&de.add(x.primary),Array.isArray(x.additional)&&x.additional.forEach(H=>typeof H==\"string\"&&de.add(H))),t.lorebooks.character=Array.from(de),t.chatLorebook=typeof N==\"string\"?N:null,typeof N==\"string\"&&T.add(N),u(\"\\u6784\\u5EFA\\u7D22\\u5F15...\",\"\\u4E16\\u754C\\u4E66\\u5217\\u8868\\u5DF2\\u52A0\\u8F7D\"),t.isDataLoaded=!0,u(\"\\u6E32\\u67D3\\u754C\\u9762...\",\"\\u6570\\u636E\\u52A0\\u8F7D\\u5B8C\\u6210\"),le(),il()}catch(h){throw console.error(\"[RegexLoreHub] Error in loadAllData:\",h),l.html(`\n                <div class=\"rlh-error-wrapper\">\n                    <p class=\"rlh-error-title\">\n                        <i class=\"fa-solid fa-exclamation-triangle\"></i> \\u6570\\u636E\\u52A0\\u8F7D\\u5931\\u8D25\n                    </p>\n                    <p class=\"rlh-error-text\">\n                        \\u8BF7\\u68C0\\u67E5\\u5F00\\u53D1\\u8005\\u63A7\\u5236\\u53F0\\u83B7\\u53D6\\u8BE6\\u7EC6\\u4FE1\\u606F\\uFF0C\\u6216\\u5C1D\\u8BD5\\u5237\\u65B0\\u9875\\u9762\\u3002\n                    </p>\n                    <button class=\"rlh-modal-btn rlh-error-retry-btn\" onclick=\"$('#${Er}').click()\">\n                        <i class=\"fa-solid fa-refresh\"></i> \\u91CD\\u8BD5\n                    </button>\n                </div>\n            `),h}},ze=R(async(e=!1)=>{if(e)t.isDataLoaded=!1;else if(t.isDataLoaded)return;if(!(Mr&&(await Mr,!e))){Mr=ol();try{await Mr}finally{Mr=null}}}),vt=!1,ll=3,lo=e=>new Promise(r=>setTimeout(r,e)),co=()=>{let e=ce(),r=be();if(!e||!r)return{};let o=e(`#${Pr}`,r);if(!o.length)return{};let a=o.find(`#${zr}`),l=o.find(`#${Fr}`),n=o.find(\".rlh-prefetch-bar\");return{$indicator:o,$text:a,$bar:l,$barContainer:n}},ho=e=>{let{$indicator:r,$bar:o,$barContainer:a}=co();r&&(r.attr(\"data-visible\",e?\"true\":\"false\"),r.attr(\"aria-hidden\",e?\"false\":\"true\"),e||(o?.length&&o.css(\"width\",\"0%\"),a?.length&&a.attr(\"aria-valuenow\",0)))},po=(e,r)=>{let{$indicator:o,$text:a,$bar:l,$barContainer:n}=co();if(!o)return;let i=r>0?r:1,b=Math.min(e,r),m=Math.round(b/i*100),u=`\\u540E\\u53F0\\u52A0\\u8F7D\\u4E16\\u754C\\u4E66 (${b}/${r})\\uFF0C\\u4E0D\\u5F71\\u54CD\\u5176\\u4ED6\\u64CD\\u4F5C`;a?.length&&a.text(u),l?.length&&l.css(\"width\",`${Math.min(m,100)}%`),n?.length&&n.attr(\"aria-valuenow\",Math.min(m,100))},_t=()=>{ho(!1)},al=e=>{let r=ce(),o=be();if(!r||!o)return;let a=r(`#${ue}`,o);if(!a.length)return;let l=a.find(\".rlh-book-group\").filter((i,b)=>r(b).data(\"book-name\")===e);if(!l.length)return;let n=t.allLorebooks.find(i=>i.name===e);n&&l.find(\".rlh-book-stats\").text(`\\u6761\\u76EE: ${n.enabledEntryCount} / ${n.entryCount}`)},nl=e=>{if(e<=0){_t();return}ho(!0),po(0,e)},il=R(async()=>{if(vt)return;let e=t.allLorebooks.filter(r=>!r.entriesLoaded);if(e.length===0){_t();return}vt=!0,nl(e.length);try{let r=0,o=[...e],a=async()=>{for(;o.length>0;){let n=o.shift();if(!n)break;try{await Le(n.name),al(n.name)}finally{r+=1,po(r,e.length)}await lo(30)}},l=Math.min(ll,o.length);await Promise.all(Array.from({length:l},()=>a()))}finally{await lo(260),_t(),vt=!1}}),uo=R(async()=>{let r=_e().SillyTavern?.getContext?.()||{},o=r.chatId!==void 0&&r.chatId!==null,a=[G.getCharData(),G.getCurrentCharWorldbookNames(),G.getRegexes()];o?a.push(G.getChatWorldbookName().catch(u=>(console.warn(\"[RegexLoreHub] Failed to get chat worldbook in refreshCharacterData:\",u),null))):a.push(Promise.resolve(null));let[l,n,i,b]=await Promise.all(a);bo(i,l),Br({charData:l}),sl(n),t.chatLorebook=b;let m=t.lorebooks.character.filter(u=>!pt(u));m.length>0&&await Promise.all(m.map(async u=>{let h=await G.getWorldbook(u);Ae(u,h.map(Ze))}))});function bo(e,r){let o=e?.filter(i=>i.scope===\"character\")||[],a=[];if(r&&G.Character)try{a=(new G.Character(r).getRegexScripts()||[]).map((b,m)=>({id:b.id||`card-${Date.now()}-${m}`,script_name:b.scriptName||\"\\u672A\\u547D\\u540D\\u5361\\u5185\\u6B63\\u5219\",find_regex:b.findRegex,replace_string:b.replaceString,enabled:!b.disabled,scope:\"character\",source:\"card\"}))}catch(i){console.warn(\"\\u65E0\\u6CD5\\u89E3\\u6790\\u89D2\\u8272\\u5361\\u6B63\\u5219\\u811A\\u672C:\",i)}let l=new Set(o.map(i=>`${i.script_name}::${i.find_regex}::${i.replace_string}`)),n=a.filter(i=>{let b=`${i.script_name}::${i.find_regex}::${i.replace_string}`;return!l.has(b)});t.regexes.character=[...o,...n],Xe(t.regexes.character)}function sl(e){let r=[];e&&(e.primary&&r.push(e.primary),e.additional&&r.push(...e.additional)),t.lorebooks.character=[...new Set(r)]}var pr=e=>{let r=te(e),o=t.allLorebooks.find(a=>a.name===e);o&&(o.entryCount=r.length,o.enabledEntryCount=r.filter(a=>a.enabled).length)},mo=e=>{let r={uid:`temp-${Date.now()}`,name:\"\\u65B0\\u6761\\u76EE\",comment:\"\",content:\"\",keys:[],key:[],keysecondary:[],statusId:Wr,enabled:!0,disable:!1,is_temp:!0,selective:!0,selectiveLogic:rt.and_any,logic:\"and_any\",constant:!1,position:\"before_character_definition\",depth:null,order:0,probability:100,useProbability:!1,case_sensitive:!1,match_whole_words:!1,prevent_recursion:!1,exclude_recursion:!1,type:Te?.strategyType??\"constant\",strategy:{type:Te?.strategyType??\"constant\",keys:[],keys_secondary:{logic:\"and_any\",keys:[]},scan_depth:\"same_as_global\"}},o=te(e);return o.unshift(r),Ae(e,o),r},fo=(e,r,o)=>{let a=te(e),l=a.findIndex(n=>n.uid===r);if(l!==-1){let n=Ze(o),i={...a[l],...n,is_temp:!1};a[l]=i,Ae(e,a),tl(e,r,i.uid)}else console.warn(`[RegexLoreHub] \\u5728\\u66F4\\u65B0\\u65F6\\u627E\\u4E0D\\u5230\\u4E34\\u65F6\\u6761\\u76EE: ${r}`)},Le=R(async(e,r=!1)=>{let o=t.allLorebooks.find(a=>a.name===e);if(!(!o||pt(e)&&!r))try{let a=await G.getWorldbook(e);a=a.map(Ze),Ae(e,a),o.entriesLoaded=!0,pr(e)}catch(a){console.error(`[RegexLoreHub] Failed to load entries for worldbook \"${e}\":`,a),o.entriesLoaded=!0}}),nr=R(async(e={})=>{let{silent:r=!1}=e,o=3,a=3e3,l=0,n=h=>new Promise(f=>setTimeout(f,h)),i=()=>{r?Jr():le()},b=async()=>{if(!(t.pendingLorebookUpdates instanceof Map))return t.pendingLorebookUpdates=new Map,!1;let h=!1;for(let[f,w]of[...t.pendingLorebookUpdates.entries()]){if(!(w instanceof Map)||w.size===0)continue;let E=[],S=[];for(let[N,s]of w.entries()){let v=s?.uid;if(typeof v!=\"number\"||Number.isNaN(v))continue;let k=s?.data;if(!k||Object.keys(k).length===0){S.push(N);continue}E.push({uid:v,...k}),S.push(N)}if(E.length===0){S.forEach(N=>w.delete(N)),w.size===0&&t.pendingLorebookUpdates.delete(f);continue}await Pe(f,E)&&(h=!0,S.forEach(N=>w.delete(N)),w.size===0&&t.pendingLorebookUpdates.delete(f))}return h},m=async()=>{if(!(t.pendingRegexUpdates instanceof Set))return t.pendingRegexUpdates=new Set,!1;if(t.pendingRegexUpdates.size===0)return!1;Xe(t.regexes.global),Xe(t.regexes.character);let h=[...t.regexes.global,...t.regexes.character];return await G.replaceRegexes(h.filter(f=>f.source!==\"card\")),await G.saveSettings(),t.pendingRegexUpdates.clear(),!0},u=async()=>{console.log(\"[RegexLoreHub] \\u6267\\u884C\\u7EDF\\u4E00\\u4FDD\\u5B58\\u64CD\\u4F5C...\");let h=await b(),f=await m();return console.log(!h&&!f?\"[RegexLoreHub] \\u6CA1\\u6709\\u5F85\\u4FDD\\u5B58\\u7684\\u66F4\\u6539\\u3002\":\"[RegexLoreHub] \\u4FDD\\u5B58\\u64CD\\u4F5C\\u5B8C\\u6210\\u3002\"),!0};for(;l<o;)try{t.saveRetryAttempt=l+1,t.saveStatus=l===0?\"saving\":\"retrying\",i(),await u(),t.saveStatus=\"success\",t.saveRetryAttempt=0,i(),await n(1500),t.saveStatus=\"idle\",i(),console.log(\"[RegexLoreHub] \\u6240\\u6709\\u66F4\\u6539\\u5DF2\\u6210\\u529F\\u4FDD\\u5B58\\u3002\");return}catch(h){if(l++,console.error(`[RegexLoreHub] \\u4FDD\\u5B58\\u5931\\u8D25\\uFF0C\\u5C1D\\u8BD5\\u6B21\\u6570 ${l}/${o}:`,h),l>=o)throw t.saveStatus=\"failed\",i(),console.error(\"[RegexLoreHub] \\u6240\\u6709\\u91CD\\u8BD5\\u5747\\u5931\\u8D25\\uFF0C\\u5DF2\\u505C\\u6B62\\u4FDD\\u5B58\\u3002\"),new Error(\"\\u81EA\\u52A8\\u4FDD\\u5B58\\u5931\\u8D25\\uFF0C\\u8BF7\\u68C0\\u67E5\\u8FDE\\u63A5\\u6216\\u624B\\u52A8\\u4FDD\\u5B58\\u3002\");await n(a)}}),Oe=e=>{if(typeof e!=\"string\")return null;let r=e.trim();return r.length>0?r:null},yt=e=>!e||typeof e!=\"object\"?null:Oe(e.name)||Oe(e.display_name)||Oe(e.title)||Oe(e.metadata?.name)||Oe(e.filename)||Oe(e.external_id),cl=e=>!e||typeof e!=\"object\"?null:Oe(e.name)||Oe(e.char_name)||Oe(e.display_name)||Oe(e.metadata?.name)||Oe(e.data?.name)||Oe(e.data?.char_name)||Oe(e.data?.display_name),dl=(e,r)=>{if(!e||r===void 0||r===null)return!1;let o=String(r);return[e.id,e.characterId,e.metadata?.characterId,e.metadata?.id,e.external_id,e.filename].map(l=>l==null?null:String(l)).some(l=>l&&l===o)},Br=({charData:e=null}={})=>{let o=_e().SillyTavern?.getContext?.()||{},a=Array.isArray(o.characters)?o.characters:[],l=o.characterId!==void 0&&o.characterId!==null?o.characterId:null,n=Oe(o.name)||yt(o.character);if(!n&&l!==null){let i=a.find(b=>dl(b,l));i&&(n=yt(i))}!n&&e&&(n=cl(e)),!n&&a.length===1&&(n=yt(a[0])),t.characterContext.name=n??null,t.characterContext.id=l,console.log(\"[RegexLoreHub] Context synced with appState:\",t.characterContext)};function go(e={}){let r=e.$??ce(),o=e.parentDoc??be(),a=e.parentWin??_e(),l=async(s,{showLoading:v=!0}={})=>{let k=(s??\"\").toString().trim();if(!k)return;let A=t.loadingBookName;try{v&&(t.loadingBookName=k,le()),await Le(k,!0)}finally{t.loadingBookName=A&&A!==k?A:null,le()}},n=R(async s=>{t.activeView=\"global-lore-detail\",t.activeBookName=s,t.loadingBookName=s,le(),await Le(s),t.loadingBookName=null,le()}),i=R(async()=>{t.activeView=\"global-lore-list\",t.activeBookName=null,t.selectedItems.clear(),t.globalSearch={term:\"\",replace:\"\"};let s=r(\"#rlh-global-search-input\",o);s.length&&s.val(\"\"),le()}),b=R(async(s,v,k)=>{let A=t.lorebookUsage.get(s)||[];if(A.length===0)return;let M=a.SillyTavern.getContext(),T=M.characterId,J=0,de=A.length;k.update(`\\u6B63\\u5728\\u66F4\\u65B0 ${de} \\u4E2A\\u5173\\u8054\\u89D2\\u8272... (0/${de})`);for(let H of A){try{let V=a.Character?.findCharacterIndex?.(H)??M.characters.findIndex(he=>he.name===H);if(V===-1){console.warn(`[RegexLoreHub] Character \"${H}\" not found, skipping...`);continue}console.log(`[RegexLoreHub] Switching to character \"${H}\" (index: ${V})`),await M.selectCharacterById(V);let B=await G.getCharWorldbookNames({name:H});if(!B){console.warn(`[RegexLoreHub] Failed to get worldbooks for character \"${H}\"`);continue}console.log(`[RegexLoreHub] Current worldbooks for \"${H}\":`,B);let Q=!1;if(B.primary===s&&(console.log(`[RegexLoreHub] Updating primary lorebook from \"${s}\" to \"${v}\"`),B.primary=v,Q=!0),B.additional){let he=B.additional.indexOf(s);he>-1&&(console.log(`[RegexLoreHub] Updating additional lorebook at index ${he} from \"${s}\" to \"${v}\"`),B.additional[he]=v,Q=!0)}Q?(console.log(`[RegexLoreHub] Saving updated lorebooks for \"${H}\":`,B),await G.rebindCharWorldbooks(B),console.log(`[RegexLoreHub] Successfully updated lorebooks for \"${H}\"`)):console.log(`[RegexLoreHub] No updates needed for character \"${H}\"`)}catch(V){console.error(`[RegexLoreHub] Failed to update lorebook for character \"${H}\":`,V)}J++,k.update(`\\u6B63\\u5728\\u66F4\\u65B0 ${de} \\u4E2A\\u5173\\u8054\\u89D2\\u8272... (${J}/${de})`)}M.characterId!==T&&await M.selectCharacterById(T)}),m=R(async s=>{s.stopPropagation();let k=r(s.currentTarget).closest(\".rlh-book-group, .rlh-detail-view\"),A=k.hasClass(\"rlh-detail-view\"),M=k.data(\"book-name\")||t.activeBookName;if(!M)return;let T;try{T=await X({type:\"prompt\",title:\"\\u91CD\\u547D\\u540D\\u4E16\\u754C\\u4E66\",text:\"\\u8BF7\\u8F93\\u5165\\u65B0\\u7684\\u4E16\\u754C\\u4E66\\u540D\\u79F0\\uFF1A\",value:M})}catch{return}if(T=T.trim(),!T||T===M)return;if(t.allLorebooks.some(he=>he.name===T)){await X({type:\"alert\",title:\"\\u91CD\\u547D\\u540D\\u5931\\u8D25\",text:\"\\u8BE5\\u540D\\u79F0\\u7684\\u4E16\\u754C\\u4E66\\u5DF2\\u5B58\\u5728\\uFF0C\\u8BF7\\u9009\\u62E9\\u5176\\u4ED6\\u540D\\u79F0\\u3002\"});return}let J=t.lorebookUsage.get(M)||[],de=t.chatLorebook===M,H=de?1:0,V=J.length+H;console.log(`[RegexLoreHub] Renaming lorebook \"${M}\" to \"${T}\", linked characters:`,J,\"chat linked:\",de);let B=`\\u6B64\\u64CD\\u4F5C\\u5C06\\u66F4\\u65B0 ${V} \\u4E2A\\u7ED1\\u5B9A\\u5173\\u7CFB`;J.length>0&&(B+=`\\uFF0C\\u9700\\u8981\\u4E34\\u65F6\\u5207\\u6362\\u5230 ${J.length} \\u4E2A\\u5173\\u8054\\u89D2\\u8272\\u5361\\u6765\\u66F4\\u65B0\\u4E16\\u754C\\u4E66\\u94FE\\u63A5`),B+=`\\uFF0C\\u671F\\u95F4\\u8BF7\\u52FF\\u64CD\\u4F5C\\u3002\n\n`,J.length>0&&(B+=`\\u5173\\u8054\\u89D2\\u8272\\u5361\\uFF1A${J.join(\", \")}\n`),de&&(B+=`\\u5173\\u8054\\u804A\\u5929\\uFF1A\\u5F53\\u524D\\u804A\\u5929\n`),t.activeTab===\"global-lore\"&&(B+=`\n\\u26A0\\uFE0F \\u91CD\\u8981\\u63D0\\u793A\\uFF1A\\u7531\\u4E8ESillyTavern API\\u9650\\u5236\\uFF0C\\u65E0\\u6CD5\\u76F4\\u63A5\\u5217\\u51FA\\u6240\\u6709*\\u804A\\u5929\\u4E16\\u754C\\u4E66*\\u7ED1\\u5B9A\\u3002\\u5982\\u679C\\u6B64\\u4E16\\u754C\\u4E66\\u4E0E*\\u804A\\u5929*\\u7ED1\\u5B9A\\uFF0C\\u91CD\\u547D\\u540D\\u540E\\u9700\\u8981\\u624B\\u52A8\\u68C0\\u67E5\\u90A3\\u4E9B\\u804A\\u5929\\u7ED1\\u5B9A\\u72B6\\u6001\\u3002\n`),B+=`\n\\u662F\\u5426\\u7EE7\\u7EED\\uFF1F`;try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u91CD\\u547D\\u540D\",text:B})}catch{return}let Q=or(\"\\u5F00\\u59CB\\u91CD\\u547D\\u540D...\");try{if(Q.update(\"\\u6B63\\u5728\\u521B\\u5EFA\\u65B0\\u4E16\\u754C\\u4E66...\"),!await G.createWorldbook(T))throw new Error(\"\\u521B\\u5EFA\\u65B0\\u4E16\\u754C\\u4E66\\u6587\\u4EF6\\u5931\\u8D25\\u3002\");let ae=[...te(M)];if(ae.length>0){Q.update(\"\\u6B63\\u5728\\u590D\\u5236\\u6761\\u76EE...\");let c=ae.map(g=>{let y={...g};return delete y.uid,y});await G.createWorldbookEntries(T,c)}await b(M,T,Q),Q.update(\"\\u6B63\\u5728\\u66F4\\u65B0\\u5168\\u5C40\\u8BBE\\u7F6E...\");let se=await G.getGlobalWorldbookNames();if(se&&se.includes(M)){let c=se.map(y=>y===M?T:y);await G.rebindGlobalWorldbooks(c),console.log(`[RegexLoreHub] Updated global lorebook settings from \"${M}\" to \"${T}\"`);let g=await G.getGlobalWorldbookNames();(!g||!g.includes(T))&&console.warn(`[RegexLoreHub] Global lorebook settings update verification failed for \"${T}\"`)}if(t.chatLorebook===M){Q.update(\"\\u6B63\\u5728\\u66F4\\u65B0\\u804A\\u5929\\u7ED1\\u5B9A...\"),await G.rebindChatWorldbook(T),t.chatLorebook=T,console.log(`[RegexLoreHub] Updated chat lorebook from \"${M}\" to \"${T}\"`);try{let c=await G.getChatWorldbookName();c!==T&&(console.warn(`[RegexLoreHub] Chat lorebook update verification failed. Expected: \"${T}\", Got: \"${c}\"`),t.chatLorebook=c)}catch(c){console.warn(\"[RegexLoreHub] Failed to verify chat lorebook update:\",c)}}if(Q.update(\"\\u6B63\\u5728\\u66F4\\u65B0\\u5185\\u90E8\\u6620\\u5C04...\"),t.lorebookUsage.has(M)){let c=t.lorebookUsage.get(M);t.lorebookUsage.delete(M),t.lorebookUsage.set(T,c),console.log(`[RegexLoreHub] Updated lorebookUsage mapping from \"${M}\" to \"${T}\"`)}Q.update(\"\\u6B63\\u5728\\u5220\\u9664\\u65E7\\u4E16\\u754C\\u4E66...\"),await G.deleteWorldbook(M),Q.update(\"\\u6B63\\u5728\\u5237\\u65B0\\u6570\\u636E...\");let re=t.chatLorebook;await ze(!0),re&&t.chatLorebook!==re&&(console.log(`[RegexLoreHub] Restoring chat lorebook state after data refresh: \"${re}\"`),t.chatLorebook=re);try{let c=a.SillyTavern.getContext()||{};if(c.chatId!==void 0&&c.chatId!==null){let y=await G.getChatWorldbookName();y!==t.chatLorebook&&(console.log(`[RegexLoreHub] Final chat lorebook sync: \"${y}\"`),t.chatLorebook=y)}}catch(c){console.warn(\"[RegexLoreHub] Failed to sync final chat lorebook state:\",c)}Q.remove(),me(\"\\u4E16\\u754C\\u4E66\\u91CD\\u547D\\u540D\\u6210\\u529F\"),A?await n(T):le()}catch(he){Q.remove(),console.error(\"[RegexLoreHub] Rename failed:\",he),await X({type:\"alert\",title:\"\\u91CD\\u547D\\u540D\\u5931\\u8D25\",text:`\\u64CD\\u4F5C\\u5931\\u8D25: ${he.message}`}),t.allLorebooks.some(se=>se.name===T)&&await G.deleteWorldbook(T);let ae=t.chatLorebook;await ze(!0),ae&&t.chatLorebook!==ae&&(console.log(`[RegexLoreHub] Restoring chat lorebook state after error recovery: \"${ae}\"`),t.chatLorebook=ae);try{let se=a.SillyTavern.getContext()||{};if(se.chatId!==void 0&&se.chatId!==null){let c=await G.getChatWorldbookName();c!==t.chatLorebook&&(console.log(`[RegexLoreHub] Final chat lorebook sync after error recovery: \"${c}\"`),t.chatLorebook=c)}}catch(se){console.warn(\"[RegexLoreHub] Failed to sync chat lorebook state after error recovery:\",se)}}}),u=R(async(s,v=\"\")=>{let k;try{k=await X({type:\"prompt\",title:\"\\u65B0\\u5EFA\\u4E16\\u754C\\u4E66\",text:\"\\u8BF7\\u8F93\\u5165\\u65B0\\u4E16\\u754C\\u4E66\\u7684\\u540D\\u79F0:\",value:v})}catch{return}if(k=k.trim(),!k)return;if(t.allLorebooks.some(M=>M.name===k))return await X({type:\"alert\",title:\"\\u9519\\u8BEF\",text:\"\\u5DF2\\u5B58\\u5728\\u540C\\u540D\\u4E16\\u754C\\u4E66\\u3002\"}),u(s,k);let A=s?r(s.currentTarget):null;A&&A.prop(\"disabled\",!0).addClass(\"rlh-loading\");try{await G.createWorldbook(k)?(t.allLorebooks.push({name:k,enabled:!1,entryCount:0,enabledEntryCount:0,entriesLoaded:!0}),await n(k)):await X({type:\"alert\",title:\"\\u521B\\u5EFA\\u5931\\u8D25\",text:\"\\u521B\\u5EFA\\u4E16\\u754C\\u4E66\\u65F6\\u53D1\\u751F\\u9519\\u8BEF\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u3002\"})}finally{A&&A.prop(\"disabled\",!1).removeClass(\"rlh-loading\")}}),h=R(async s=>{s.stopPropagation();let k=r(s.currentTarget).closest(\".rlh-book-group, .rlh-detail-view\"),A=k.data(\"book-name\")||t.activeBookName;if(!A)return;let M=k.hasClass(\"rlh-detail-view\");try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u5220\\u9664\",text:`\\u60A8\\u786E\\u5B9A\\u8981\\u6C38\\u4E45\\u5220\\u9664\\u4E16\\u754C\\u4E66 \"${A}\" \\u5417\\uFF1F\\u6B64\\u64CD\\u4F5C\\u65E0\\u6CD5\\u64A4\\u9500\\u3002`})}catch{return}await G.deleteWorldbook(A)?(t.allLorebooks=t.allLorebooks.filter(J=>J.name!==A),Nr(A),t.lorebookUsage instanceof Map&&t.lorebookUsage.has(A)&&t.lorebookUsage.delete(A),Array.isArray(t.lorebooks?.character)&&(t.lorebooks.character=t.lorebooks.character.filter(J=>J!==A)),t.chatLorebook===A&&(t.chatLorebook=null),t.activeCharacterBook===A&&(t.activeCharacterBook=null),t.activeBookName===A&&(t.activeBookName=null),M?await i():le(),me(\"\\u5220\\u9664\\u6210\\u529F\")):await X({type:\"alert\",title:\"\\u5220\\u9664\\u5931\\u8D25\",text:\"\\u5220\\u9664\\u4E16\\u754C\\u4E66\\u65F6\\u53D1\\u751F\\u9519\\u8BEF\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u3002\"})}),f=R(async s=>{let k=(r(s.currentTarget).data(\"book-name\")??\"\").toString().trim(),A=Ne(),T=[k,A?.activeBookName??\"\",t.activeBookName??\"\",t.activeCharacterBook??\"\",t.chatLorebook??\"\"].find(H=>typeof H==\"string\"&&H.trim().length>0)?.trim()??\"\";if(!T){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u9009\\u62E9\\u6216\\u6253\\u5F00\\u4E00\\u4E2A\\u4E16\\u754C\\u4E66\\u3002\"});return}let J=[...te(T)];if((!J||J.length===0)&&(await Le(T),J=[...te(T)]),!J||J.length===0){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BE5\\u4E16\\u754C\\u4E66\\u6CA1\\u6709\\u6761\\u76EE\\u53EF\\u64CD\\u4F5C\\u3002\"});return}try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u64CD\\u4F5C\",text:`\\u786E\\u5B9A\\u8981\\u4E3A \"${T}\" \\u4E2D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u5F00\\u542F\\u201C\\u9632\\u6B62\\u9012\\u5F52\\u201D\\u548C\\u201C\\u4E0D\\u53EF\\u88AB\\u9012\\u5F52\\u201D\\u5417\\uFF1F\\u6B64\\u64CD\\u4F5C\\u4F1A\\u963B\\u6B62\\u4E16\\u754C\\u4E66\\u6761\\u76EE\\u5F7C\\u6B64\\u89E6\\u53D1\\u3002`})}catch{return}let de=J.map(H=>({uid:H.uid,prevent_recursion:!0,exclude_recursion:!0}));await Pe(T,de),J.forEach(H=>{H.prevent_recursion=!0,H.exclude_recursion=!0,(!H.recursion||typeof H.recursion!=\"object\")&&(H.recursion={}),H.recursion.prevent_outgoing=!0,H.recursion.prevent_incoming=!0}),de.forEach(H=>{let V=r(`#rlh-panel-content .rlh-item-container[data-book-name=\"${T}\"][data-id=\"${H.uid}\"] .rlh-collapsible-content:visible`,o);V.length&&(V.find(\".rlh-edit-prevent-recursion\").prop(\"checked\",!0),V.find(\".rlh-edit-exclude-recursion\").prop(\"checked\",!0))}),me(\"\\u5DF2\\u4E3A\\u6240\\u6709\\u6761\\u76EE\\u5F00\\u542F\\u201C\\u9632\\u6B62\\u9012\\u5F52\\u201D\\u548C\\u201C\\u4E0D\\u53EF\\u88AB\\u9012\\u5F52\\u201D\"),await l(T)}),w=R(async s=>{let k=(r(s.currentTarget).data(\"book-name\")??\"\").toString().trim(),A=Ne(),T=[k,A?.activeBookName??\"\",t.activeBookName??\"\",t.activeCharacterBook??\"\",t.chatLorebook??\"\"].find(V=>typeof V==\"string\"&&V.trim().length>0)?.trim()??\"\";if(!T){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u9009\\u62E9\\u6216\\u6253\\u5F00\\u4E00\\u4E2A\\u4E16\\u754C\\u4E66\\u3002\"});return}let J=[...te(T)];if((!J||J.length===0)&&(await Le(T),J=[...te(T)]),!J||J.length===0){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BE5\\u4E16\\u754C\\u4E66\\u6CA1\\u6709\\u6761\\u76EE\\u53EF\\u64CD\\u4F5C\\u3002\"});return}try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u64CD\\u4F5C\",text:`\\u786E\\u5B9A\\u8981\\u4E3A \"${T}\" \\u4E2D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u4FEE\\u590D\\u5173\\u952E\\u8BCD\\uFF08\\u5C06\\u4E2D\\u6587\\u9017\\u53F7\\u66FF\\u6362\\u4E3A\\u82F1\\u6587\\u9017\\u53F7\\uFF09\\u5417\\uFF1F`})}catch{return}let de=0,H=J.map(V=>{let B=(V.keys||[]).join(\", \"),he=B.replace(/，/g,\",\").replace(/,+/g,\",\").trim().split(\",\").map(se=>se.trim()).filter(Boolean),ae=he.join(\", \");return B!==ae?(de++,{uid:V.uid,keys:he}):null}).filter(Boolean);H.length>0?(await Pe(T,H),H.forEach(V=>{let B=J.find(Q=>Q.uid===V.uid);B&&(B.keys=V.keys)}),H.forEach(V=>{let B=r(`#rlh-panel-content .rlh-item-container[data-book-name=\"${T}\"][data-id=\"${V.uid}\"] .rlh-collapsible-content:visible`,o);B.length&&B.find(\".rlh-edit-keys\").val(V.keys.join(\", \"))}),me(`\\u6210\\u529F\\u4FEE\\u590D\\u4E86 ${de} \\u4E2A\\u6761\\u76EE\\u7684\\u5173\\u952E\\u8BCD`),await l(T)):await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u6240\\u6709\\u6761\\u76EE\\u7684\\u5173\\u952E\\u8BCD\\u683C\\u5F0F\\u90FD\\u6B63\\u786E\\uFF0C\\u65E0\\u9700\\u4FEE\\u590D\\u3002\"})}),E=R(async({bookName:s,positionValue:v})=>{let k=(v??\"\").toString().trim();if(!k)return;let A=Ne(),T=[s,A?.activeBookName??\"\",t.activeBookName??\"\",t.activeCharacterBook??\"\",t.chatLorebook??\"\"].find(re=>typeof re==\"string\"&&re.trim().length>0)?.trim()??\"\";if(!T){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u9009\\u62E9\\u6216\\u6253\\u5F00\\u4E00\\u4E2A\\u4E16\\u754C\\u4E66\\u3002\"});return}let J=[...te(T)];if(J.length||(await Le(T),J=[...te(T)]),!J.length){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BE5\\u4E16\\u754C\\u4E66\\u6CA1\\u6709\\u6761\\u76EE\\u53EF\\u64CD\\u4F5C\\u3002\"});return}let de=t.multiSelectMode&&t.multiSelectTarget===\"entry\",H=J;if(de){let re=`lore:${T}:`,c=new Set;if(t.selectedItems.forEach(g=>{if(typeof g!=\"string\"||!g.startsWith(re))return;let y=g.slice(re.length),_=Number(y);Number.isFinite(_)&&c.add(_)}),c.size===0){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u5DF2\\u5F00\\u542F\\u591A\\u9009\\uFF0C\\u8BF7\\u5148\\u52FE\\u9009\\u8981\\u7EDF\\u4E00\\u4F4D\\u7F6E\\u7684\\u6761\\u76EE\\u3002\"});return}if(H=J.filter(g=>c.has(Number(g?.uid))),!H.length){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u672A\\u80FD\\u5339\\u914D\\u5230\\u5DF2\\u9009\\u62E9\\u7684\\u6761\\u76EE\\uFF0C\\u8BF7\\u91CD\\u65B0\\u9009\\u62E9\\u540E\\u518D\\u8BD5\\u3002\"});return}}let V=Ke.position?.[k]??k,B=H.filter(re=>(re?.position??\"\").toString()!==k).map(re=>({uid:re.uid,position:k}));if(!B.length){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:`${de?\"\\u6240\\u9009\\u6761\\u76EE\":\"\\u6240\\u6709\\u6761\\u76EE\"}\\u7684\\u4F4D\\u7F6E\\u5DF2\\u7ECF\\u662F\\u300C${V}\\u300D\\u3002`});return}try{let re=H.length,c=de?\"\\u9009\\u4E2D\\u7684\\u6761\\u76EE\":`\"${T}\" \\u4E2D\\u7684\\u6761\\u76EE`;await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u64CD\\u4F5C\",text:`\\u786E\\u5B9A\\u8981\\u5C06 ${c}\\uFF08\\u5171 ${re} \\u4E2A\\uFF09\\u8BBE\\u7F6E\\u4E3A\\u300C${V}\\u300D\\u5417\\uFF1F`})}catch{return}await Pe(T,B);let Q=te(T),he=new Set(Q.map(re=>(re?.position??\"before_character_definition\").toString())),ae=he.size===1?he.values().next().value:null;B.forEach(re=>{let c=`#rlh-panel-content .rlh-item-container[data-book-name=\"${T}\"][data-id=\"${re.uid}\"]`,g=r(c,o);if(g.length){let y=g.find(\".rlh-edit-position\");y.length&&y.val(k).trigger(\"change\")}});let se=r(`#${Qe}`,o);if(se.length){se.attr(\"data-book-name\",T);let re=r(`#${qe}`,o);re.length&&(re.removeAttr(\"disabled\"),re.attr(\"data-book-name\",T)),se.find(\".rlh-position-option\").each(function(){let g=r(this),y=(g.data(\"position-value\")??\"\").toString(),_=ae&&y===ae;g.toggleClass(\"active\",_),g.attr(\"aria-selected\",_?\"true\":\"false\"),g.attr(\"data-book-name\",T)})}me(`\\u5DF2\\u66F4\\u65B0 ${B.length} \\u4E2A\\u6761\\u76EE\\u7684\\u4F4D\\u7F6E\\u4E3A\\u300C${V}\\u300D`),await l(T)}),S=R(async()=>{let s=await G.getOrCreateChatWorldbook();s?(me(`\\u5DF2\\u521B\\u5EFA\\u5E76\\u7ED1\\u5B9A\\u804A\\u5929\\u4E16\\u754C\\u4E66: ${s}`),await ze(!0)):await X({type:\"alert\",title:\"\\u64CD\\u4F5C\\u5931\\u8D25\",text:\"\\u65E0\\u6CD5\\u521B\\u5EFA\\u6216\\u7ED1\\u5B9A\\u804A\\u5929\\u4E16\\u754C\\u4E66\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u3002\"})}),x=R(async()=>{let s=t.chatLorebook;if(s){try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u89E3\\u9664\\u7ED1\\u5B9A\",text:`\\u60A8\\u786E\\u5B9A\\u8981\\u89E3\\u9664\\u4E0E\\u804A\\u5929\\u4E16\\u754C\\u4E66 \"${s}\" \\u7684\\u7ED1\\u5B9A\\u5417\\uFF1F\\u4E16\\u754C\\u4E66\\u672C\\u8EAB\\u4E0D\\u4F1A\\u88AB\\u5220\\u9664\\u3002`})}catch{return}await G.rebindChatWorldbook(null),t.chatLorebook=null,me(\"\\u5DF2\\u89E3\\u9664\\u7ED1\\u5B9A\"),le()}}),N=R(async()=>{let s=t.activeBookName;s&&(t.loadingBookName=s,le(),await Le(s,!0),t.loadingBookName=null,le())});return{handleEnterLorebookDetail:n,handleExitLorebookDetail:i,handleRefreshLorebookDetail:N,handleCreateLorebook:u,handleDeleteLorebook:h,handleRenameBook:m,handleBatchSetRecursion:f,handleFixKeywords:w,applyUnifiedPosition:E,handleCreateChatLorebook:S,handleUnlinkChatLorebook:x}}function xo(e={}){let r=e.$??ce(),o=e.parentDoc??be(),a=c=>{let g=String(c),y=t.regexes.global.find(_=>String(_.id)===g);return y||(t.regexes.character.find(_=>String(_.id)===g)??null)},l=(c,g,y)=>{if(!c||!g)return;let _=y;if(typeof _!=\"boolean\"&&(_=_??\"\"),g===\"min_depth\"||g===\"max_depth\"){let O=parseInt(_,10);_=Number.isNaN(O)?null:O}let z=g.split(\".\");if(z.length===1){c[z[0]]=_;return}let I=c;for(let O=0;O<z.length-1;O++){let K=z[O];(!I[K]||typeof I[K]!=\"object\")&&(I[K]={}),I=I[K]}I[z[z.length-1]]=_},n=ut(()=>nr({silent:!0}),1e3),i=R(async c=>{let g=r(c.currentTarget),y=g.closest(\".rlh-item-container\"),_=y.data(\"type\"),z=y.data(\"id\"),I=Number(z),O=g.data(\"field\");if(O){if(_===\"lore\"){let K=y.data(\"book-name\"),q=te(K).find(fe=>{let ve=fe?.uid;return typeof ve==\"number\"&&!Number.isNaN(I)?ve===I:String(ve)===String(z)});if(!q)return;let ee;if(g.is(\":checkbox\"))ee=g.is(\":checked\");else if(g.is('[contenteditable=\"true\"]')){let fe=g.get(0);if(fe){let ve=new Set([\"div\",\"p\",\"li\",\"ul\",\"ol\",\"blockquote\",\"pre\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"table\",\"tr\"]),Ie=[],Fe=ye=>{ye&&Ie.push(ye)},Se=()=>{if(!Ie.length){Ie.push(`\n`);return}Ie[Ie.length-1]?.endsWith(`\n`)||Ie.push(`\n`)},Be=ye=>{if(!ye)return;let Ye=ye.nodeType;if(Ye===Node.TEXT_NODE){Fe(ye.nodeValue||\"\");return}if(Ye!==Node.ELEMENT_NODE)return;let Ce=ye.nodeName.toLowerCase();if(Ce===\"br\"){Ie.push(`\n`);return}Ce===\"style\"||Ce===\"script\"||(ye.childNodes.forEach(ur=>Be(ur)),ve.has(Ce)&&Se())};Be(fe),ee=Ie.join(\"\"),ee=ee.replace(/\\u00a0/g,\" \"),ee=ee.replace(/\\r?\\n/g,`\n`)}else ee=\"\"}else ee=g.val();if(O===\"statusId\"){let fe=Ge(ee)??Te;q.statusId=fe.id,(!q.strategy||typeof q.strategy!=\"object\")&&(q.strategy={}),q.strategy.type=fe.strategyType,q.type=fe.strategyType,$t(K,q.uid??z,{statusId:fe.id,strategy:{...q.strategy??{},type:fe.strategyType},type:fe.strategyType}),Xr(K,q.uid??z,fe.id),n();return}if(O===\"keys\")q.keys=ee.split(\",\").map(fe=>fe.trim()).filter(Boolean);else if([\"depth\",\"order\",\"probability\"].includes(O)){let fe=parseInt(ee,10);q[O]=isNaN(fe)?g.attr(\"placeholder\")===\"\\u4F8B\\u5982: 0\"?null:100:fe}else q[O]=ee;let pe=Array.isArray(q[O])?[...q[O]]:q[O];$t(K,q.uid??z,{[O]:pe})}else if(_===\"regex\"){let K=a(z);if(!K)return;let F;g.is(\":checkbox\")?F=g.is(\":checked\"):F=g.val(),l(K,O,F),so(K.id)}n()}}),b=c=>{let g=Object.entries(Ke.position).map(([F,q])=>`<option value=\"${F}\" ${c.position===F?\"selected\":\"\"}>${q}</option>`).join(\"\"),y=Object.entries(Ke.logic).map(([F,q])=>`<option value=\"${F}\" ${c.logic===F?\"selected\":\"\"}>${q}</option>`).join(\"\"),_=Array.isArray(c.keys)?c.keys.join(\", \"):\"\",z=c.content||\"\",I=c.statusId??Te.id;c.statusId=I;let O=Ge(I)??Te;return(!c.strategy||typeof c.strategy!=\"object\")&&(c.strategy={}),c.strategy.type=O.strategyType,c.type=O.strategyType,`\n      <div class=\"rlh-editor-wrapper\" data-mode=\"edit\">\n        <div class=\"rlh-editor-group\"><h5>\\u72B6\\u6001</h5>\n          <div class=\"rlh-editor-grid\">\n            <div class=\"rlh-grid-item\"><label>\\u6FC0\\u6D3B\\u72B6\\u6001</label><select class=\"rlh-edit-status rlh-select-nudge\" data-field=\"statusId\">${jr.map(F=>{let q=I===F.id?\"selected\":\"\";return`<option value=\"${F.id}\" ${q}>${F.label}</option>`}).join(\"\")}</select></div>\n          </div>\n        </div>\n        <div class=\"rlh-editor-field\">\n          <label>\\u5173\\u952E\\u8BCD (\\u9017\\u53F7\\u5206\\u9694)</label>\n          <input type=\"text\" class=\"rlh-edit-keys\" data-field=\"keys\" value=\"${D(_)}\">\n        </div>\n        <div class=\"rlh-editor-field\">\n          <label>\\u5185\\u5BB9</label>\n          <div class=\"rlh-edit-content\" data-field=\"content\" contenteditable=\"true\">${D(z)}</div>\n        </div>\n        <div class=\"rlh-editor-group\"><h5>\\u63D2\\u5165\\u89C4\\u5219</h5>\n          <div class=\"rlh-editor-grid\">\n            <div class=\"rlh-grid-item\"><label>\\u4F4D\\u7F6E</label><select class=\"rlh-edit-position rlh-select-nudge\" data-field=\"position\">${g}</select></div>\n            <div class=\"rlh-grid-item rlh-depth-container\"><label>\\u6DF1\\u5EA6</label><input type=\"number\" class=\"rlh-edit-depth\" data-field=\"depth\" placeholder=\"\\u4F8B\\u5982: 0\" value=\"${c.depth??\"\"}\"></div>\n            <div class=\"rlh-grid-item\"><label>\\u987A\\u5E8F</label><input type=\"number\" class=\"rlh-edit-order\" data-field=\"order\" placeholder=\"\\u4F8B\\u5982: 100\" value=\"${c.order??\"\"}\"></div>\n          </div>\n        </div>\n        <div class=\"rlh-editor-group\"><h5>\\u6FC0\\u6D3B\\u903B\\u8F91</h5>\n          <div class=\"rlh-editor-grid\">\n            <div class=\"rlh-grid-item\"><label>\\u6982\\u7387 (%)</label><input type=\"number\" class=\"rlh-edit-probability\" data-field=\"probability\" min=\"0\" max=\"100\" placeholder=\"100\" value=\"${c.probability??\"\"}\"></div>\n            <div class=\"rlh-grid-item\"><label>\\u5173\\u952E\\u8BCD\\u903B\\u8F91</label><select class=\"rlh-edit-logic rlh-select-nudge\" data-field=\"logic\">${y}</select></div>\n          </div>\n        </div>\n        <div class=\"rlh-editor-group\"><h5>\\u5339\\u914D\\u4E0E\\u9012\\u5F52</h5>\n          <div class=\"rlh-editor-options-row\">\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-case-sensitive\" data-field=\"case_sensitive\" ${c.case_sensitive?\"checked\":\"\"}> \\u5927\\u5C0F\\u5199\\u654F\\u611F</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-match-whole\" data-field=\"match_whole_words\" ${c.match_whole_words?\"checked\":\"\"}> \\u5168\\u8BCD\\u5339\\u914D</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-prevent-recursion\" data-field=\"prevent_recursion\" ${c.prevent_recursion?\"checked\":\"\"}> \\u9632\\u6B62\\u9012\\u5F52</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-exclude-recursion\" data-field=\"exclude_recursion\" ${c.exclude_recursion?\"checked\":\"\"}> \\u4E0D\\u53EF\\u88AB\\u9012\\u5F52</label>\n          </div>\n        </div>\n      </div>\n    `},m=c=>{let g=c?.destination??{},y=c?.source??{},_=D(c?.find_regex??\"\"),z=D(c?.replace_string??\"\"),I=D(String(c?.min_depth??\"\")),O=D(String(c?.max_depth??\"\"));return`\n      <div class=\"rlh-editor-wrapper\" data-mode=\"edit\">\n        <div class=\"rlh-editor-field\">\n          <label>\\u67E5\\u627E\\u6B63\\u5219\\u8868\\u8FBE\\u5F0F</label>\n          <textarea class=\"rlh-edit-find\" data-field=\"find_regex\">${_}</textarea>\n        </div>\n        <div class=\"rlh-editor-field\">\n          <label>\\u66FF\\u6362\\u4E3A</label>\n          <textarea class=\"rlh-edit-replace\" data-field=\"replace_string\">${z}</textarea>\n        </div>\n        <div class=\"rlh-editor-group\">\n          <h5>\\u77ED\\u6682</h5>\n          <div class=\"rlh-editor-options-row\">\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-dest-display\" data-field=\"destination.display\" ${g.display?\"checked\":\"\"}> \\u4EC5\\u683C\\u5F0F\\u663E\\u793A</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-dest-prompt\" data-field=\"destination.prompt\" ${g.prompt?\"checked\":\"\"}> \\u4EC5\\u683C\\u5F0F\\u63D0\\u793A\\u8BCD</label>\n          </div>\n        </div>\n        <div class=\"rlh-editor-group\">\n          <h5>\\u4F5C\\u7528\\u8303\\u56F4</h5>\n          <div class=\"rlh-editor-options-row\">\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-src-user\" data-field=\"source.user_input\" ${y.user_input?\"checked\":\"\"}> \\u7528\\u6237\\u8F93\\u5165</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-src-ai\" data-field=\"source.ai_output\" ${y.ai_output?\"checked\":\"\"}> AI\\u8F93\\u51FA</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-src-slash\" data-field=\"source.slash_command\" ${y.slash_command?\"checked\":\"\"}> \\u659C\\u6760\\u547D\\u4EE4</label>\n            <label class=\"rlh-editor-option-item\"><input type=\"checkbox\" class=\"rlh-edit-src-world\" data-field=\"source.world_info\" ${y.world_info?\"checked\":\"\"}> \\u4E16\\u754C\\u4E66</label>\n          </div>\n        </div>\n        <div class=\"rlh-editor-group\">\n          <h5>\\u6DF1\\u5EA6</h5>\n          <div class=\"rlh-depth-inputs\">\n            <input type=\"number\" class=\"rlh-edit-depth-min\" data-field=\"min_depth\" placeholder=\"\\u6700\\u5C0F\\u6DF1\\u5EA6\" value=\"${I}\">\n            <input type=\"number\" class=\"rlh-edit-depth-max\" data-field=\"max_depth\" placeholder=\"\\u6700\\u5927\\u6DF1\\u5EA6\" value=\"${O}\">\n          </div>\n        </div>\n      </div>\n    `},u=(c,g)=>{let y=c.find(\".rlh-rename-btn\").first();if(!y.length)return;let _=y.find(\"i\").first();g===\"edit\"?(y.attr(\"title\",\"\\u9000\\u51FA\\u7F16\\u8F91\\u6A21\\u5F0F\"),y.attr(\"data-rename-mode\",\"exit\"),_.length&&_.removeClass(\"fa-pencil\").addClass(\"fa-eye\")):(y.attr(\"title\",\"\\u91CD\\u547D\\u540D\\u5E76\\u7F16\\u8F91\"),y.attr(\"data-rename-mode\",\"rename\"),_.length&&_.removeClass(\"fa-eye\").addClass(\"fa-pencil\"))},h=c=>{c.on(\"input.rlh change.rlh\",'input, textarea, select, [contenteditable=\"true\"]',i),c.find(\".rlh-edit-position\").trigger(\"change\")},f=(c,g,y,{animate:_=!0,searchTerm:z}={})=>{let I=g.find(\".rlh-collapsible-content\").first();if(!I.length)return;let O=c===\"view\",K=typeof z==\"string\"?z:g.data(\"searchTerm\")||\"\",F=O?Vr(y,K):b(y);O&&(g.data(\"searchTerm\",K),g.attr(\"data-search-term\",K)),I.stop(!0,!0),I.off(\"input.rlh change.rlh\"),I.html(F),g.attr(\"data-entry-mode\",c),I.attr(\"data-entry-mode\",c),g.toggleClass(\"rlh-editing\",!O),u(g,c);let q=g.find(\".rlh-item-name\").first();q.length&&(O?q.show().removeAttr(\"aria-hidden\"):q.hide().attr(\"aria-hidden\",\"true\"));let ee=()=>{O||h(I)},pe=fe=>{let ve=I[0];if(!ve){fe();return}let Ie=280,Fe=Ce=>Ce<.5?2*Ce*Ce:-1+(4-2*Ce)*Ce;ve.style.display=\"block\",ve.style.overflow=\"hidden\";let Se=0,Be=ve.scrollHeight;ve.style.height=`${Se}px`,ve.style.opacity=\"0\";let ye=null,Ye=Ce=>{ye||(ye=Ce);let ur=Math.min((Ce-ye)/Ie,1),Sr=Fe(ur),ot=Se+(Be-Se)*Sr;ve.style.height=`${ot}px`,ve.style.opacity=String(.6+.4*Sr),ur<1?requestAnimationFrame(Ye):(ve.style.height=\"\",ve.style.opacity=\"\",ve.style.overflow=\"\",fe())};requestAnimationFrame(Ye)};I.is(\":visible\")?ee():_?pe(ee):(I.show(),ee())},w=(c,g,y,_={})=>{f(\"view\",c,g,{..._,searchTerm:y})},E=(c,g,y={})=>{f(\"edit\",c,g,y)},S=(c,g,y,{animate:_=!0}={})=>{let z=c.find(\".rlh-collapsible-content\").first();if(!z.length)return;let I=typeof y==\"string\"?y:\"\";c.data(\"searchTerm\",I),c.attr(\"data-search-term\",I);let O=bt(g,I);z.stop(!0,!0),z.off(\"input.rlh change.rlh\"),z.html(O),c.attr(\"data-entry-mode\",\"view\"),z.attr(\"data-entry-mode\",\"view\"),c.removeClass(\"rlh-editing\"),u(c,\"view\");let K=c.find(\".rlh-item-name\").first();K.length&&K.show().removeAttr(\"aria-hidden\"),z.is(\":visible\")||(_?z.slideDown(200):z.show())},x=(c,g,{animate:y=!0}={})=>{let _=c.find(\".rlh-collapsible-content\").first();if(!_.length)return;let z=m(g);_.stop(!0,!0),_.off(\"input.rlh change.rlh\");let I=()=>{_.on(\"input.rlh change.rlh\",'input, textarea, select, [contenteditable=\"true\"]',i)};_.html(z),c.attr(\"data-entry-mode\",\"edit\"),_.attr(\"data-entry-mode\",\"edit\"),c.addClass(\"rlh-editing\"),u(c,\"edit\");let O=c.find(\".rlh-item-name\").first();O.length&&O.hide().attr(\"aria-hidden\",\"true\"),_.is(\":visible\")?I():y?_.slideDown(200,I):(_.show(),I())},N=(c,g={})=>{let{animate:y=!1,silent:_=!1}=g;if(!c.length)return!1;if(t.multiSelectMode)return _||me(\"\\u8BF7\\u5148\\u9000\\u51FA\\u591A\\u9009\\u6A21\\u5F0F\\u540E\\u518D\\u7F16\\u8F91\\u3002\",\"info\"),!1;let z=c.data(\"book-name\"),I=Number(c.data(\"id\"));if(!z||Number.isNaN(I))return!1;let O=te(z).find(K=>K.uid===I);return O?(E(c,O,{animate:y}),!0):!1},s=(c,g={})=>{let{animate:y=!1}=g;if(!c.length)return!1;let _=c.data(\"book-name\"),z=Number(c.data(\"id\"));if(!_||Number.isNaN(z))return!1;let I=te(_).find(K=>K.uid===z);if(!I)return!1;let O=c.data(\"searchTerm\")||\"\";return w(c,I,O,{animate:y}),!0},v=(c,g={})=>{let{animate:y=!1,silent:_=!1}=g;if(!c.length)return!1;if(t.multiSelectMode)return _||me(\"\\u8BF7\\u5148\\u9000\\u51FA\\u591A\\u9009\\u6A21\\u5F0F\\u540E\\u518D\\u7F16\\u8F91\\u3002\",\"info\"),!1;let z=c.data(\"id\"),I=a(z);return I?(x(c,I,{animate:y}),!0):!1},k=(c,g={})=>{let{animate:y=!1}=g;if(!c.length)return!1;let _=c.data(\"id\"),z=a(_);if(!z)return!1;let I=c.data(\"searchTerm\")||\"\";return S(c,z,I,{animate:y}),!0},A=R(async c=>{c.preventDefault(),c.stopPropagation();let g=r(c.currentTarget).closest(\".rlh-item-container\");N(g,{animate:!1})}),M=R(async c=>{c.preventDefault(),c.stopPropagation();let g=r(c.currentTarget).closest(\".rlh-item-container\");s(g,{animate:!1})}),T=R(async c=>{c.preventDefault(),c.stopPropagation();let g=r(c.currentTarget).closest(\".rlh-item-container\");v(g,{animate:!1})}),J=R(async c=>{c.preventDefault(),c.stopPropagation();let g=r(c.currentTarget).closest(\".rlh-item-container\");k(g,{animate:!1})}),de=R(async c=>{c.stopPropagation();let g=r(c.currentTarget),y=g.closest(\".rlh-book-group, .rlh-item-container\");if(y.hasClass(\"renaming\"))return;let _=!y.hasClass(\"enabled\"),z=y.parent();if(g.hasClass(\"rlh-global-toggle\")){g.addClass(\"rlh-loading\");try{let O=y.data(\"book-name\"),K=new Set(await G.getGlobalWorldbookNames()||[]);_?K.add(O):K.delete(O),await G.rebindGlobalWorldbooks(Array.from(K)),await G.saveSettings();let F=t.allLorebooks.find(q=>q.name===O);F&&(F.enabled=_)}finally{g.removeClass(\"rlh-loading\")}}else{let O=y.data(\"type\"),K=y.data(\"id\");if(O===\"lore\"){let F=y.data(\"book-name\");await Pe(F,[{uid:Number(K),enabled:_}]);let q=te(F).find(ee=>ee.uid===Number(K));q&&(q.enabled=_)}else{let F=await G.getRegexes(),q=F.find(ee=>ee.id===K);if(q){q.enabled=_,await G.replaceRegexes(F.filter(pe=>pe.source!==\"card\")),await G.saveSettings();let ee=t.regexes.global.find(pe=>pe.id===K)||t.regexes.character.find(pe=>pe.id===K);ee&&(ee.enabled=_)}}}me(_?\"\\u5DF2\\u542F\\u7528\":\"\\u5DF2\\u7981\\u7528\"),y.toggleClass(\"enabled\",_);let I=z.children().get();I.sort((O,K)=>{let F=r(O).hasClass(\"enabled\"),q=r(K).hasClass(\"enabled\");if(F!==q)return q-F;let ee=r(O).find(\".rlh-item-name\").text().trim(),pe=r(K).find(\".rlh-item-name\").text().trim();return ee.localeCompare(pe)}),z.append(I)}),H=R(async c=>{c.stopPropagation();let y=r(c.currentTarget).closest(\".rlh-item-container\");if(!y.length)return;let _=y.data(\"type\");if(y.attr(\"data-entry-mode\")===\"edit\"){V(y),_===\"lore\"?s(y,{animate:!1}):k(y,{animate:!1});return}if(t.multiSelectMode){me(\"\\u8BF7\\u5148\\u9000\\u51FA\\u591A\\u9009\\u6A21\\u5F0F\\u540E\\u518D\\u7F16\\u8F91\\u3002\",\"info\");return}let I=y.find(\".rlh-item-header\").first(),K=I.find(\".rlh-item-name\").first().clone().children().remove().end().text().trim(),F=`<div class=\"rlh-rename-ui\"><div class=\"rlh-rename-input-wrapper\"><input type=\"text\" class=\"rlh-rename-input\" value=\"${D(K)}\" /><button class=\"rlh-action-btn-icon rlh-rename-save-btn\" title=\"\\u786E\\u8BA4\"><i class=\"fa-solid fa-check\"></i></button></div></div>`,q=!1;_===\"lore\"?q=N(y,{animate:!1,silent:!0}):q=v(y,{animate:!1,silent:!0}),q&&(I.find(\".rlh-rename-ui\").length||(y.addClass(\"renaming\"),I.append(F)),I.find(\".rlh-rename-input\").focus().select())}),V=(c,g=null)=>{let y=c.find(\".rlh-item-header\").first(),_=y.find(\".rlh-item-name\").first();g&&_.text(g),y.find(\".rlh-rename-ui\").remove(),_.length&&c.attr(\"data-entry-mode\")!==\"edit\"&&_.show().removeAttr(\"aria-hidden\"),c.removeClass(\"renaming\")},B=R(async c=>{c.stopPropagation();let g=r(c.currentTarget).closest(\".rlh-item-container\"),y=g.data(\"type\"),_=()=>{y===\"lore\"?s(g,{animate:!1}):k(g,{animate:!1})},I=g.find(\".rlh-rename-input\").val().trim(),O=g.find(\".rlh-item-name\").first().text().trim();if(!I||I===O){V(g,O),_();return}let K=g.data(\"id\");if(y===\"lore\"){let F=g.data(\"book-name\");await Pe(F,[{uid:Number(K),name:I}]);let ee=[...te(F)].find(pe=>pe.uid===Number(K));ee&&(ee.name=I)}else{let F=await G.getRegexes(),q=F.find(ee=>ee.id===K);if(q){q.script_name=I,await G.replaceRegexes(F.filter(pe=>pe.source!==\"card\")),await G.saveSettings();let ee=t.regexes.global.find(pe=>pe.id===K)||t.regexes.character.find(pe=>pe.id===K);ee&&(ee.script_name=I)}}V(g,I),_(),me(\"\\u91CD\\u547D\\u540D\\u6210\\u529F\")}),Q=R(async c=>{if(c.key===\"Enter\")r(c.currentTarget).siblings(\".rlh-rename-save-btn\").click();else if(c.key===\"Escape\"){c.preventDefault();let g=r(c.currentTarget).closest(\".rlh-item-container\");V(g)}}),he=R(async c=>{c.stopPropagation();let g=r(c.currentTarget),_=g.closest(\".rlh-editor-wrapper\").find(\"textarea, .rlh-edit-content\");g.find(\"i\").hasClass(\"fa-expand\")?(g.attr(\"title\",\"\\u6536\\u7F29\").find(\"i\").removeClass(\"fa-expand\").addClass(\"fa-compress\"),_.each(function(){this.style.height=\"auto\",this.style.height=this.scrollHeight+\"px\"})):(g.attr(\"title\",\"\\u5C55\\u5F00\").find(\"i\").removeClass(\"fa-compress\").addClass(\"fa-expand\"),_.css(\"height\",\"\"))}),ae=ut(R(async c=>{let y=r(c.currentTarget).data(\"book-name\"),z=Ne().activeBookName??t.activeBookName??t.activeCharacterBook??t.chatLorebook??\"\",I=y||z;if(!I){await X({type:\"alert\",title:\"\\u521B\\u5EFA\\u5931\\u8D25\",text:\"\\u5F53\\u524D\\u6CA1\\u6709\\u9009\\u4E2D\\u7684\\u4E16\\u754C\\u4E66\\uFF0C\\u65E0\\u6CD5\\u521B\\u5EFA\\u6761\\u76EE\\u3002\"});return}let O=mo(I),K=Gt(O,I);if(K&&K.length){let F=K.find(\".rlh-rename-btn\");F.length&&F.trigger(\"click\")}try{let F=await G.createWorldbookEntries(I,[{name:O.name,enabled:O.enabled,keys:O.keys}]);if(F&&F.new_entries&&F.new_entries.length>0){Ae(I,F.worldbook.map(Ze));let q=F.new_entries[0];if(q){fo(I,O.uid,q);let ee=r(`#rlh-panel .rlh-item-container[data-id=\"${O.uid}\"]`,o);ee.length&&(ee.attr(\"data-id\",q.uid),ee.data(\"id\",q.uid))}pr(I),me(\"\\u65B0\\u6761\\u76EE\\u5DF2\\u521B\\u5EFA\")}else throw new Error(\"API\\u8FD4\\u56DE\\u6570\\u636E\\u683C\\u5F0F\\u4E0D\\u6B63\\u786E\")}catch(F){console.error(\"[RegexLoreHub] Create entry failed:\",F),X({type:\"alert\",title:\"\\u521B\\u5EFA\\u5931\\u8D25\",text:`\\u521B\\u5EFA\\u65B0\\u6761\\u76EE\\u65F6\\u53D1\\u751F\\u9519\\u8BEF\\uFF0C\\u4F46\\u60A8\\u4ECD\\u53EF\\u7F16\\u8F91\\u5F53\\u524D\\u5185\\u5BB9\\u5E76\\u624B\\u52A8\\u4FDD\\u5B58\\u3002\\u9519\\u8BEF: ${F.message}`})}}),300),se=R(async c=>{c.stopPropagation();let g=r(c.currentTarget).closest(\".rlh-item-container\"),y=g.data(\"book-name\"),_=Number(g.data(\"id\")),z=g.find(\".rlh-item-name\").text().trim();try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u5220\\u9664\",text:`\\u60A8\\u786E\\u5B9A\\u8981\\u5220\\u9664\\u6761\\u76EE \"${z}\" \\u5417\\uFF1F`})}catch{return}let I=await G.deleteWorldbookEntries(y,[_]);I&&I.deleted_entries&&I.deleted_entries.length>0?(Ae(y,I.worldbook.map(Ze)),pr(y),g.slideUp(300,()=>g.remove()),me(\"\\u5220\\u9664\\u6210\\u529F\")):await X({type:\"alert\",title:\"\\u5220\\u9664\\u5931\\u8D25\",text:\"\\u5220\\u9664\\u6761\\u76EE\\u65F6\\u53D1\\u751F\\u9519\\u8BEF\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u3002\"})}),re=R(async c=>{let g=r(c.currentTarget),y=g.closest(\".rlh-editor-grid\").find(\".rlh-depth-container\");g.val().startsWith(\"at_depth\")?y.slideDown(200):y.slideUp(200)});return{handleToggleState:de,handleEditorInput:i,renderLoreEntryViewer:w,renderLoreEntryEditor:E,renderRegexViewer:S,renderRegexEditor:x,handleEntryEnterEdit:A,handleEntryExitEdit:M,handleRegexEnterEdit:T,handleRegexExitEdit:J,handleRename:H,handleConfirmRename:B,handleRenameKeydown:Q,handleEditorExpandToggle:he,handleCreateEntry:ae,handleDeleteEntry:se,handlePositionChange:re}}var hl=(e,r,o,a,l,n)=>{let i=Kt(e,r,o,a,l,n);return X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u66FF\\u6362\",html:i})},vo=R(async e=>{let r=ce(),o=be(),a=r(`#${ue}`,o);if(!a.length)return;let l=a.find(`#${We.TOOLBAR_SHELL}`);if(l.length||(l=a.find(\".rlh-toolbar-shell\").first(),l.length&&l.attr(\"id\",We.TOOLBAR_SHELL)),!l.length)return;let n=!l.hasClass(\"rlh-toolbar-shell--collapsed\");e?.preventDefault?.(),e?.stopPropagation?.(),l.toggleClass(\"rlh-toolbar-shell--collapsed\",n),l.attr(\"aria-hidden\",String(n)),t.isToolbarCollapsed=n;let i=e?.currentTarget?r(e.currentTarget):a.find(`#${We.TOGGLE_TOOLBAR_BTN}`);i.length&&(i.text(n?\"\\u5C55\\u5F00\\u5DE5\\u5177\\u680F\":\"\\u6298\\u53E0\\u5DE5\\u5177\\u680F\"),i.attr(\"aria-expanded\",String(!n)),i.attr(\"title\",n?\"\\u5C55\\u5F00\\u5DE5\\u5177\\u680F\":\"\\u6298\\u53E0\\u5DE5\\u5177\\u680F\"))});function yo(e={}){let r=e.$??ce(),o=e.parentDoc??be(),a=e.lorebookHandlers,l=e.itemHandlers,n=()=>{switch(t.multiSelectTarget){case\"book\":return\"book:\";case\"entry\":return\"lore:\";case\"regex\":return\"regex:\";default:return\"\"}},i=d=>{let p=String(d??\"\"),L=p.indexOf(\":\");if(L===-1)return{type:p,raw:\"\"};let C=p.slice(0,L),Y=p.slice(L+1);if(C===\"book\")return{type:C,bookName:Y};if(C===\"lore\"){let P=Y.lastIndexOf(\":\");return P===-1?{type:C,bookName:Y,entryId:null}:{type:C,bookName:Y.slice(0,P),entryId:Y.slice(P+1)}}return C===\"regex\"?{type:C,regexId:Y}:{type:C,raw:Y}},b=()=>({$menu:r(`#${gr}`,o),$button:r(`#${tr}`,o)}),m=()=>{let d=new Map;for(let p of t.selectedItems){let{type:L,bookName:C,entryId:Y}=i(p);if(L===\"lore\"&&C){let P=Number(Y),U=Number.isFinite(P)?P:Y;if(U==null||U===\"\")continue;d.has(C)||d.set(C,[]),d.get(C).push(U)}}return d},u=!1;function h(){let{$menu:d,$button:p}=b();d.length&&d.attr(\"data-open\",\"false\"),p.length&&p.attr(\"aria-expanded\",\"false\"),u&&(r(o).off(\"click.rlhUnifiedStatus\",f),u=!1)}function f(d){let{$menu:p,$button:L}=b();if(!p.length)return;let C=r(d.target);C.closest(`#${gr}`).length||L.length&&C.closest(`#${tr}`).length||h()}function w(){let{$menu:d,$button:p}=b();!d.length||!p.length||(d.attr(\"data-open\",\"true\"),p.attr(\"aria-expanded\",\"true\"),u||(r(o).on(\"click.rlhUnifiedStatus\",f),u=!0))}let E=()=>{let{$menu:d,$button:p}=b();if(!p.length)return;let L=Ne();if(!(L?.type===\"lore\")){p.attr(\"disabled\",\"disabled\").attr(\"title\",\"\\u7EDF\\u4E00\\u72B6\\u6001\\u4EC5\\u5728\\u6761\\u76EE\\u89C6\\u56FE\\u53EF\\u7528\"),d.length&&d.attr(\"data-open\")===\"true\"&&h();return}let P=[L?.activeBookName,t.activeBookName,t.activeCharacterBook,t.chatLorebook].find(ke=>typeof ke==\"string\"&&ke.trim().length>0)?.toString().trim()??\"\",U=m();!P&&U.size===1&&(P=[...U.keys()][0]??\"\");let j=(P?te(P):[]).length>0,Z=t.multiSelectMode&&t.multiSelectTarget===\"entry\",ne=0;U.forEach(ke=>{Array.isArray(ke)&&(ne+=ke.length)});let ie=Z?ne>0:j,oe;Z?oe=ne>0?`\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u5C06\\u5BF9\\u5DF2\\u9009\\u4E2D\\u7684 ${ne} \\u4E2A\\u6761\\u76EE\\u7EDF\\u4E00\\u72B6\\u6001`:\"\\u5DF2\\u5F00\\u542F\\u591A\\u9009\\uFF0C\\u8BF7\\u5148\\u52FE\\u9009\\u8981\\u8C03\\u6574\\u72B6\\u6001\\u7684\\u6761\\u76EE\":j?oe=`\\u5C06\\u5BF9\\u300C${P||\"\\u5F53\\u524D\\u4E16\\u754C\\u4E66\"}\\u300D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u7EDF\\u4E00\\u72B6\\u6001`:oe=P?`\\u300C${P}\\u300D\\u6682\\u65E0\\u6761\\u76EE\\u53EF\\u8C03\\u6574`:\"\\u8BF7\\u5148\\u6253\\u5F00\\u9700\\u8981\\u7EDF\\u4E00\\u72B6\\u6001\\u7684\\u4E16\\u754C\\u4E66\",p.attr(\"title\",oe),ie?p.removeAttr(\"disabled\"):(p.attr(\"disabled\",\"disabled\"),d.length&&d.attr(\"data-open\")===\"true\"&&h())},S=()=>{let{$menu:d,$button:p}=_();if(!p.length)return;let Y=[Ne()?.activeBookName,t.activeBookName,t.activeCharacterBook,t.chatLorebook].find(oe=>typeof oe==\"string\"&&oe.trim().length>0)?.toString().trim()??\"\",P=m();!Y&&P.size===1&&(Y=[...P.keys()][0]??\"\");let W=(Y?te(Y):[]).length>0,j=t.multiSelectMode&&t.multiSelectTarget===\"entry\",Z=0;P.forEach(oe=>{Array.isArray(oe)&&(Z+=oe.length)});let ne=j?Z>0:W,ie;j?ie=Z>0?`\\u591A\\u9009\\u6A21\\u5F0F\\uFF1A\\u5C06\\u5BF9\\u5DF2\\u9009\\u4E2D\\u7684 ${Z} \\u4E2A\\u6761\\u76EE\\u7EDF\\u4E00\\u4F4D\\u7F6E`:\"\\u5DF2\\u5F00\\u542F\\u591A\\u9009\\uFF0C\\u8BF7\\u5148\\u52FE\\u9009\\u8981\\u8C03\\u6574\\u4F4D\\u7F6E\\u7684\\u6761\\u76EE\":W?ie=`\\u5C06\\u5BF9\\u300C${Y||\"\\u5F53\\u524D\\u4E16\\u754C\\u4E66\"}\\u300D\\u7684\\u6240\\u6709\\u6761\\u76EE\\u7EDF\\u4E00\\u4F4D\\u7F6E`:ie=Y?`\\u300C${Y}\\u300D\\u6682\\u65E0\\u6761\\u76EE\\u53EF\\u8C03\\u6574`:\"\\u8BF7\\u5148\\u6253\\u5F00\\u9700\\u8981\\u7EDF\\u4E00\\u4F4D\\u7F6E\\u7684\\u4E16\\u754C\\u4E66\",p.attr(\"title\",ie),ne?p.removeAttr(\"disabled\"):(p.attr(\"disabled\",\"disabled\"),d.length&&d.attr(\"data-open\",\"false\"))},x=()=>{qr(),E(),S()},N=()=>{if(!t.multiSelectMode)return[];let d=r(`#${ue}`,o);if(!d.length)return[];let p;switch(t.multiSelectTarget){case\"book\":p=\".rlh-book-group[data-select-key]\";break;case\"entry\":p='.rlh-item-container[data-select-key][data-type=\"lore\"]';break;case\"regex\":p='.rlh-item-container[data-select-key][data-type=\"regex\"]';break;default:p=\"[data-select-key]\";break}let L=[];return d.find(p).each((C,Y)=>{let P=r(Y);if(!P.is(\":visible\"))return;let U=P.data(\"select-key\");U&&L.push(String(U))}),L},s=()=>{if(!t.selectedItems||t.selectedItems.size===0)return!1;let d=n();if(!d)return t.selectedItems.size>0;for(let p of t.selectedItems)if(p.startsWith(d))return!0;return!1},v=d=>{if(!d||!d.length)return null;if(d.hasClass(\"rlh-book-group\")){if(t.multiSelectTarget!==\"book\")return null;let p=d.data(\"book-name\");return p?`book:${p}`:null}if(d.hasClass(\"rlh-item-container\")){let p=d.data(\"type\"),L=d.data(\"id\");if(p===\"lore\"&&t.multiSelectTarget===\"entry\"){let C=d.data(\"book-name\");return C!=null&&L!=null?`lore:${C}:${L}`:null}if(p===\"regex\"&&t.multiSelectTarget===\"regex\")return L!=null?`regex:${L}`:null}return null},k=d=>{let p=v(d);return p?(t.selectedItems.has(p)?(t.selectedItems.delete(p),d.removeClass(\"selected\"),d.find(\".rlh-multi-select-checkbox\").prop(\"checked\",!1)):(t.selectedItems.add(p),d.addClass(\"selected\"),d.find(\".rlh-multi-select-checkbox\").prop(\"checked\",!0)),x(),!0):!1},A=R(async d=>{let p=r(d.currentTarget),L=p.val();p.attr(\"id\")===\"rlh-global-search-input\"?t.globalSearch.term=L:p.attr(\"id\")===\"rlh-global-replace-input\"&&(t.globalSearch.replace=L),p.attr(\"id\")===\"rlh-global-search-input\"&&le()}),M=R(async d=>{if(d.key===\"Enter\"){d.preventDefault();let p=d.currentTarget.value??\"\";t.globalSearch.term=p,le()}}),T=R(async()=>{let d=r(`#${er}`,o);d.length&&d.val(\"\"),t.globalSearch.term=\"\",le()}),J=R(async()=>{let d=r(`#${er}`,o).val(),p=r(`#${br}`,o).val(),L=Ne();if(!d){await X({type:\"alert\",title:\"\\u66FF\\u6362\\u5931\\u8D25\",text:\"\\u8BF7\\u5148\\u8F93\\u5165\\u641C\\u7D22\\u8BCD\\u3002\"});return}if(L.view===\"global-lore-list\"){let U=t.allLorebooks.filter(W=>!W.entriesLoaded);if(U.length>0){let W=or(`\\u6B63\\u5728\\u52A0\\u8F7D ${U.length} \\u672C\\u4E16\\u754C\\u4E66\\u7684\\u6761\\u76EE...`);try{await Promise.all(U.map(j=>Le(j.name))),W.remove()}catch(j){W.remove(),console.error(\"[RegexLoreHub] Failed to load entries before replace:\",j),await X({type:\"alert\",title:\"\\u52A0\\u8F7D\\u5931\\u8D25\",text:\"\\u5728\\u6267\\u884C\\u66FF\\u6362\\u524D\\u52A0\\u8F7D\\u4E16\\u754C\\u4E66\\u6761\\u76EE\\u5931\\u8D25\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u3002\"});return}}}let C,Y,P;if(L.type===\"lore\")if(L.view===\"global-lore-list\"||L.view===\"global-lore-detail\")({matches:C,stats:Y,booksMatchedByNameOnly:P}=Vt(d));else{await X({type:\"alert\",title:\"\\u64CD\\u4F5C\\u65E0\\u6548\",text:\"\\u5F53\\u524D\\u89C6\\u56FE\\u4E0D\\u652F\\u6301\\u66FF\\u6362\\u529F\\u80FD\\u3002\"});return}else if(L.type===\"regex\")({matches:C,stats:Y}=Zt(d));else{await X({type:\"alert\",title:\"\\u64CD\\u4F5C\\u65E0\\u6548\",text:\"\\u672A\\u77E5\\u7684\\u89C6\\u56FE\\u7C7B\\u578B\\uFF0C\\u65E0\\u6CD5\\u6267\\u884C\\u66FF\\u6362\\u3002\"});return}if((!C||C.length===0)&&(!P||P.length===0)){await X({type:\"alert\",title:\"\\u65E0\\u5339\\u914D\\u9879\",text:\"\\u672A\\u627E\\u5230\\u53EF\\u66FF\\u6362\\u7684\\u6761\\u76EE\\u3002\"});return}try{let U=L.type===\"lore\"?\"lorebook\":\"regex\";await hl(C,Y,P,d,p,U);let W=or(\"\\u6B63\\u5728\\u6267\\u884C\\u66FF\\u6362...\");try{await Se(C,d,p),W.remove(),me(\"\\u66FF\\u6362\\u5B8C\\u6210\"),le()}catch(j){W.remove(),console.error(\"[RegexLoreHub] Replace error:\",j),await X({type:\"alert\",title:\"\\u66FF\\u6362\\u5931\\u8D25\",text:\"\\u66FF\\u6362\\u8FC7\\u7A0B\\u4E2D\\u53D1\\u751F\\u9519\\u8BEF\\uFF0C\\u8BF7\\u68C0\\u67E5\\u5F00\\u53D1\\u8005\\u63A7\\u5236\\u53F0\\u83B7\\u53D6\\u8BE6\\u7EC6\\u4FE1\\u606F\\u3002\"})}}catch{console.log(\"[RegexLoreHub] Replace operation cancelled by user.\")}}),de=R(async()=>{let d=Ne();if(!d.showCollapseToggle)return;let p=vr(d),C=(t.collapseStateByContext.get(p)??\"expanded\")===\"collapsed\"?\"expanded\":\"collapsed\";Pt(d,C),r(`#${ue}-content .rlh-item-container:visible, #${ue}-content .rlh-book-group:visible`,o).each(function(){let U=r(this),j=U.find(\".rlh-collapsible-content\").first().is(\":visible\"),Z=U.find(\".rlh-item-header, .rlh-global-book-header\").first();C===\"expanded\"&&!j?Z.trigger(\"click.rlh\",{bulk:!0}):C===\"collapsed\"&&j&&Z.trigger(\"click.rlh\",{bulk:!0})});let P=r(`#${mr}`,o);if(P.length){let U=C===\"collapsed\"?\"fa-expand-arrows-alt\":\"fa-compress-arrows-alt\",W=C===\"collapsed\"?\"\\u5168\\u90E8\\u5C55\\u5F00\":\"\\u5168\\u90E8\\u6298\\u53E0\";P.attr(\"data-collapse-state\",C),P.find(\"i\").removeClass(\"fa-expand-arrows-alt fa-compress-arrows-alt\").addClass(U),P.find(\"span\").text(W)}}),H=!1;function V(){return{$menu:r(`#${fr}`,o),$button:r(`#${rr}`,o)}}function B(d){if(!H)return;let p=r(d.target);p.closest(`#${fr}`).length||p.closest(`#${rr}`).length||se()}function Q(d){if(d.key!==\"Escape\")return;let{$button:p}=V();se(),p.length&&p.trigger(\"focus\")}function he(){H||(r(o).on(\"click.rlhSortMenu\",B),r(o).on(\"keydown.rlhSortMenu\",Q),H=!0)}function ae(){H&&(r(o).off(\"click.rlhSortMenu\",B),r(o).off(\"keydown.rlhSortMenu\",Q),H=!1)}function se(){let{$menu:d,$button:p}=V();d.length&&(d.attr(\"data-open\",\"false\").removeClass(\"open\"),p.length&&p.attr(\"aria-expanded\",\"false\"),ae())}function re(){let{$menu:d,$button:p}=V();d.length&&(d.attr(\"data-open\",\"true\").addClass(\"open\"),p.length&&p.attr(\"aria-expanded\",\"true\"),he())}let c=R(async d=>{d.preventDefault(),d.stopPropagation();let{$menu:p}=V();if(!p.length)return;p.attr(\"data-open\")===\"true\"?se():re()}),g=R(async d=>{d.preventDefault();let p=r(d.currentTarget).data(\"sort-value\");if(!p)return;se();let L=Ne();zt(L,p),le()}),y=!1;function _(){return{$menu:r(`#${Qe}`,o),$button:r(`#${qe}`,o)}}function z(d){if(!y)return;let p=r(d.target);p.closest(`#${Qe}`).length||p.closest(`#${qe}`).length||F()}function I(d){if(d.key!==\"Escape\")return;let{$button:p}=_();F(),p.length&&p.trigger(\"focus\")}function O(){y||(r(o).on(\"click.rlhPositionMenu\",z),r(o).on(\"keydown.rlhPositionMenu\",I),y=!0)}function K(){y&&(r(o).off(\"click.rlhPositionMenu\",z),r(o).off(\"keydown.rlhPositionMenu\",I),y=!1)}function F(){let{$menu:d,$button:p}=_();d.length&&(d.attr(\"data-open\",\"false\").removeClass(\"open\"),p.length&&p.attr(\"aria-expanded\",\"false\"),K())}function q(){let{$menu:d,$button:p}=_();d.length&&(p.is(\"[disabled]\")||(d.attr(\"data-open\",\"true\").addClass(\"open\"),p.length&&p.attr(\"aria-expanded\",\"true\"),O()))}let ee=R(async d=>{d.preventDefault(),d.stopPropagation(),x();let{$menu:p}=_();if(!p.length)return;p.attr(\"data-open\")===\"true\"?F():q()}),pe=R(async d=>{d.preventDefault();let p=r(d.currentTarget),L=(p.data(\"position-value\")??\"\").toString().trim(),C=(p.data(\"book-name\")??p.closest(`#${Qe}`).data(\"book-name\")??\"\").toString().trim();F(),L&&a?.applyUnifiedPosition&&await a.applyUnifiedPosition({bookName:C,positionValue:L})}),fe=R(async d=>{d.preventDefault(),d.stopPropagation(),x();let{$menu:p,$button:L}=b();if(!p.length||!L.length||L.is(\":disabled\"))return;p.attr(\"data-open\")===\"true\"?h():w()}),ve=R(async d=>{d.preventDefault();let L=(r(d.currentTarget).data(\"status-id\")??\"\").toString().trim();if(!L)return;h();let C=t.multiSelectMode&&t.multiSelectTarget===\"entry\",Y=m();if(C&&Y.size===0){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u81F3\\u5C11\\u9009\\u62E9\\u4E00\\u4E2A\\u5DF2\\u4FDD\\u5B58\\u7684\\u6761\\u76EE\\u3002\"}),x();return}if(!C){let Ue=[Ne()?.activeBookName,t.activeBookName,t.activeCharacterBook,t.chatLorebook].find(Ve=>typeof Ve==\"string\"&&Ve.trim().length>0)?.toString().trim()??\"\";if(!Ue){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u6253\\u5F00\\u4E00\\u4E2A\\u4E16\\u754C\\u4E66\\u4EE5\\u4FBF\\u6267\\u884C\\u7EDF\\u4E00\\u72B6\\u6001\\u3002\"}),x();return}let sr=[...te(Ue)];if(sr.length||(await Le(Ue),sr=[...te(Ue)]),!sr.length){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:`\\u300C${Ue}\\u300D\\u6682\\u65E0\\u6761\\u76EE\\u53EF\\u64CD\\u4F5C\\u3002`}),x();return}let He=[];if(sr.forEach(Ve=>{let xe=Number(Ve?.uid);Number.isFinite(xe)&&He.push(xe)}),!He.length){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u5F53\\u524D\\u6CA1\\u6709\\u5DF2\\u4FDD\\u5B58\\u7684\\u6761\\u76EE\\u53EF\\u64CD\\u4F5C\\u3002\"}),x();return}Y=new Map([[Ue,He]])}let P=Ge(L)??Te,U=P.toastLabel??P.label,W=Array.from(Y.values()).reduce((Re,$r)=>Re+$r.length,0),j=or(`\\u6B63\\u5728\\u66F4\\u65B0 ${W} \\u4E2A\\u6761\\u76EE\\u7684\\u72B6\\u6001...`),Z=0,ne=0,ie=0,oe=0,ke=0,je=[];try{let Re=Ne(),$r=0;for(let[Ue,sr]of Y.entries()){$r+=1,j.update(`\\u6B63\\u5728\\u66F4\\u65B0\\u300C${Ue}\\u300D (${$r}/${Y.size})`);let He=await io(Ue,sr,P.id,{context:Re?.id??\"unknown\"}).catch(xe=>(console.error(\"[RegexLoreHub] \\u6279\\u91CF\\u72B6\\u6001\\u66F4\\u65B0\\u5F02\\u5E38:\",xe),je.push({bookName:Ue,reason:xe?.message??\"\\u672A\\u77E5\\u9519\\u8BEF\"}),ie+=sr.length,null));if(!He)continue;let Ve=He.summary??{appliedCount:0,alreadyAppliedCount:0,failedCount:0,ignoredCount:0,ignoredUnsavedCount:0};Z+=Ve.appliedCount??0,ne+=Ve.alreadyAppliedCount??0,ie+=Ve.failedCount??0,oe+=Ve.ignoredCount??0,ke+=Ve.ignoredUnsavedCount??0,Array.isArray(He.failed)&&He.failed.forEach(xe=>{je.push({bookName:Ue,name:xe.name??`#${xe.uid??xe.tempUid??\"\\u672A\\u77E5\"}`,reason:xe.reason??\"\\u672A\\u8BF4\\u660E\"})}),Array.isArray(He.ignored)&&He.ignored.filter(xe=>xe.reason&&xe.reason!==\"UNSAVED_ENTRY\").forEach(xe=>{je.push({bookName:Ue,name:xe.name??`#${xe.uid??xe.tempUid??\"\\u672A\\u77E5\"}`,reason:xe.reason})}),Array.isArray(He.success)&&He.success.forEach(xe=>{let It=xe.uid??xe.tempUid;It!=null&&Xr(Ue,It,P.id)})}}finally{j.remove()}let $e=Math.max(oe-ke,0),Ee=\"\";if(Z>0&&ie===0&&ke===0&&$e===0)Ee=`${Z} \\u4E2A\\u6761\\u76EE\\u7684\\u72B6\\u6001\\u5DF2\\u66F4\\u65B0\\u4E3A\\u300C${U}\\u300D`,ne>0&&(Ee+=`\\uFF08\\u5176\\u4E2D ${ne} \\u4E2A\\u539F\\u672C\\u5DF2\\u5904\\u4E8E\\u8BE5\\u72B6\\u6001\\uFF09`);else{let Re=[];Z>0&&Re.push(`${Z} \\u4E2A\\u6761\\u76EE\\u66F4\\u65B0\\u4E3A\\u300C${U}\\u300D`),ne>0&&Re.push(`${ne} \\u4E2A\\u539F\\u672C\\u5DF2\\u5904\\u4E8E\\u8BE5\\u72B6\\u6001`),ie>0&&Re.push(`${ie} \\u4E2A\\u6761\\u76EE\\u66F4\\u65B0\\u5931\\u8D25`),ke>0&&Re.push(`\\u5FFD\\u7565 ${ke} \\u4E2A\\u672A\\u4FDD\\u5B58\\u6761\\u76EE`),$e>0&&Re.push(`\\u8DF3\\u8FC7 ${$e} \\u4E2A\\u6761\\u76EE`),Ee=Re.length>0?Re.join(\"\\uFF1B\"):\"\\u672A\\u6267\\u884C\\u4EFB\\u4F55\\u72B6\\u6001\\u66F4\\u65B0\\uFF0C\\u8BF7\\u786E\\u8BA4\\u5DF2\\u9009\\u62E9\\u6709\\u6548\\u6761\\u76EE\\u3002\"}let we=\"success\";ie>0?we=Z>0?\"warning\":\"error\":(ke>0||$e>0)&&(we=\"info\"),me(Ee,we),je.length&&console.warn(\"[RegexLoreHub] \\u72B6\\u6001\\u66F4\\u65B0\\u8BE6\\u60C5\\uFF08\\u4EC5\\u65E5\\u5FD7\\uFF09:\",je),x()}),Ie=R(async d=>{let p=(r(d.currentTarget).val()??\"\").toString().trim();!p||t.activeCharacterBook===p||(t.activeCharacterBook=p,le())}),Fe=R(async d=>{let p=r(d.currentTarget),L=p.data(\"select-key\");if(!L)return;if(!t.multiSelectMode){p.prop(\"checked\",!1);return}let C=p.is(\":checked\");C?t.selectedItems.add(L):t.selectedItems.delete(L),p.closest(\"[data-select-key]\").toggleClass(\"selected\",C),x()}),Se=async(d,p,L)=>{let C=Ut(p,!1),Y=new Map,P=(U,W)=>{if(!Array.isArray(U)||!Array.isArray(W)||U.length!==W.length)return!1;for(let j=0;j<U.length;j+=1)if(U[j]!==W[j])return!1;return!0};for(let U of d){let{bookName:W,entry:j}=U??{};if(!W||!j)throw new Error(\"\\u4EC5\\u652F\\u6301\\u4E16\\u754C\\u4E66\\u6761\\u76EE\\u7684\\u6279\\u91CF\\u66FF\\u6362\\u3002\");let Z=Number(j?.uid);if(!Number.isFinite(Z))continue;let ne={uid:Z},ie=!1;if(Array.isArray(j.keys)){let oe=j.keys.map(ke=>ke.replace(C,L));P(j.keys,oe)||(ne.keys=oe,ie=!0)}if(typeof j.content==\"string\"){let oe=j.content.replace(C,L);oe!==j.content&&(ne.content=oe,ie=!0)}if(typeof j.name==\"string\"){let oe=j.name.replace(C,L);oe!==j.name&&(ne.name=oe,ie=!0)}if(typeof j.comment==\"string\"){let oe=j.comment.replace(C,L);oe!==j.comment&&(ne.comment=oe,ie=!0)}ie&&(Y.has(W)||Y.set(W,[]),Y.get(W).push(ne))}for(let[U,W]of Y.entries())W.length!==0&&await Pe(U,W)},Be=R(async()=>{r(`#${ue}`,o).is(\":visible\")?ye():await Ye()}),ye=async()=>{me(\"\\u6B63\\u5728\\u540E\\u53F0\\u4FDD\\u5B58\\u6570\\u636E...\",\"info\"),nr().then(()=>{me(\"\\u6570\\u636E\\u4FDD\\u5B58\\u6210\\u529F\\uFF01\",\"success\")}).catch(L=>{console.error(\"[RegexLoreHub] Background save failed:\",L),me(\"\\u540E\\u53F0\\u4FDD\\u5B58\\u5931\\u8D25\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u65E5\\u5FD7\\u3002\",\"error\")});let d=r(`#${ue}`,o),p=r(\"body\",o);d.hide(),r(`#${Je}`,o).removeClass(\"active\"),p.off(\"mousedown.rlh-outside-click\")},Ye=async()=>{let d=r(`#${ue}`,o),p=r(\"body\",o);d.css(\"display\",\"flex\"),r(`#${Je}`,o).addClass(\"active\"),p.on(\"mousedown.rlh-outside-click\",function(L){r(L.target).closest(`#${ue}`).length===0&&r(L.target).closest(`#${Je}`).length===0&&ye()}),t.isDataLoaded?le():await ze()},Ce=R(async d=>{t.isLoadingTabData=!0,le();try{await uo();let p=L=>{if(!L)return null;Array.isArray(t.allLorebooks)||(t.allLorebooks=[]);let C=t.allLorebooks.find(Y=>Y.name===L);return C||(C={name:L,enabled:!1,entryCount:0,enabledEntryCount:0,entriesLoaded:!1},t.allLorebooks.push(C)),C};if(d===\"char-lore\"){let L=Array.isArray(t.lorebooks.character)?t.lorebooks.character:[];for(let C of L)p(C),await Le(C,!0)}else if(d===\"chat-lore\"){let L=t.chatLorebook;L&&(p(L),await Le(L,!0))}}catch(p){console.error(`[RegexLoreHub] Error refreshing tab ${d}:`,p),R(()=>{throw p})()}finally{t.isLoadingTabData=!1,le()}}),ur=R(async d=>{let p=r(d.currentTarget).data(\"tab\");if(p===\"global-lore\"&&t.activeView===\"global-lore-detail\"){await a.handleExitLorebookDetail();return}t.activeTab=p,r(`#${ue} .rlh-tab`,o).removeClass(\"active\"),r(d.currentTarget).addClass(\"active\"),r(`#${Ur}`,o).toggle(t.activeTab===\"global-lore\"),t.selectedItems.clear(),p===\"char-lore\"&&!t.charLoreInitialSynced&&(await ze(),t.charLoreInitialSynced=!0),p===\"char-lore\"||p===\"chat-lore\"?await Ce(p):le()}),Sr=R(async d=>{t.multiSelectMode=!t.multiSelectMode,t.selectedItems.clear(),r(\"#rlh-multi-select-btn\",o).toggleClass(\"active\",t.multiSelectMode),r(\"#rlh-multi-select-controls\",o).toggleClass(\"active\",t.multiSelectMode),le(),x()}),ot=R(async()=>{if(!t.multiSelectMode)return;let d=N();d.length&&(d.forEach(p=>t.selectedItems.add(p)),le(),x())}),_o=R(async()=>{if(!t.multiSelectMode)return;let d=n(),p=!1;if(d)[...t.selectedItems].forEach(C=>{C.startsWith(d)&&(t.selectedItems.delete(C),p=!0)});else{if(t.selectedItems.size===0)return;t.selectedItems.clear(),p=!0}p&&(le(),x())}),So=R(async()=>{if(!t.multiSelectMode)return;let d=N();d.length&&(d.forEach(p=>{t.selectedItems.has(p)?t.selectedItems.delete(p):t.selectedItems.add(p)}),le(),x())}),$o=R(async()=>{if(t.multiSelectMode){if(!s())return await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u9009\\u62E9\\u8981\\u542F\\u7528\\u7684\\u9879\\u76EE\\u3002\"});await Nt(!0),me(\"\\u6279\\u91CF\\u542F\\u7528\\u6210\\u529F\")}}),Eo=R(async()=>{if(t.multiSelectMode){if(!s())return await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u9009\\u62E9\\u8981\\u7981\\u7528\\u7684\\u9879\\u76EE\\u3002\"});await Nt(!1),me(\"\\u6279\\u91CF\\u7981\\u7528\\u6210\\u529F\")}}),Lo=R(async()=>{if(!t.multiSelectMode)return;let d=new Set,p=new Map,L=new Set,C=0;for(let W of t.selectedItems){let{type:j,bookName:Z,entryId:ne,regexId:ie}=i(W);if(j===\"book\"&&Z)d.add(Z);else if(j===\"lore\"&&Z){let oe=Number(ne);if(!Number.isFinite(oe))continue;p.has(Z)||p.set(Z,[]),p.get(Z).push(oe),C++}else if(j===\"regex\"){let oe=ie!=null&&ie!==\"\"?String(ie):\"\";oe&&L.add(oe)}}if(d.size===0&&C===0&&L.size===0)return await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u8BF7\\u5148\\u9009\\u62E9\\u8981\\u5220\\u9664\\u7684\\u9879\\u76EE\\u3002\"});let Y=\"\\u60A8\\u786E\\u5B9A\\u8981\\u6C38\\u4E45\\u5220\\u9664\",P=[];d.size>0&&P.push(`\\u9009\\u4E2D\\u7684 ${d.size} \\u672C\\u4E16\\u754C\\u4E66`),C>0&&P.push(`${C} \\u4E2A\\u6761\\u76EE`),L.size>0&&P.push(`${L.size} \\u4E2A\\u6B63\\u5219`),Y+=` ${P.join(\"\\u548C\")} \\u5417\\uFF1F\\u6B64\\u64CD\\u4F5C\\u65E0\\u6CD5\\u64A4\\u9500\\u3002`;try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u5220\\u9664\",text:Y})}catch{return}let U=or(\"\\u5F00\\u59CB\\u5220\\u9664...\");try{let W=0,j=0,Z=0,ne=0,ie=0,oe=Array.from(p.entries());for(let[$e,Ee]of oe){if(d.has($e)){ne+=Ee.length;continue}U.update(`\\u6B63\\u5728\\u5220\\u9664\\u6761\\u76EE... (${ne}/${C})`);let we=await G.deleteWorldbookEntries($e,Ee);ne+=Ee.length,we&&we.deleted_entries&&we.deleted_entries.length>0&&(j+=we.deleted_entries.length,Ae($e,we.worldbook.map(Ze)),Ee.forEach(Re=>t.selectedItems.delete(`lore:${$e}:${Re}`)))}let ke=Array.from(d);for(let $e of ke){if(U.update(`\\u6B63\\u5728\\u5220\\u9664\\u4E16\\u754C\\u4E66... (${ie+1}/${ke.length})`),await G.deleteWorldbook($e)){W++,t.allLorebooks=t.allLorebooks.filter(Ee=>Ee.name!==$e),Nr($e),t.selectedItems.delete(`book:${$e}`);for(let Ee of t.selectedItems)Ee.startsWith(`lore:${$e}:`)&&t.selectedItems.delete(Ee)}ie++}if(L.size>0){U.update(`\\u6B63\\u5728\\u5220\\u9664 ${L.size} \\u4E2A\\u6B63\\u5219...`);let $e=await G.getRegexes(),Ee=$e.filter(we=>!L.has(String(we.id)));await G.replaceRegexes(Ee.filter(we=>we.source!==\"card\")),await G.saveSettings(),Z=$e.length-Ee.length,t.regexes.global=t.regexes.global.filter(we=>!L.has(String(we.id))),t.regexes.character=t.regexes.character.filter(we=>!L.has(String(we.id))),Xe(t.regexes.global),Xe(t.regexes.character),L.forEach(we=>t.selectedItems.delete(`regex:${we}`))}U.remove();let je=[];W>0&&je.push(`\\u6210\\u529F\\u5220\\u9664 ${W} \\u672C\\u4E16\\u754C\\u4E66`),j>0&&je.push(`\\u6210\\u529F\\u5220\\u9664 ${j} \\u4E2A\\u6761\\u76EE`),Z>0&&je.push(`\\u6210\\u529F\\u5220\\u9664 ${Z} \\u4E2A\\u6B63\\u5219`),je.length>0?(me(je.join(\"\\uFF0C\")),t.multiSelectMode?Sr():le()):await X({type:\"alert\",title:\"\\u5220\\u9664\\u5931\\u8D25\",text:\"\\u5220\\u9664\\u9879\\u76EE\\u65F6\\u53D1\\u751F\\u9519\\u8BEF\\uFF0C\\u8BF7\\u68C0\\u67E5\\u63A7\\u5236\\u53F0\\u3002\"})}catch(W){U.remove(),console.error(\"[RegexLoreHub] Batch delete failed:\",W),await X({type:\"alert\",title:\"\\u5220\\u9664\\u5931\\u8D25\",text:`\\u64CD\\u4F5C\\u5931\\u8D25: ${W.message}`}),await ze(!0)}}),Co=R(async()=>{if(!Array.isArray(t.allLorebooks)||t.allLorebooks.length===0){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u6CA1\\u6709\\u627E\\u5230\\u53EF\\u4EE5\\u6E05\\u7406\\u7684\\u4E16\\u754C\\u4E66\\u3002\"});return}let d=t.allLorebooks.filter(P=>{let U=t.lorebookUsage instanceof Map?t.lorebookUsage.get(P.name):[],W=Array.isArray(U)?U:[];return!P.enabled&&W.length===0}).map(P=>P.name);if(d.length===0){await X({type:\"alert\",title:\"\\u63D0\\u793A\",text:\"\\u6CA1\\u6709\\u627E\\u5230\\u672A\\u542F\\u7528\\u4E14\\u672A\\u7ED1\\u5B9A\\u89D2\\u8272\\u5361\\u7684\\u4E16\\u754C\\u4E66\\u3002\"});return}t.multiSelectMode=!0,t.multiSelectTarget=\"book\",t.selectedItems.clear(),d.forEach(P=>t.selectedItems.add(\"book:\"+P)),le();let p=\"\\u5C06\\u5220\\u9664 \"+d.length+\" \\u672C\\u672A\\u542F\\u7528\\u4E14\\u672A\\u7ED1\\u5B9A\\u89D2\\u8272\\u5361\\u7684\\u4E16\\u754C\\u4E66\\u3002\\u56E0API\\u9650\\u5236\\uFF0C\\u65E0\\u6CD5\\u76F4\\u63A5\\u83B7\\u53D6\\u804A\\u5929\\u7ED1\\u5B9A\\u4E16\\u754C\\u4E66\\uFF0C\\u5B58\\u5728\\u8BEF\\u5220\\u8BE5\\u4E16\\u754C\\u4E66\\u7684\\u53EF\\u80FD\\u3002\\u786E\\u5B9A\\u7EE7\\u7EED\\u5417\\uFF1F\";try{await X({type:\"confirm\",title:\"\\u786E\\u8BA4\\u6E05\\u7406\\u5B64\\u7ACB\\u4E16\\u754C\\u4E66\",text:p})}catch{return}let L=or(\"\\u5F00\\u59CB\\u6E05\\u7406\\u5B64\\u7ACB\\u4E16\\u754C\\u4E66...\"),C=[],Y=0;try{for(let P=0;P<d.length;P+=1){let U=d[P];L.update(\"\\u6B63\\u5728\\u5220\\u9664\\u7B2C \"+(P+1)+\" / \"+d.length+\" \\u672C\\u4E16\\u754C\\u4E66...\"),await G.deleteWorldbook(U)?(Y+=1,t.allLorebooks=t.allLorebooks.filter(Z=>Z.name!==U),Nr(U),t.lorebookUsage instanceof Map&&t.lorebookUsage.has(U)&&t.lorebookUsage.delete(U),Array.isArray(t.lorebooks?.character)&&(t.lorebooks.character=t.lorebooks.character.filter(Z=>Z!==U)),t.chatLorebook===U&&(t.chatLorebook=null),t.activeCharacterBook===U&&(t.activeCharacterBook=null),t.activeBookName===U&&(t.activeBookName=null),t.selectedItems.delete(\"book:\"+U),[...t.selectedItems].forEach(Z=>{Z.startsWith(\"lore:\"+U+\":\")&&t.selectedItems.delete(Z)})):C.push(U)}}catch(P){L.remove(),console.error(\"[RegexLoreHub] Clean orphan lorebooks failed:\",P),await X({type:\"alert\",title:\"\\u64CD\\u4F5C\\u5931\\u8D25\",text:\"\\u6E05\\u7406\\u5B64\\u7ACB\\u4E16\\u754C\\u4E66\\u65F6\\u53D1\\u751F\\u9519\\u8BEF\\uFF1A\"+(P?.message||P)}),await ze(!0);return}L.remove(),Y>0&&me(\"\\u5DF2\\u5220\\u9664 \"+Y+\" \\u672C\\u5B64\\u7ACB\\u4E16\\u754C\\u4E66\"),C.length>0?(t.selectedItems.clear(),C.forEach(P=>t.selectedItems.add(\"book:\"+P)),await X({type:\"alert\",title:\"\\u90E8\\u5206\\u5220\\u9664\\u5931\\u8D25\",text:\"\\u4EE5\\u4E0B\\u4E16\\u754C\\u4E66\\u672A\\u80FD\\u5220\\u9664\\uFF1A\"+C.join(\"\\u3001\")})):(t.selectedItems.clear(),t.multiSelectMode=!1),le()}),Nt=R(async d=>{let p=new Set,L=new Map,C=new Set,Y=!1,P=!1;for(let U of t.selectedItems){let{type:W,bookName:j,entryId:Z,regexId:ne}=i(U);if(W===\"book\"&&j)p.add(j);else if(W===\"lore\"&&j){let ie=Number(Z);if(!Number.isFinite(ie))continue;L.has(j)||L.set(j,[]),L.get(j).push(ie)}else if(W===\"regex\"){let ie=ne!=null&&ne!==\"\"?String(ne):\"\";ie&&C.add(ie)}}if(p.size>0){let U=new Set(await G.getGlobalWorldbookNames()||[]);p.forEach(W=>d?U.add(W):U.delete(W)),await G.rebindGlobalWorldbooks(Array.from(U)),P=!0,p.forEach(W=>{let j=t.allLorebooks.find(Z=>Z.name===W);j&&(j.enabled=d)})}if(L.size>0)for(let[U,W]of L){let j=[...te(U)];if(j){let Z=W.map(ne=>{let ie=j.find(oe=>oe.uid===ne);return ie?(ie.enabled=d,{uid:ne,enabled:d}):null}).filter(Boolean);Z.length>0&&await Pe(U,Z)}}if(await G.saveSettings(),C.size>0){let U=await G.getRegexes();U.forEach(W=>{C.has(String(W.id))&&(W.enabled=d)}),await G.replaceRegexes(U.filter(W=>W.source!==\"card\")),Y=!0,[t.regexes.global,t.regexes.character].forEach(W=>W.forEach(j=>{C.has(String(j.id))&&(j.enabled=d)}))}(P||Y)&&await G.saveSettings(),t.selectedItems.clear(),le()}),To=R(async(d,p)=>{let L=r(d.target),C=r(d.currentTarget).closest(\".rlh-item-container, .rlh-book-group\");if(L.closest(\".rlh-item-controls, .rlh-rename-ui\").length>0||t.multiSelectMode&&k(C))return;if(!t.multiSelectMode&&t.activeTab===\"global-lore\"&&t.activeView===\"global-lore-list\"&&C.is(\".rlh-book-group\")&&L.closest(\".rlh-book-title-wrapper\").length>0){let P=C.data(\"book-name\");P&&a?.handleEnterLorebookDetail&&await a.handleEnterLorebookDetail(P);return}if(C.hasClass(\"from-card\")||C.hasClass(\"renaming\"))return;let Y=C.find(\".rlh-collapsible-content\").first();if(C.is(\".rlh-book-group\")&&t.activeTab!==\"global-lore\"){Y.slideToggle(200);return}if(C.is(\".rlh-item-container\")){if(Y.is(\":visible\")){Y.stop(!0,!0).slideUp(200,()=>{Y.off(\"input.rlh\"),Y.empty(),Y.attr(\"data-entry-mode\",\"collapsed\")}),C.attr(\"data-entry-mode\",\"collapsed\");return}p?.bulk||C.siblings(\".rlh-item-container\").find(\".rlh-collapsible-content:visible\").slideUp(200).empty();let P=C.data(\"type\"),U=C.data(\"id\"),W=C.data(\"searchTerm\"),j=C.attr(\"data-search-term\"),Z=typeof W==\"string\"&&W.length>0?W:typeof j==\"string\"&&j.length>0?j:\"\";if(P===\"lore\"){let ne=C.data(\"book-name\"),oe=[...te(ne)].find(ke=>ke.uid===Number(U));if(!oe)return;l.renderLoreEntryViewer(C,oe,Z,{animate:!0});return}if(P===\"regex\"){let ne=[...t.regexes.global,...t.regexes.character].find(oe=>oe.id===U);if(!ne)return;C.attr(\"data-entry-mode\")===\"edit\"?l.renderRegexEditor(C,ne,{animate:!0}):l.renderRegexViewer(C,ne,Z,{animate:!0});return}}}),No=R(async d=>{if(!t.multiSelectMode||r(d.target).closest(\".rlh-item-controls, .rlh-rename-ui, .rlh-action-btn, .rlh-action-btn-icon, .rlh-toggle-btn, .rlh-selection-control, .rlh-multi-select-checkbox, .rlh-item-header, .rlh-global-book-header\").length>0)return;let L=r(d.currentTarget).closest(\".rlh-item-container, .rlh-book-group\");L.length&&k(L)&&(d.stopPropagation(),d.preventDefault())}),Io=R(async d=>{d.stopPropagation();let p=r(d.currentTarget),L=p.closest(\".rlh-book-group\"),C=!L.hasClass(\"editing-entries\");L.toggleClass(\"editing-entries\"),C?(t.multiSelectMode||(t.multiSelectMode=!0,r(\"#rlh-multi-select-btn\",o).addClass(\"active\"),r(\"#rlh-multi-select-controls\",o).addClass(\"active\"),r(`#${ue}`,o).addClass(\"rlh-multi-select-mode\")),L.find(\".rlh-collapsible-content\").first().slideDown(200),p.attr(\"title\",\"\\u5B8C\\u6210\\u7F16\\u8F91\").find(\"i\").removeClass(\"fa-pen-to-square\").addClass(\"fa-check-square\"),p.addClass(\"active\")):(p.attr(\"title\",\"\\u7F16\\u8F91/\\u9009\\u62E9\\u6761\\u76EE\").find(\"i\").removeClass(\"fa-check-square\").addClass(\"fa-pen-to-square\"),p.removeClass(\"active\"))}),Ro=R(async d=>{let L=r(d.currentTarget).find(\"i\");L.addClass(\"fa-spin\");let C=null;t.activeView===\"global-lore-detail\"&&t.activeBookName&&(C=te(t.activeBookName),console.log(`[RegexLoreHub] \\u5168\\u5C40\\u5237\\u65B0\\u65F6\\u7F13\\u5B58\\u8BE6\\u60C5\\u89C6\\u56FE\\u6761\\u76EE: ${t.activeBookName}`)),Br(),await ze(!0),C&&t.activeView===\"global-lore-detail\"&&t.activeBookName&&(Ae(t.activeBookName,C),pr(t.activeBookName),console.log(`[RegexLoreHub] \\u6062\\u590D\\u8BE6\\u60C5\\u89C6\\u56FE\\u6761\\u76EE: ${t.activeBookName}`),Le(t.activeBookName,!0).catch(Y=>{console.warn(`[RegexLoreHub] \\u6062\\u590D\\u540E\\u5237\\u65B0\\u6761\\u76EE\\u5931\\u8D25: ${t.activeBookName}`,Y)}),le()),setTimeout(()=>L.removeClass(\"fa-spin\"),500)}),Ao=R(async d=>{if(t.activeView===\"global-lore-list\")a?.handleCreateLorebook&&await a.handleCreateLorebook(d);else if(t.activeView===\"global-lore-detail\"){if(!t.activeBookName)return;if(l?.handleCreateEntry){let p={currentTarget:r(`<button data-book-name=\"${t.activeBookName}\"></button>`)};await l.handleCreateEntry(p)}}});return{handleGlobalSearch:A,handleSearchClear:T,handleSearchInputKeydown:M,handleReplace:J,handleToolbarToggleCollapse:de,handleSortMenuToggle:c,handleSortOptionSelect:g,handlePositionMenuToggle:ee,handlePositionOptionSelect:pe,handleUnifiedStatusMenuToggle:fe,handleUnifiedStatusOptionSelect:ve,handleCharacterBookSwitch:Ie,handleSelectionCheckboxChange:Fe,togglePanel:Be,switchTab:ur,toggleMultiSelectMode:Sr,handleSelectAll:ot,handleSelectNone:_o,handleSelectInvert:So,handleBatchEnable:$o,handleBatchDisable:Eo,handleBatchDelete:Lo,handleCleanOrphanLorebooks:Co,handleHeaderClick:To,handleMultiSelectContainerClick:No,handleEditEntriesToggle:Io,handleRefresh:Ro,handlePrimaryCreateButtonClick:Ao}}function ko(){let e=ce(),r=be(),o=_e(),a={$:e,parentDoc:r,parentWin:o},l=go(a),n=xo(a),i=yo({...a,lorebookHandlers:l,itemHandlers:n});return{...l,...n,...i}}var Et=`\n/*! tailwindcss v4.1.13 | MIT License | https://tailwindcss.com */\n@layer theme{:root,:host{--rlh-font-sans:ui-sans-serif,system-ui,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";--rlh-spacing:.25rem;--rlh-text-sm:.875rem;--rlh-text-sm--line-height:calc(1.25/.875);--rlh-text-base:1rem;--rlh-text-base--line-height:calc(1.5/1);--rlh-font-weight-medium:500;--rlh-radius-lg:.5rem;--rlh-radius-xl:.75rem;--rlh-ease-out:cubic-bezier(0,0,.2,1);--rlh-blur-xl:24px;--rlh-default-transition-duration:.15s;--rlh-default-transition-timing-function:cubic-bezier(.4,0,.2,1)}}@layer utilities;@layer base{#regex-lore-hub-panel *{text-shadow:none!important}#regex-lore-hub-panel{--rlh-panel-radius:20px;--rlh-focus-ring:0 0 0 2px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel{--rlh-focus-ring:0 0 0 2px color-mix(in srgb,var(--rlh-accent-color)55%,transparent)}}#regex-lore-hub-panel{--rlh-bg-color:#f5f7fb;--rlh-surface-color:#fffd;--rlh-text-color:#0f172a;--rlh-em-color:#475569;--rlh-border-color:#bfc8f5;--rlh-hover-bg:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel{--rlh-hover-bg:color-mix(in srgb,var(--rlh-accent-color)12%,transparent)}}#regex-lore-hub-panel{--rlh-selected-bg:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel{--rlh-selected-bg:color-mix(in srgb,var(--rlh-accent-color)20%,transparent)}}#regex-lore-hub-panel{--rlh-shadow-color:#0f172a2e;--rlh-header-bg:#eef2ffd9;--rlh-input-bg:#ffffffeb;--rlh-accent-color:#4f46e5;--rlh-green:#10b981;--rlh-red:#ef4444;--rlh-green-bg:var(--rlh-green)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel{--rlh-green-bg:color-mix(in srgb,var(--rlh-green)18%,transparent)}}#regex-lore-hub-panel{--rlh-red-bg:var(--rlh-red)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel{--rlh-red-bg:color-mix(in srgb,var(--rlh-red)18%,transparent)}}#regex-lore-hub-panel{--rlh-status-constant:#22c55e;--rlh-status-selective:#3b82f6;--rlh-status-vectorized:#a855f7}#regex-lore-hub-panel.dark{--rlh-bg-color:#101827;--rlh-surface-color:#111827cc;--rlh-text-color:#f9fafb;--rlh-em-color:#cbd5e1;--rlh-border-color:#2d3748;--rlh-hover-bg:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark{--rlh-hover-bg:color-mix(in srgb,var(--rlh-accent-color)14%,transparent)}}#regex-lore-hub-panel.dark{--rlh-selected-bg:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark{--rlh-selected-bg:color-mix(in srgb,var(--rlh-accent-color)22%,transparent)}}#regex-lore-hub-panel.dark{--rlh-shadow-color:#02061780;--rlh-header-bg:#0f172ae6;--rlh-input-bg:#1f2937d9;--rlh-accent-color:#6366f1;--rlh-green:#10b981;--rlh-red:#fb7185;--rlh-green-bg:var(--rlh-green)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark{--rlh-green-bg:color-mix(in srgb,var(--rlh-green)20%,transparent)}}#regex-lore-hub-panel.dark{--rlh-red-bg:var(--rlh-red)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark{--rlh-red-bg:color-mix(in srgb,var(--rlh-red)20%,transparent)}}#regex-lore-hub-panel.dark{--rlh-status-constant:#34d399;--rlh-status-selective:#60a5fa;--rlh-status-vectorized:#c084fc}@keyframes rlhFadeInUp{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes rlhSoftPulse{}@keyframes rlhToastIn{0%{opacity:0;transform:translate(-50%)translateY(28px)scale(.96)}60%{opacity:1;transform:translate(-50%)translateY(-4px)scale(1.02)}to{opacity:1;transform:translate(-50%)translateY(0)scale(1)}}@keyframes rlhHighlightPulse{0%{background-color:#fde68a}50%{background-color:#facc15}to{background-color:#fde68a}}}@layer components{#regex-lore-hub-panel{z-index:10000;width:100%;height:100dvh;min-height:100svh;color:var(--rlh-text-color);background:var(--rlh-bg-color);justify-content:center;align-items:center;padding:clamp(.8rem,1.5vw,1.3rem);display:none;position:fixed;inset:0}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel{background:color-mix(in srgb,var(--rlh-bg-color)92%,transparent)}}#regex-lore-hub-panel{-webkit-backdrop-filter:blur(24px);backdrop-filter:blur(24px);font-family:Inter,Segoe UI,Microsoft YaHei,sans-serif;transition:opacity .25s}@media (max-width:1024px){#regex-lore-hub-panel{justify-content:flex-start;align-items:stretch}}#regex-lore-hub-panel .rlh-shell{border-radius:var(--rlh-panel-radius);background:var(--rlh-surface-color);border:1px solid var(--rlh-border-color);width:min(1250px,100%);height:100%;box-shadow:0 32px 120px -60px var(--rlh-shadow-color);flex-direction:column;gap:clamp(.45rem,1vw,.75rem);margin:0 auto;padding:clamp(.75rem,1.4vw,1.15rem);animation:.3s ease-out both rlhFadeInUp;display:flex;position:relative;overflow:hidden}#regex-lore-hub-panel .rlh-shell:before{content:\"\";background:radial-gradient(circle at top right,var(--rlh-accent-color)0%,transparent 60%),radial-gradient(circle at bottom left,var(--rlh-green)0%,transparent 65%);position:absolute;inset:-140px}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel .rlh-shell:before{background:radial-gradient(circle at top right,color-mix(in srgb,var(--rlh-accent-color)24%,transparent)0%,transparent 60%),radial-gradient(circle at bottom left,color-mix(in srgb,var(--rlh-green)18%,transparent)0%,transparent 65%)}}#regex-lore-hub-panel .rlh-shell:before{opacity:.32;pointer-events:none}@media (max-width:768px){#regex-lore-hub-panel .rlh-shell{border-radius:14px;padding:.55rem}}@media (min-width:1360px){#regex-lore-hub-panel .rlh-shell{border-radius:20px;padding:1.05rem 1.3rem}}.rlh-shell-header{justify-content:space-between;align-items:center;gap:.55rem;padding-block:.08rem;display:flex}.rlh-shell-title{flex-direction:column;gap:.18rem;display:flex}.rlh-shell-title h4{color:var(--rlh-text-color);margin:0;font-size:clamp(1rem,2vw,1.3rem);font-weight:600;line-height:1.2}.rlh-shell-meta{color:var(--rlh-em-color);align-items:center;gap:.35rem;font-size:max(.8125rem,13px);line-height:1.2;display:inline-flex;margin:0!important}.rlh-shell-version{background:var(--rlh-accent-color);border-radius:9999px;align-items:center;padding:.1rem .55rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-shell-version{background:color-mix(in srgb,var(--rlh-accent-color)16%,transparent)}}.rlh-shell-version{color:var(--rlh-text-color);font-size:.78rem;font-weight:600}.rlh-shell-dot{color:var(--rlh-em-color)}@supports (color:color-mix(in lab, red, red)){.rlh-shell-dot{color:color-mix(in srgb,var(--rlh-em-color)80%,transparent)}}.rlh-shell-dot{font-size:max(.8125rem,13px);line-height:1}.rlh-shell-updated{color:var(--rlh-em-color);font-size:.78rem}.rlh-shell-actions{align-items:center;gap:.4rem;display:flex}.rlh-shell-right{align-items:center;gap:.6rem;margin-left:auto;display:flex}.rlh-prefetch-indicator{text-align:right;flex-direction:column;align-items:flex-end;gap:.35rem;width:clamp(200px,34vw,320px);display:none}.rlh-prefetch-indicator[data-visible=true]{display:flex}.rlh-prefetch-text{color:var(--rlh-em-color);white-space:normal;font-size:.78rem}#rlh-prefetch-progress-text{width:100%}.rlh-prefetch-bar{background:var(--rlh-accent-color);border-radius:9999px;width:100%;height:4px;position:relative}@supports (color:color-mix(in lab, red, red)){.rlh-prefetch-bar{background:color-mix(in srgb,var(--rlh-accent-color)20%,transparent)}}.rlh-prefetch-bar{overflow:hidden}.rlh-prefetch-bar-inner{border-radius:inherit;background:var(--rlh-accent-color);width:0%;height:100%;transition:width .25s;display:block}.rlh-icon-button,.rlh-close-button{width:2.25rem;height:2.25rem;color:var(--rlh-text-color);cursor:pointer;background-color:#0000;border:1px solid #0000;border-radius:9999px;justify-content:center;align-items:center;transition:color .2s,background-color .2s,border-color .2s;display:inline-flex}.rlh-icon-button:hover,.rlh-close-button:hover{background-color:var(--rlh-hover-bg);border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-icon-button:hover,.rlh-close-button:hover{border-color:color-mix(in srgb,var(--rlh-accent-color)35%,transparent)}}.rlh-theme-toggle{border:1px solid var(--rlh-accent-color);border-radius:9999px;align-items:center;gap:.35rem;padding:.4rem .9rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-theme-toggle{border:1px solid color-mix(in srgb,var(--rlh-accent-color)28%,transparent)}}.rlh-theme-toggle{background-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-theme-toggle{background-color:color-mix(in srgb,var(--rlh-accent-color)12%,transparent)}}.rlh-theme-toggle{color:var(--rlh-text-color);cursor:pointer;font-size:.85rem;font-weight:500;transition:background-color .2s,color .2s,border-color .2s}.rlh-theme-toggle:hover{background-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-theme-toggle:hover{background-color:color-mix(in srgb,var(--rlh-accent-color)18%,transparent)}}.rlh-tab-nav{background-color:var(--rlh-header-bg);flex-wrap:wrap;gap:.4rem;padding:.35rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-tab-nav{background-color:color-mix(in srgb,var(--rlh-header-bg)85%,transparent)}}.rlh-tab-nav{border:1px solid var(--rlh-border-color);border-radius:9999px}@supports (color:color-mix(in lab, red, red)){.rlh-tab-nav{border:1px solid color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}.rlh-tab{color:var(--rlh-em-color);cursor:pointer;border-radius:9999px;justify-content:center;align-items:center;gap:.55rem;padding:.4rem 1.1rem;font-size:.9rem;font-weight:500;transition:color .2s,background-color .2s,transform .2s;display:inline-flex}.rlh-tab:hover{background-color:var(--rlh-hover-bg);color:var(--rlh-text-color)}.rlh-tab.active{background-color:var(--rlh-selected-bg);color:var(--rlh-text-color);box-shadow:inset 0 0 0 1px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-tab.active{box-shadow:inset 0 0 0 1px color-mix(in srgb,var(--rlh-accent-color)60%,transparent)}}.rlh-tab-text-short{display:none}@media (max-width:640px){.rlh-tab-text-full{display:none}.rlh-tab-text-short{display:inline}}.rlh-main-area{flex-direction:column;flex:auto;gap:clamp(.6rem,1.4vw,1rem);width:100%;min-height:0;padding:0;display:flex}.rlh-toolbar-shell{flex-direction:column;gap:clamp(.6rem,1.3vw,.95rem);width:100%;display:flex}.rlh-toolbar-container,.rlh-replace-container{flex-direction:column;gap:clamp(.65rem,1.1vw,.9rem);display:flex}.rlh-toolbar-inner{background-color:var(--rlh-surface-color);border-radius:16px;flex-direction:column;gap:clamp(.125rem,.3vw,.25rem);padding:clamp(.25rem,.5vw,.4rem);display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-inner{background-color:color-mix(in srgb,var(--rlh-surface-color)95%,var(--rlh-accent-color)5%)}}.rlh-toolbar-inner{border:1px solid var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-inner{border:1px solid color-mix(in srgb,var(--rlh-accent-color)24%,var(--rlh-border-color))}}.rlh-toolbar-inner{box-shadow:0 16px 42px -34px var(--rlh-shadow-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-inner{box-shadow:0 16px 42px -34px color-mix(in srgb,var(--rlh-shadow-color)78%,transparent)}}@media (max-width:768px){.rlh-toolbar-inner{border-radius:14px;padding:.55rem}.rlh-toolbar-section{gap:.4rem;padding:.45rem}}@media (min-width:1360px){.rlh-toolbar-inner{gap:1.1rem;padding:1.05rem 1.3rem}.rlh-toolbar-section{gap:.8rem;padding:.6rem .8rem}}.rlh-toolbar-section{background-color:#0000;border:none;border-radius:12px;flex-direction:column;gap:clamp(.1rem,.3vw,.2rem);padding:clamp(.1rem,.25vw,.2rem);display:flex}.rlh-toolbar-section--search,.rlh-toolbar-section--actions,.rlh-toolbar-section--multiselect{background-color:#0000}.rlh-toolbar-section--actions{flex-direction:row;align-items:center}.rlh-search-section-grid{flex-wrap:nowrap;align-items:stretch;gap:clamp(.25rem,.7vw,.5rem);display:flex}.rlh-search-section-main{flex:18rem;min-width:0}.rlh-search-section-multiselect{flex:0 14rem;justify-content:flex-start;align-items:flex-start;min-width:10rem;max-width:20rem;padding:5px 0 0;display:flex}.rlh-search-section-multiselect .rlh-multi-select-module{flex-direction:column;align-items:flex-start;gap:.25rem;width:100%;display:flex}.rlh-toolbar-section--actions .rlh-toolbar-actions{flex-wrap:wrap;justify-content:flex-start;align-items:center;gap:clamp(.25rem,.6vw,.45rem);width:100%;display:flex;overflow:visible}.rlh-toolbar-section--actions .rlh-toolbar-actions>*{flex-shrink:0}@media (max-width:960px){.rlh-search-section-grid{flex-direction:column}.rlh-search-section-main,.rlh-search-section-multiselect{flex:100%;max-width:none}.rlh-search-box{grid-template-columns:minmax(0,1fr);grid-template-areas:\"row\"\"replace\"\"meta\"}.rlh-replace-body{grid-template-columns:minmax(0,1fr) auto}}.rlh-content-pane{flex-direction:column;flex:auto;gap:clamp(.8rem,1.6vw,1.2rem);min-height:0;padding:0;display:flex}.rlh-content-pane>*{min-width:0}@media (max-width:768px){.rlh-content-pane{gap:.6rem}}.rlh-toolbar-btn{border:1px solid var(--rlh-accent-color);border-radius:12px;justify-content:flex-start;align-items:center;gap:.35rem;padding:.125rem .75rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn{border:1px solid color-mix(in srgb,var(--rlh-accent-color)45%,var(--rlh-border-color)55%)}}.rlh-toolbar-btn{background-color:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn{background-color:color-mix(in srgb,var(--rlh-surface-color)88%,var(--rlh-accent-color)12%)}}.rlh-toolbar-btn{color:var(--rlh-text-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn{color:color-mix(in srgb,var(--rlh-text-color)90%,var(--rlh-accent-color)10%)}}.rlh-toolbar-btn{cursor:pointer;box-shadow:inset 0 0 0 1px var(--rlh-accent-color);font-size:.9rem;font-weight:500}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn{box-shadow:inset 0 0 0 1px color-mix(in srgb,var(--rlh-accent-color)25%,transparent)}}.rlh-toolbar-btn{transition:color .2s,background-color .2s,border-color .2s,box-shadow .2s,transform .2s}.rlh-toolbar-icon-btn{border:1px solid var(--rlh-accent-color);border-radius:12px;justify-content:center;align-items:center;width:2.1rem;height:2.1rem;padding:0;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-icon-btn{border:1px solid color-mix(in srgb,var(--rlh-accent-color)45%,var(--rlh-border-color)55%)}}.rlh-toolbar-icon-btn{background-color:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-icon-btn{background-color:color-mix(in srgb,var(--rlh-surface-color)88%,var(--rlh-accent-color)12%)}}.rlh-toolbar-icon-btn{color:var(--rlh-text-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-icon-btn{color:color-mix(in srgb,var(--rlh-text-color)90%,var(--rlh-accent-color)10%)}}.rlh-toolbar-icon-btn{cursor:pointer;line-height:1;transition:color .2s,background-color .2s,border-color .2s,box-shadow .2s,transform .2s}.rlh-toolbar-icon-btn i{font-size:.95rem}.rlh-toolbar-icon-btn:hover{background-color:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-icon-btn:hover{background-color:color-mix(in srgb,var(--rlh-surface-color)92%,var(--rlh-accent-color)20%)}}.rlh-toolbar-icon-btn:hover{color:var(--rlh-text-color)}.rlh-toolbar-icon-btn:focus{box-shadow:0 0 0 2px var(--rlh-accent-color);outline:none}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-icon-btn:focus{box-shadow:0 0 0 2px color-mix(in srgb,var(--rlh-accent-color)35%,transparent)}}.rlh-search-row .rlh-toolbar-icon-btn,.rlh-replace-body .rlh-toolbar-icon-btn{width:2rem;height:2rem}.rlh-toolbar-btn i{font-size:.95rem}.rlh-toggle-btn i,.rlh-action-btn-icon i,.rlh-toolbar-btn i{transition:transform .25s}.rlh-toolbar-btn span{white-space:nowrap}.rlh-toggle-btn:hover i,.rlh-action-btn-icon:hover i,.rlh-toolbar-btn:hover i{transform:translateY(-1px)scale(1.08)}.rlh-toolbar-group--leading .rlh-toolbar-btn,.rlh-toolbar-group--actions .rlh-toolbar-btn{width:100%}.rlh-toolbar-btn:hover{background-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:hover{background-color:color-mix(in srgb,var(--rlh-accent-color)26%,var(--rlh-surface-color))}}.rlh-toolbar-btn:hover{border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:hover{border-color:color-mix(in srgb,var(--rlh-accent-color)70%,var(--rlh-border-color)30%)}}.rlh-toolbar-btn:hover{box-shadow:inset 0 0 0 1.5px var(--rlh-accent-color),0 10px 22px -16px var(--rlh-shadow-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:hover{box-shadow:inset 0 0 0 1.5px color-mix(in srgb,var(--rlh-accent-color)45%,transparent),0 10px 22px -16px var(--rlh-shadow-color)}}.rlh-toolbar-btn:hover{color:var(--rlh-text-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:hover{color:color-mix(in srgb,var(--rlh-text-color)85%,var(--rlh-accent-color)15%)}}.rlh-toolbar-btn:hover{transform:translateY(-1px)scale(1.01)}.rlh-toolbar-btn:disabled,.rlh-toolbar-btn.disabled{cursor:not-allowed;opacity:.55;box-shadow:none;border-color:var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:disabled,.rlh-toolbar-btn.disabled{border-color:color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-toolbar-btn:disabled,.rlh-toolbar-btn.disabled{color:var(--rlh-text-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:disabled,.rlh-toolbar-btn.disabled{color:color-mix(in srgb,var(--rlh-text-color)75%,var(--rlh-accent-color)5%)}}.rlh-toolbar-btn:focus-visible{box-shadow:0 0 0 2px var(--rlh-accent-color),inset 0 0 0 1.5px var(--rlh-accent-color);outline:none;animation:1.1s ease-out rlhSoftPulse}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:focus-visible{box-shadow:0 0 0 2px color-mix(in srgb,var(--rlh-accent-color)40%,transparent),inset 0 0 0 1.5px color-mix(in srgb,var(--rlh-accent-color)45%,transparent)}}.rlh-toolbar-btn.active{background-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn.active{background-color:color-mix(in srgb,var(--rlh-accent-color)32%,var(--rlh-surface-color))}}.rlh-toolbar-btn.active{border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn.active{border-color:color-mix(in srgb,var(--rlh-accent-color)75%,var(--rlh-border-color)25%)}}.rlh-toolbar-btn.active{box-shadow:inset 0 0 0 2px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn.active{box-shadow:inset 0 0 0 2px color-mix(in srgb,var(--rlh-accent-color)50%,transparent)}}.rlh-toolbar-btn.active{color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn.active{color:color-mix(in srgb,var(--rlh-accent-color)70%,var(--rlh-text-color))}}.rlh-search-field{border:1px solid var(--rlh-border-color);border-radius:12px;align-items:center;gap:0;width:100%;min-width:0;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-search-field{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-search-field{background-color:var(--rlh-input-bg);transition:border-color .2s,box-shadow .2s,color .2s;overflow:hidden}.rlh-search-row{grid-area:row;grid-template-columns:minmax(0,1fr) auto;align-items:center;gap:.125rem;width:100%;display:grid}.rlh-search-box{border:1px solid var(--rlh-border-color);border-radius:12px;grid-template-columns:minmax(0,1fr) auto;grid-template-areas:\"row replace\"\"meta meta\";gap:.125rem;padding:.2rem .3rem;display:grid}@supports (color:color-mix(in lab, red, red)){.rlh-search-box{border:1px solid color-mix(in srgb,var(--rlh-border-color)45%,transparent)}}.rlh-search-box{background-color:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-search-box{background-color:color-mix(in srgb,var(--rlh-surface-color)90%,transparent)}}.rlh-search-box{box-shadow:0 8px 28px -24px var(--rlh-shadow-color)}.rlh-search-field .rlh-search-input{min-width:0;color:inherit;background:0 0;border:none;flex:auto;padding:.4rem .6rem;font-size:1rem}.rlh-search-field .rlh-search-input:focus{box-shadow:none;border:none;outline:none}.rlh-search-field:focus-within{border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-search-field:focus-within{border-color:color-mix(in srgb,var(--rlh-accent-color)70%,transparent)}}.rlh-search-field:focus-within{box-shadow:var(--rlh-focus-ring);color:var(--rlh-text-color)}.rlh-search-meta{color:var(--rlh-em-color);flex-direction:row;grid-area:meta;align-items:center;gap:.4rem;font-size:.85rem;display:flex}.rlh-search-scope{color:var(--rlh-accent-color);font-weight:500}@supports (color:color-mix(in lab, red, red)){.rlh-search-scope{color:color-mix(in srgb,var(--rlh-accent-color)65%,var(--rlh-text-color))}}@media (max-width:1200px){.rlh-search-section-grid{flex-direction:column}.rlh-search-section-main,.rlh-search-section-multiselect{flex:100%;max-width:none}.rlh-search-box{grid-template-columns:minmax(0,1fr);grid-template-areas:\"row\"\"replace\"\"meta\"}.rlh-replace-body{grid-template-columns:minmax(0,1fr) auto}.rlh-search-meta{flex-wrap:wrap;justify-content:flex-start;gap:.35rem}}.rlh-sort-menu,.rlh-position-menu{align-items:center;width:auto;min-width:0;margin-left:auto;display:inline-flex;position:relative}.rlh-unified-status{align-items:stretch;min-width:0;display:inline-flex;position:relative}.rlh-unified-status-menu{border:1px solid var(--rlh-border-color);border-radius:12px;flex-direction:column;gap:.15rem;min-width:12rem;padding:.5rem;display:flex;position:absolute;top:calc(100% + .5rem);right:0}@supports (color:color-mix(in lab, red, red)){.rlh-unified-status-menu{border:1px solid color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}.rlh-unified-status-menu{background:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-unified-status-menu{background:color-mix(in srgb,var(--rlh-surface-color)95%,transparent)}}.rlh-unified-status-menu{box-shadow:0 24px 60px -28px var(--rlh-shadow-color);opacity:0;pointer-events:none;z-index:30;transition:opacity .18s,transform .18s;transform:translateY(8px)}.rlh-unified-status[data-open=true] .rlh-unified-status-menu{opacity:1;pointer-events:auto;transform:translate(0)}.rlh-unified-status-option{width:100%;color:inherit;cursor:pointer;background:0 0;border:none;border-radius:10px;justify-content:space-between;align-items:center;gap:.6rem;padding:.45rem .5rem;font-size:.85rem;font-weight:500;transition:background-color .18s,color .18s;display:flex}.rlh-unified-status-option:hover,.rlh-unified-status-option:focus-visible{background:var(--rlh-hover-bg)}@supports (color:color-mix(in lab, red, red)){.rlh-unified-status-option:hover,.rlh-unified-status-option:focus-visible{background:color-mix(in srgb,var(--rlh-hover-bg)75%,transparent)}}.rlh-unified-status-option:hover,.rlh-unified-status-option:focus-visible{outline:none}.rlh-unified-status-option__label{text-align:right;flex:auto;min-width:0}.rlh-sort-menu-list,.rlh-position-menu-list{background-color:var(--rlh-surface-color);border:1px solid var(--rlh-border-color);border-radius:14px;min-width:10rem;padding:.5rem;list-style:none;position:absolute;top:calc(100% + .5rem);right:0}@supports (color:color-mix(in lab, red, red)){.rlh-sort-menu-list,.rlh-position-menu-list{border:1px solid color-mix(in srgb,var(--rlh-border-color)55%,transparent)}}.rlh-sort-menu-list,.rlh-position-menu-list{box-shadow:0 24px 60px -36px var(--rlh-shadow-color);z-index:99;opacity:0;visibility:hidden;pointer-events:none;transition:opacity var(--rlh-default-transition-duration)var(--rlh-default-transition-timing-function),transform var(--rlh-default-transition-duration)var(--rlh-default-transition-timing-function),visibility 0s linear var(--rlh-default-transition-duration);will-change:opacity,transform;flex-direction:column;gap:.35rem;display:flex;transform:translateY(6px)scale(.98)}.rlh-toolbar-group--actions .rlh-sort-menu-list,.rlh-toolbar-group--actions .rlh-position-menu-list{left:0;right:auto}.rlh-sort-menu.open .rlh-sort-menu-list,.rlh-position-menu.open .rlh-position-menu-list{opacity:1;visibility:visible;pointer-events:auto;transition-delay:0s,0s,0s;transform:translateY(0)scale(1)}.rlh-sort-option,.rlh-position-option{width:100%;color:var(--rlh-text-color);cursor:pointer;background-color:#0000;border:1px solid #0000;border-radius:10px;justify-content:space-between;align-items:center;gap:.4rem;padding:.4rem .6rem;font-size:.9rem;transition:background-color .2s,border-color .2s,color .2s;display:flex}.rlh-sort-option:hover,.rlh-position-option:hover{background-color:var(--rlh-hover-bg);border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-sort-option:hover,.rlh-position-option:hover{border-color:color-mix(in srgb,var(--rlh-accent-color)35%,transparent)}}.rlh-sort-option.active,.rlh-position-option.active{background-color:var(--rlh-selected-bg);border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-sort-option.active,.rlh-position-option.active{border-color:color-mix(in srgb,var(--rlh-accent-color)60%,transparent)}}.rlh-sort-option.active,.rlh-position-option.active{color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-sort-option.active,.rlh-position-option.active{color:color-mix(in srgb,var(--rlh-accent-color)70%,var(--rlh-text-color))}}.rlh-replace-body{grid-area:replace;grid-template-columns:minmax(0,1fr) auto;align-items:center;gap:.25rem;width:100%;display:grid}.rlh-info-text{color:var(--rlh-em-color);font-size:.9rem}@supports (color:color-mix(in lab, red, red)){.rlh-info-text{color:color-mix(in srgb,var(--rlh-em-color)85%,transparent)}}.rlh-info-text{margin:.5rem 0}.rlh-info-text-small{color:var(--rlh-em-color);font-size:max(.8125rem,13px)}@supports (color:color-mix(in lab, red, red)){.rlh-info-text-small{color:color-mix(in srgb,var(--rlh-em-color)70%,transparent)}}.rlh-chat-lore-empty{text-align:center;background-color:var(--rlh-hover-bg);border-radius:16px;flex-direction:column;justify-content:center;align-items:center;gap:1rem;padding:2rem 1.5rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-chat-lore-empty{background-color:color-mix(in srgb,var(--rlh-hover-bg)60%,transparent)}}.rlh-chat-lore-empty{border:1px dashed var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-chat-lore-empty{border:1px dashed color-mix(in srgb,var(--rlh-border-color)75%,transparent)}}.rlh-detail-view{background-color:var(--rlh-surface-color);border-radius:18px;flex-direction:column;gap:.6rem;padding:.6rem .8rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-detail-view{background-color:color-mix(in srgb,var(--rlh-surface-color)94%,transparent)}}.rlh-detail-view{border:1px solid var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-detail-view{border:1px solid color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}.rlh-detail-view{box-shadow:0 24px 70px -50px var(--rlh-shadow-color)}@media (max-width:768px){.rlh-detail-view{gap:.6rem;padding:.6rem .8rem}.rlh-detail-header{gap:.4rem;padding:.4rem .6rem}.rlh-detail-content{gap:.4rem}.rlh-entry-list-wrapper{gap:.4rem;padding:.4rem 0}.rlh-detail-header h2{font-size:1rem;line-height:1.1}}.rlh-detail-header{grid-template-columns:auto 1fr auto;align-items:center;gap:.4rem;padding:.4rem .6rem;display:grid}.rlh-detail-header h2{color:var(--rlh-text-color);text-align:center;white-space:nowrap;text-overflow:ellipsis;min-width:0;margin:0;padding-inline:.5rem;font-size:1.1rem;font-weight:600;overflow:hidden}.rlh-detail-header .rlh-back-to-list-btn{justify-self:start}.rlh-detail-header .rlh-item-controls{justify-self:end;align-items:center;gap:.4rem;display:inline-flex}.rlh-detail-content,.rlh-entry-list-wrapper{flex-direction:column;gap:.4rem;display:flex}.rlh-entry-list-wrapper .rlh-item-container{animation:.3s ease-out both rlhFadeListItem}@keyframes rlhFadeListItem{0%{opacity:0;transform:translateY(6px)scale(.95)}to{opacity:1;transform:translateY(0)scale(1)}}.rlh-regex-list{flex-direction:column;gap:.45rem;display:flex;position:relative}.rlh-regex-list.sorting-active{border:1.5px dashed var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-regex-list.sorting-active{border:1.5px dashed color-mix(in srgb,var(--rlh-accent-color)55%,transparent)}}.rlh-regex-list.sorting-active{box-shadow:0 0 0 3px var(--rlh-accent-color),0 20px 50px -30px var(--rlh-shadow-color);border-radius:14px;padding:.35rem .45rem}@supports (color:color-mix(in lab, red, red)){.rlh-regex-list.sorting-active{box-shadow:0 0 0 3px color-mix(in srgb,var(--rlh-accent-color)12%,transparent),0 20px 50px -30px var(--rlh-shadow-color)}}.rlh-regex-list.sorting-active{background:var(--rlh-hover-bg)}@supports (color:color-mix(in lab, red, red)){.rlh-regex-list.sorting-active{background:color-mix(in srgb,var(--rlh-hover-bg)45%,transparent)}}.rlh-regex-list.sorting-active .rlh-item-container{border-radius:12px}.rlh-regex-list .sortable-ghost{opacity:.2;transform:scale(.98)}.rlh-regex-list .sortable-chosen{box-shadow:0 18px 40px -28px var(--rlh-shadow-color);transform:rotate(.4deg)}.rlh-sorting-fallback{opacity:.7!important;transform:scale(1.02)!important}.rlh-entry-list-wrapper>*{margin:0}.rlh-order-indicator{background-color:var(--rlh-hover-bg);min-width:1.75rem;color:var(--rlh-accent-color);border-radius:9999px;justify-content:center;align-items:center;padding:.1rem .5rem;font-size:max(.8125rem,13px);font-weight:600;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-order-indicator{color:color-mix(in srgb,var(--rlh-accent-color)70%,var(--rlh-text-color))}}.rlh-selection-control{justify-content:center;align-items:center;margin-right:.35rem;display:inline-flex}.rlh-selection-control input{cursor:pointer;width:1rem;height:1rem;accent-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-selection-control input{accent-color:color-mix(in srgb,var(--rlh-accent-color)85%,transparent)}}.rlh-drag-handle{color:var(--rlh-em-color);justify-content:center;align-items:center;margin-right:.35rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-drag-handle{color:color-mix(in srgb,var(--rlh-em-color)80%,transparent)}}.rlh-drag-handle{cursor:grab}.rlh-drag-handle:active{cursor:grabbing}.rlh-editor-group{border-top:1px solid var(--rlh-border-color);flex-direction:column;gap:.6rem;padding:.75rem 0;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-editor-group{border-top:1px solid color-mix(in srgb,var(--rlh-border-color)55%,transparent)}}.rlh-editor-group:first-of-type{border-top:none;padding-top:0}.rlh-editor-group h5{color:var(--rlh-em-color);font-size:.85rem;font-weight:600}@supports (color:color-mix(in lab, red, red)){.rlh-editor-group h5{color:color-mix(in srgb,var(--rlh-em-color)80%,transparent)}}.rlh-editor-grid{grid-template-columns:repeat(auto-fit,minmax(14rem,1fr));gap:.6rem;display:grid}.rlh-grid-item,.rlh-depth-container{flex-direction:column;gap:.4rem;display:flex}.rlh-depth-inputs{flex-wrap:wrap;gap:.6rem;display:flex}.rlh-editor-options-row{flex-wrap:wrap;gap:.4rem;display:flex}.rlh-editor-option-item{background-color:var(--rlh-hover-bg);border-radius:9999px;align-items:center;gap:.35rem;padding:.35rem .65rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-editor-option-item{background-color:color-mix(in srgb,var(--rlh-hover-bg)55%,transparent)}}.rlh-editor-option-item{color:var(--rlh-em-color);font-size:.85rem}.rlh-editor-option-item input{accent-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-editor-option-item input{accent-color:color-mix(in srgb,var(--rlh-accent-color)85%,transparent)}}.rlh-select-nudge{min-width:8rem}.rlh-rename-ui{width:100%}.rlh-rename-input-wrapper{border:1px solid var(--rlh-border-color);border-radius:12px;align-items:center;gap:.4rem;width:100%;padding:.4rem .6rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-rename-input-wrapper{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-rename-input-wrapper{background-color:var(--rlh-input-bg)}.rlh-rename-input{color:var(--rlh-text-color);background:0 0;border:none;outline:none;flex:1;font-size:.9rem}.rlh-rename-input::placeholder{color:var(--rlh-em-color)}@supports (color:color-mix(in lab, red, red)){.rlh-rename-input::placeholder{color:color-mix(in srgb,var(--rlh-em-color)75%,transparent)}}.rlh-rename-save-btn{color:var(--rlh-green);border-color:var(--rlh-green)}@supports (color:color-mix(in lab, red, red)){.rlh-rename-save-btn{border-color:color-mix(in srgb,var(--rlh-green)55%,transparent)}}.rlh-rename-cancel-btn{color:var(--rlh-red);border-color:var(--rlh-red)}@supports (color:color-mix(in lab, red, red)){.rlh-rename-cancel-btn{border-color:color-mix(in srgb,var(--rlh-red)55%,transparent)}}.rlh-global-toggle,.rlh-item-toggle{transition:background-color .2s,border-color .2s,color .2s}.rlh-book-group.enabled .rlh-global-toggle,.rlh-item-container.enabled .rlh-item-toggle{color:var(--rlh-green);border-color:var(--rlh-green)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.enabled .rlh-global-toggle,.rlh-item-container.enabled .rlh-item-toggle{border-color:color-mix(in srgb,var(--rlh-green)65%,transparent)}}.rlh-book-group.enabled .rlh-global-toggle,.rlh-item-container.enabled .rlh-item-toggle{background-color:var(--rlh-green-bg)}.rlh-clickable-header{cursor:pointer}#regex-lore-hub-panel.rlh-multi-select-mode .rlh-shell{border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.rlh-multi-select-mode .rlh-shell{border-color:color-mix(in srgb,var(--rlh-accent-color)45%,transparent)}}#regex-lore-hub-panel.rlh-multi-select-mode .rlh-shell{box-shadow:0 36px 120px -60px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.rlh-multi-select-mode .rlh-shell{box-shadow:0 36px 120px -60px color-mix(in srgb,var(--rlh-accent-color)30%,transparent)}}#regex-lore-hub-panel.rlh-multi-select-mode .rlh-selection-count{color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.rlh-multi-select-mode .rlh-selection-count{color:color-mix(in srgb,var(--rlh-accent-color)65%,transparent)}}#regex-lore-hub-panel.rlh-multi-select-mode .rlh-selection-count{font-size:max(.8125rem,13px)}.rlh-book-group.editing-entries,.rlh-book-group.renaming,.rlh-item-container.renaming{box-shadow:0 0 0 2px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.editing-entries,.rlh-book-group.renaming,.rlh-item-container.renaming{box-shadow:0 0 0 2px color-mix(in srgb,var(--rlh-accent-color)35%,transparent)}}.rlh-book-group.editing-entries,.rlh-book-group.renaming,.rlh-item-container.renaming{border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.editing-entries,.rlh-book-group.renaming,.rlh-item-container.renaming{border-color:color-mix(in srgb,var(--rlh-accent-color)45%,transparent)}}.rlh-item-container.rlh-collapsed .rlh-item-header,.rlh-book-group.rlh-collapsed .rlh-global-book-header{background-color:var(--rlh-hover-bg)}@supports (color:color-mix(in lab, red, red)){.rlh-item-container.rlh-collapsed .rlh-item-header,.rlh-book-group.rlh-collapsed .rlh-global-book-header{background-color:color-mix(in srgb,var(--rlh-hover-bg)45%,transparent)}}.sortable-ghost{opacity:.75;background-color:var(--rlh-selected-bg)}@supports (color:color-mix(in lab, red, red)){.sortable-ghost{background-color:color-mix(in srgb,var(--rlh-selected-bg)85%,transparent)}}.sortable-ghost{border:1px dashed var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.sortable-ghost{border:1px dashed color-mix(in srgb,var(--rlh-accent-color)55%,transparent)}}.rlh-search-controls{flex-wrap:wrap;align-items:center;gap:.7rem;display:flex}#rlh-search-input,.rlh-search-input,#rlh-replace-input,.rlh-replace-input{border:1px solid var(--rlh-border-color);border-radius:12px;width:100%;min-width:0;padding:.4rem .6rem}@supports (color:color-mix(in lab, red, red)){#rlh-search-input,.rlh-search-input,#rlh-replace-input,.rlh-replace-input{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}#rlh-search-input,.rlh-search-input,#rlh-replace-input,.rlh-replace-input{background-color:var(--rlh-input-bg);color:var(--rlh-text-color);font-size:1rem;transition:border-color .2s,box-shadow .2s}#rlh-search-input:focus,.rlh-search-input:focus,#rlh-replace-input:focus,.rlh-replace-input:focus{border-color:var(--rlh-accent-color);outline:none}@supports (color:color-mix(in lab, red, red)){#rlh-search-input:focus,.rlh-search-input:focus,#rlh-replace-input:focus,.rlh-replace-input:focus{border-color:color-mix(in srgb,var(--rlh-accent-color)70%,transparent)}}#rlh-search-input:focus,.rlh-search-input:focus,#rlh-replace-input:focus,.rlh-replace-input:focus{box-shadow:var(--rlh-focus-ring)}#rlh-search-input::placeholder,.rlh-search-input::placeholder,#rlh-replace-input::placeholder,.rlh-replace-input::placeholder{color:var(--rlh-em-color)}@supports (color:color-mix(in lab, red, red)){#rlh-search-input::placeholder,.rlh-search-input::placeholder,#rlh-replace-input::placeholder,.rlh-replace-input::placeholder{color:color-mix(in srgb,var(--rlh-em-color)70%,transparent)}}.rlh-multi-select-module{flex-direction:column;align-items:flex-start;gap:.25rem;display:flex}.rlh-search-action-btn,.rlh-multi-select-action-btn{border:1px solid var(--rlh-border-color);border-radius:10px;justify-content:center;align-items:center;gap:.2rem;padding:.3rem .5rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-search-action-btn,.rlh-multi-select-action-btn{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-search-action-btn,.rlh-multi-select-action-btn{color:var(--rlh-text-color);cursor:pointer;background:0 0;font-size:.78rem;line-height:1;transition:color .2s,background-color .2s,border-color .2s,transform .2s}.rlh-multi-select-action-btn:active{transform:scale(.95)}.rlh-search-action-btn:hover,.rlh-multi-select-action-btn:hover{background-color:var(--rlh-hover-bg);border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-search-action-btn:hover,.rlh-multi-select-action-btn:hover{border-color:color-mix(in srgb,var(--rlh-accent-color)45%,transparent)}}.rlh-multi-select-actions{flex-wrap:nowrap;align-items:center;gap:.3rem;display:inline-flex}.rlh-multi-select-action-btn.enable{color:var(--rlh-green);border-color:var(--rlh-green)}@supports (color:color-mix(in lab, red, red)){.rlh-multi-select-action-btn.enable{border-color:color-mix(in srgb,var(--rlh-green)60%,transparent)}}.rlh-multi-select-action-btn.enable{background-color:var(--rlh-green-bg)}.rlh-multi-select-action-btn.disable{color:var(--rlh-red);border-color:var(--rlh-red)}@supports (color:color-mix(in lab, red, red)){.rlh-multi-select-action-btn.disable{border-color:color-mix(in srgb,var(--rlh-red)60%,transparent)}}.rlh-multi-select-action-btn.disable{background-color:var(--rlh-red-bg)}#rlh-search-filters-container,.rlh-filter-list{flex-wrap:wrap;gap:.6rem;display:flex}.rlh-filter-item{background-color:var(--rlh-hover-bg);border-radius:9999px;align-items:center;gap:.4rem;padding:.4rem .65rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-filter-item{background-color:color-mix(in srgb,var(--rlh-hover-bg)65%,transparent)}}.rlh-filter-item{color:var(--rlh-em-color);font-size:.85rem}.rlh-filter-item input{accent-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-filter-item input{accent-color:color-mix(in srgb,var(--rlh-accent-color)85%,transparent)}}#rlh-multi-select-controls{align-items:center;gap:.35rem;display:none}#rlh-multi-select-controls.active{flex-wrap:wrap;display:flex}@media (max-width:960px){.rlh-multi-select-module{align-items:stretch;gap:.35rem}#rlh-multi-select-controls{flex-wrap:wrap;justify-content:flex-start;align-items:flex-start}.rlh-multi-select-actions{flex-wrap:wrap;justify-content:flex-start}}.rlh-content-pane{-webkit-overflow-scrolling:touch;scrollbar-gutter:stable both-edges;flex-direction:column;flex:auto;gap:1rem;min-height:0;padding-right:.25rem;display:flex;overflow:hidden auto}#regex-lore-hub-panel-content{-webkit-overflow-scrolling:touch;scrollbar-gutter:stable both-edges;scroll-behavior:smooth;flex:auto;min-height:clamp(18rem,48vh,32rem);padding-right:clamp(.25rem,.8vw,.5rem);display:block;overflow:hidden auto}#regex-lore-hub-panel-content>*+*{margin-top:clamp(.8rem,1.4vw,1.1rem)}#regex-lore-hub-panel-content::-webkit-scrollbar{width:6px}#regex-lore-hub-panel-content::-webkit-scrollbar-thumb{background-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel-content::-webkit-scrollbar-thumb{background-color:color-mix(in srgb,var(--rlh-accent-color)35%,transparent)}}#regex-lore-hub-panel-content::-webkit-scrollbar-thumb{border-radius:9999px}.rlh-book-group,.rlh-item-container{border:1px solid var(--rlh-border-color);border-radius:16px;flex-direction:column;min-height:0;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-book-group,.rlh-item-container{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-book-group,.rlh-item-container{background-color:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group,.rlh-item-container{background-color:color-mix(in srgb,var(--rlh-surface-color)94%,transparent)}}.rlh-book-group,.rlh-item-container{box-shadow:0 18px 50px -40px var(--rlh-shadow-color);overflow:hidden}.rlh-book-group-header{justify-content:center;align-items:center;padding:.85rem 1rem;display:flex;position:relative}.rlh-book-group-title{color:var(--rlh-text-color);text-align:center;white-space:nowrap;text-overflow:ellipsis;max-width:calc(100% - 8rem);margin:0;font-size:1.1rem;font-weight:600;overflow:hidden}.rlh-book-group-header .rlh-item-controls{align-items:center;gap:.4rem;display:inline-flex;position:absolute;top:50%;right:1rem;transform:translateY(-50%)}.rlh-global-book-header,.rlh-item-header{cursor:pointer;justify-content:flex-start;align-items:center;gap:.6rem;padding:.85rem 1rem;transition:background-color .2s,border-color .2s;display:flex}.rlh-global-book-header{flex-wrap:wrap;align-items:flex-start}.rlh-global-book-header .rlh-book-title-wrapper{flex:auto;min-width:0}.rlh-global-book-header .rlh-item-name{white-space:normal;word-break:break-word;flex:0 auto;min-width:0}.rlh-global-book-header .rlh-book-stats{white-space:nowrap}.rlh-global-book-header .rlh-item-controls{flex:none;margin-top:.1rem;margin-left:auto}.rlh-global-book-header.enabled{color:var(--rlh-text-color)}@supports (color:color-mix(in lab, red, red)){.rlh-global-book-header.enabled{color:color-mix(in srgb,var(--rlh-text-color)70%,var(--rlh-accent-color)30%)}}.rlh-global-book-header.enabled{background:linear-gradient(135deg,var(--rlh-accent-color)0%,var(--rlh-accent-color)100%)}@supports (color:color-mix(in lab, red, red)){.rlh-global-book-header.enabled{background:linear-gradient(135deg,color-mix(in srgb,var(--rlh-accent-color)32%,var(--rlh-surface-color))0%,color-mix(in srgb,var(--rlh-accent-color)18%,var(--rlh-surface-color))100%)}}.rlh-global-book-header.enabled{box-shadow:0 18px 45px -30px var(--rlh-accent-color),inset 0 0 0 1px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-global-book-header.enabled{box-shadow:0 18px 45px -30px color-mix(in srgb,var(--rlh-accent-color)50%,transparent),inset 0 0 0 1px color-mix(in srgb,var(--rlh-accent-color)45%,transparent)}}.rlh-global-book-header.enabled .rlh-item-name{color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-global-book-header.enabled .rlh-item-name{color:color-mix(in srgb,var(--rlh-accent-color)85%,var(--rlh-text-color))}}.rlh-global-book-header.enabled .rlh-book-stats{color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-global-book-header.enabled .rlh-book-stats{color:color-mix(in srgb,var(--rlh-accent-color)70%,var(--rlh-em-color))}}.rlh-global-book-header.enabled:hover{background:linear-gradient(135deg,var(--rlh-accent-color)0%,var(--rlh-accent-color)100%)}@supports (color:color-mix(in lab, red, red)){.rlh-global-book-header.enabled:hover{background:linear-gradient(135deg,color-mix(in srgb,var(--rlh-accent-color)38%,var(--rlh-surface-color))0%,color-mix(in srgb,var(--rlh-accent-color)22%,var(--rlh-surface-color))100%)}}.rlh-global-book-header:hover,.rlh-item-header:hover{background-color:var(--rlh-hover-bg)}.rlh-item-header-main{flex:auto;align-items:center;gap:.5rem;min-width:0;display:flex}.rlh-item-title-row{flex-wrap:wrap;align-items:center;gap:.45rem;display:inline-flex}.rlh-status-badge{--badge-color:var(--rlh-accent-color);letter-spacing:.01em;background:var(--badge-color);border-radius:999px;align-items:center;gap:.35rem;padding:.15rem .55rem;font-size:.75rem;font-weight:600;line-height:1;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-status-badge{background:color-mix(in srgb,var(--badge-color)18%,transparent)}}.rlh-status-badge{color:var(--badge-color)}@supports (color:color-mix(in lab, red, red)){.rlh-status-badge{color:color-mix(in srgb,var(--badge-color)80%,white 5%)}}.rlh-status-badge{white-space:nowrap}.rlh-status-badge i{font-size:.55rem}.rlh-status-badge__text{display:inline-block;transform:translateY(.5px)}.rlh-status-badge--constant{--badge-color:var(--rlh-status-constant)}.rlh-status-badge--selective{--badge-color:var(--rlh-status-selective)}.rlh-status-badge--vectorized{--badge-color:var(--rlh-status-vectorized)}.rlh-item-name{color:var(--rlh-text-color);flex-shrink:0;font-size:.95rem;font-weight:500}@media (max-width:720px){.rlh-item-header{flex-wrap:wrap;align-items:flex-start;gap:.45rem;padding:.7rem .75rem}.rlh-item-header-main{flex-direction:column;align-items:flex-start;gap:.3rem;width:100%}.rlh-item-name{text-overflow:ellipsis;white-space:nowrap;flex:auto;min-width:0;max-width:100%;overflow:hidden}.rlh-book-group-header{justify-content:flex-start;align-items:flex-start}.rlh-book-group-title{text-align:left;width:100%;max-width:100%}.rlh-item-controls{flex-direction:row;justify-content:flex-end;align-self:flex-start;align-items:center;gap:.18rem;width:auto}.rlh-item-controls .rlh-toggle-btn,.rlh-item-controls .rlh-action-btn-icon{border-width:1px;border-radius:.6rem;width:1.55rem;height:1.55rem;padding:0}.rlh-item-controls .rlh-toggle-btn i,.rlh-item-controls .rlh-action-btn-icon i{font-size:max(.8125rem,13px)}.rlh-detail-header .rlh-item-controls{justify-self:flex-end}.rlh-book-group-header .rlh-item-controls{justify-content:flex-end;align-items:center;margin-top:.25rem;margin-left:auto;position:static;transform:none}.rlh-item-meta{gap:.25rem;font-size:.74rem}.rlh-item-meta-chip{gap:.2rem;padding:.12rem .45rem}}.rlh-item-meta{color:var(--rlh-em-color);flex-wrap:wrap;align-items:center;gap:.35rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-item-meta{color:color-mix(in srgb,var(--rlh-em-color)92%,transparent)}}.rlh-item-meta{font-size:.78rem}.rlh-item-meta-chip{background:var(--rlh-hover-bg);border-radius:9999px;align-items:center;gap:.25rem;padding:.15rem .55rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-item-meta-chip{background:color-mix(in srgb,var(--rlh-hover-bg)70%,transparent)}}.rlh-item-meta-chip{border:1px solid var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-item-meta-chip{border:1px solid color-mix(in srgb,var(--rlh-border-color)50%,transparent)}}.rlh-item-meta-chip{line-height:1.2}.rlh-item-meta-chip i{color:var(--rlh-accent-color);font-size:.7rem}@supports (color:color-mix(in lab, red, red)){.rlh-item-meta-chip i{color:color-mix(in srgb,var(--rlh-accent-color)75%,var(--rlh-em-color))}}#regex-lore-hub-panel.dark .rlh-item-meta-chip{background:var(--rlh-hover-bg)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-item-meta-chip{background:color-mix(in srgb,var(--rlh-hover-bg)55%,transparent)}}#regex-lore-hub-panel.dark .rlh-item-meta-chip{border-color:var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-item-meta-chip{border-color:color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}.rlh-item-controls{flex-wrap:wrap;align-items:center;gap:.35rem;margin-left:auto;display:inline-flex}.rlh-item-controls .rlh-toggle-btn,.rlh-item-controls .rlh-action-btn-icon{flex-shrink:0}@media (max-width:960px){.rlh-item-controls{gap:.28rem}.rlh-item-controls .rlh-toggle-btn,.rlh-item-controls .rlh-action-btn-icon{width:2rem;height:2rem}}@media (max-width:900px) and (min-width:721px){.rlh-item-controls{flex-direction:column;align-items:flex-end;gap:.22rem;width:auto}.rlh-item-controls .rlh-toggle-btn,.rlh-item-controls .rlh-action-btn-icon{width:1.75rem;height:1.75rem}.rlh-item-name{flex:auto;min-width:0;max-width:100%}}.rlh-toggle-btn,.rlh-action-btn-icon{border:1px solid var(--rlh-border-color);border-radius:9999px;justify-content:center;align-items:center;width:2.25rem;height:2.25rem;display:inline-flex}@supports (color:color-mix(in lab, red, red)){.rlh-toggle-btn,.rlh-action-btn-icon{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-toggle-btn,.rlh-action-btn-icon{color:var(--rlh-em-color);cursor:pointer;background:0 0;transition:color .2s,background-color .2s,border-color .2s,transform .2s}.rlh-toggle-btn:hover,.rlh-action-btn-icon:hover{background-color:var(--rlh-hover-bg);color:var(--rlh-text-color);border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-toggle-btn:hover,.rlh-action-btn-icon:hover{border-color:color-mix(in srgb,var(--rlh-accent-color)45%,transparent)}}.rlh-toggle-btn:hover,.rlh-action-btn-icon:hover{transform:translateY(-1px)scale(1.03)}.rlh-item-container.enabled .rlh-item-name,.rlh-book-group.enabled .rlh-item-name{color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-item-container.enabled .rlh-item-name,.rlh-book-group.enabled .rlh-item-name{color:color-mix(in srgb,var(--rlh-accent-color)80%,var(--rlh-text-color))}}.rlh-collapsible-content{border-top:1px solid var(--rlh-border-color);margin-top:.75rem;padding:0 1rem 1rem;display:none}@supports (color:color-mix(in lab, red, red)){.rlh-collapsible-content{border-top:1px solid color-mix(in srgb,var(--rlh-border-color)55%,transparent)}}.rlh-collapsible-content{background-color:var(--rlh-surface-color)}@supports (color:color-mix(in lab, red, red)){.rlh-collapsible-content{background-color:color-mix(in srgb,var(--rlh-surface-color)90%,transparent)}}.rlh-entry-actions{border-bottom:1px dashed var(--rlh-border-color);flex-wrap:wrap;gap:.6rem;padding:.9rem 1rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-entry-actions{border-bottom:1px dashed color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}.rlh-action-btn{background-color:var(--rlh-accent-color);color:#fff;cursor:pointer;border:none;border-radius:12px;justify-content:center;align-items:center;gap:.4rem;padding:.55rem 1rem;font-size:.9rem;font-weight:500;transition:transform .2s,opacity .2s;display:inline-flex}.rlh-action-btn:hover{opacity:.9}.rlh-action-btn.rlh-maximize-btn{border:1px solid var(--rlh-em-color);background:0 0}@supports (color:color-mix(in lab, red, red)){.rlh-action-btn.rlh-maximize-btn{border:1px solid color-mix(in srgb,var(--rlh-em-color)45%,transparent)}}.rlh-action-btn.rlh-maximize-btn{color:var(--rlh-em-color)}.rlh-editor-wrapper{flex-direction:column;gap:1rem;display:flex}.rlh-editor-field{flex-direction:column;gap:.35rem;display:flex}.rlh-editor-field label{background-color:var(--rlh-header-bg);padding:.55rem .85rem;display:block}@supports (color:color-mix(in lab, red, red)){.rlh-editor-field label{background-color:color-mix(in srgb,var(--rlh-header-bg)82%,transparent)}}.rlh-editor-field label{border-bottom:1px solid var(--rlh-border-color);border-radius:12px 12px 0 0}@supports (color:color-mix(in lab, red, red)){.rlh-editor-field label{border-bottom:1px solid color-mix(in srgb,var(--rlh-border-color)68%,transparent)}}.rlh-editor-field label{color:var(--rlh-text-color);margin:0;font-size:.875rem;font-weight:600;line-height:1.3}.rlh-editor-field label+*{border-top-left-radius:0;border-top-right-radius:0;margin-top:0}.rlh-viewer-field{gap:0}.rlh-regex-viewer{grid-template-columns:repeat(auto-fit,minmax(14rem,1fr));gap:.75rem;display:grid}.rlh-regex-viewer>.rlh-editor-field:nth-child(-n+2){grid-column:1/-1}.rlh-entry-viewer{flex-direction:column;gap:.75rem;display:flex}.rlh-viewer-field label{background-color:var(--rlh-hover-bg)}@supports (color:color-mix(in lab, red, red)){.rlh-viewer-field label{background-color:color-mix(in srgb,var(--rlh-hover-bg)60%,transparent)}}.rlh-viewer-field label{border-bottom-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-viewer-field label{border-bottom-color:color-mix(in srgb,var(--rlh-accent-color)28%,transparent)}}.rlh-viewer-text{border:1px solid var(--rlh-border-color);padding:.6rem .85rem}@supports (color:color-mix(in lab, red, red)){.rlh-viewer-text{border:1px solid color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}.rlh-viewer-text{background-color:var(--rlh-input-bg);color:var(--rlh-text-color);white-space:pre-wrap;border-top:none;border-radius:0 0 12px 12px;line-height:1.5}.rlh-viewer-text>article{margin:0}.rlh-editor-field .rlh-edit-content,.rlh-editor-field article{border-top:none;border-radius:0 0 12px 12px;margin-top:0}#regex-lore-hub-panel.dark .rlh-editor-field label{background-color:var(--rlh-header-bg)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-editor-field label{background-color:color-mix(in srgb,var(--rlh-header-bg)70%,transparent)}}#regex-lore-hub-panel.dark .rlh-editor-field label{border-bottom-color:var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-editor-field label{border-bottom-color:color-mix(in srgb,var(--rlh-border-color)60%,transparent)}}#regex-lore-hub-panel.dark .rlh-viewer-field label{background-color:var(--rlh-hover-bg)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-viewer-field label{background-color:color-mix(in srgb,var(--rlh-hover-bg)70%,transparent)}}#regex-lore-hub-panel.dark .rlh-viewer-field label{border-bottom-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-viewer-field label{border-bottom-color:color-mix(in srgb,var(--rlh-accent-color)32%,transparent)}}#regex-lore-hub-panel.dark .rlh-viewer-text{border-color:var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-viewer-text{border-color:color-mix(in srgb,var(--rlh-border-color)50%,transparent)}}#regex-lore-hub-panel.dark .rlh-viewer-text{background-color:var(--rlh-input-bg)}@supports (color:color-mix(in lab, red, red)){#regex-lore-hub-panel.dark .rlh-viewer-text{background-color:color-mix(in srgb,var(--rlh-input-bg)90%,transparent)}}#regex-lore-hub-panel.dark .rlh-viewer-text{border-top:none}.rlh-editor-field input[type=text],.rlh-editor-field textarea,.rlh-editor-field select{border:1px solid var(--rlh-border-color);border-radius:12px;width:100%;padding:.55rem .75rem}@supports (color:color-mix(in lab, red, red)){.rlh-editor-field input[type=text],.rlh-editor-field textarea,.rlh-editor-field select{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-editor-field input[type=text],.rlh-editor-field textarea,.rlh-editor-field select{background-color:var(--rlh-input-bg);color:var(--rlh-text-color);transition:border-color .2s,box-shadow .2s}.rlh-editor-field label+:is(input,textarea,select){border-top:none;border-radius:0 0 12px 12px}.rlh-editor-field textarea{resize:vertical;min-height:8rem}.rlh-editor-field input:focus,.rlh-editor-field textarea:focus,.rlh-editor-field select:focus{border-color:var(--rlh-accent-color);outline:none}@supports (color:color-mix(in lab, red, red)){.rlh-editor-field input:focus,.rlh-editor-field textarea:focus,.rlh-editor-field select:focus{border-color:color-mix(in srgb,var(--rlh-accent-color)70%,transparent)}}.rlh-editor-field input:focus,.rlh-editor-field textarea:focus,.rlh-editor-field select:focus{box-shadow:var(--rlh-focus-ring)}.rlh-toast-notification,.rlh-progress-toast{background-color:var(--rlh-accent-color);color:#fff;box-shadow:0 24px 120px -40px var(--rlh-shadow-color);opacity:0;pointer-events:none;z-index:10002;border-radius:9999px;padding:.9rem 1.3rem;font-size:.9rem;font-weight:500;transition:opacity .25s,transform .25s;position:fixed;bottom:clamp(1rem,4vw,2rem);left:50%;transform:translate(-50%)translateY(20px)}.rlh-progress-toast{background-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-progress-toast{background-color:color-mix(in srgb,var(--rlh-accent-color)70%,transparent)}}.rlh-toast-notification.visible,.rlh-progress-toast.visible{opacity:1;animation:.38s cubic-bezier(.3,.7,.4,1.1) both rlhToastIn;transform:translate(-50%)translateY(0)}.rlh-modal-overlay{z-index:10003;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);background:#0206178c;justify-content:center;align-items:center;display:flex;position:fixed;inset:0}.rlh-modal-content{background:var(--rlh-surface-color);border:1px solid var(--rlh-border-color);width:min(420px,90%);box-shadow:0 30px 120px -60px var(--rlh-shadow-color);border-radius:16px;margin:auto;overflow:hidden}.rlh-modal-header{border-bottom:1px solid var(--rlh-border-color);padding:1rem 1.25rem;font-weight:600}@supports (color:color-mix(in lab, red, red)){.rlh-modal-header{border-bottom:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-modal-body{color:var(--rlh-em-color);flex-direction:column;gap:.6rem;padding:1.1rem 1.25rem;display:flex}.rlh-modal-footer{border-top:1px solid var(--rlh-border-color);justify-content:flex-end;gap:.6rem;padding:.9rem 1.25rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-modal-footer{border-top:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-modal-btn{border:1px solid var(--rlh-border-color);border-radius:12px;padding:.55rem 1.1rem}@supports (color:color-mix(in lab, red, red)){.rlh-modal-btn{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-modal-btn{color:var(--rlh-text-color);cursor:pointer;background:0 0;font-weight:500;transition:background-color .2s,border-color .2s}.rlh-modal-btn:hover{background-color:var(--rlh-hover-bg)}.rlh-modal-btn.rlh-modal-ok{background-color:var(--rlh-accent-color);color:#fff;border-color:#0000}.rlh-modal-btn.rlh-modal-cancel{background-color:var(--rlh-red-bg);border-color:var(--rlh-red)}@supports (color:color-mix(in lab, red, red)){.rlh-modal-btn.rlh-modal-cancel{border-color:color-mix(in srgb,var(--rlh-red)60%,transparent)}}.rlh-modal-btn.rlh-modal-cancel{color:var(--rlh-red)}.rlh-loading{background:var(--rlh-surface-color);border-radius:20px;align-items:center;gap:1.25rem;padding:1.4rem 1.6rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-loading{background:color-mix(in srgb,var(--rlh-surface-color)96%,transparent)}}.rlh-loading{border:1px solid var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-loading{border:1px solid color-mix(in srgb,var(--rlh-border-color)55%,transparent)}}.rlh-loading{box-shadow:0 24px 80px -50px var(--rlh-shadow-color)}.rlh-loading-spinner{border:3px solid var(--rlh-em-color);border-radius:9999px;width:2.6rem;height:2.6rem}@supports (color:color-mix(in lab, red, red)){.rlh-loading-spinner{border:3px solid color-mix(in srgb,var(--rlh-em-color)35%,transparent)}}.rlh-loading-spinner{border-top-color:var(--rlh-accent-color);animation:.9s linear infinite rlh-spin}.rlh-loading-text{flex-direction:column;flex:1;gap:.55rem;display:flex}.rlh-loading-title{color:var(--rlh-text-color);font-size:.95rem;font-weight:600}.rlh-loading-status{color:var(--rlh-text-color);font-size:.9rem}.rlh-loading-detail{color:var(--rlh-em-color);font-size:.82rem}@supports (color:color-mix(in lab, red, red)){.rlh-loading-detail{color:color-mix(in srgb,var(--rlh-em-color)85%,transparent)}}.rlh-loading-bar{background:var(--rlh-hover-bg);border-radius:9999px;width:100%;height:.4rem;position:relative}@supports (color:color-mix(in lab, red, red)){.rlh-loading-bar{background:color-mix(in srgb,var(--rlh-hover-bg)75%,transparent)}}.rlh-loading-bar{overflow:hidden}.rlh-loading-bar-inner{background:linear-gradient(90deg,var(--rlh-accent-color),var(--rlh-accent-color));width:0%;height:100%}@supports (color:color-mix(in lab, red, red)){.rlh-loading-bar-inner{background:linear-gradient(90deg,var(--rlh-accent-color),color-mix(in srgb,var(--rlh-accent-color)70%,transparent))}}.rlh-loading-bar-inner{transition:width .3s}.rlh-loading-progress{color:var(--rlh-em-color);font-size:max(.8125rem,13px)}@supports (color:color-mix(in lab, red, red)){.rlh-loading-progress{color:color-mix(in srgb,var(--rlh-em-color)70%,transparent)}}.rlh-menu-icon{width:1.1rem;height:1.1rem;color:var(--rlh-accent-color);justify-content:center;align-items:center;display:inline-flex}@keyframes rlh-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.rlh-edit-content{border:1px solid var(--rlh-border-color);border-radius:0 0 12px 12px;min-height:6rem;padding:.75rem}@supports (color:color-mix(in lab, red, red)){.rlh-edit-content{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-edit-content{background-color:var(--rlh-input-bg);color:var(--rlh-text-color);white-space:pre-wrap}.rlh-error-wrapper{text-align:center;border:1px dashed var(--rlh-red);border-radius:16px;padding:1.5rem}@supports (color:color-mix(in lab, red, red)){.rlh-error-wrapper{border:1px dashed color-mix(in srgb,var(--rlh-red)60%,transparent)}}.rlh-error-wrapper{background-color:var(--rlh-red-bg)}.rlh-error-title{color:var(--rlh-red);margin-bottom:.75rem;font-weight:600}.rlh-error-text{color:var(--rlh-em-color);font-size:.9rem}.rlh-error-retry-btn{border:1px solid var(--rlh-red);color:var(--rlh-red);cursor:pointer;background-color:#0000;border-radius:9999px;margin-top:1rem;padding:.55rem 1.1rem;transition:background-color .2s}.rlh-error-retry-btn:hover{background-color:var(--rlh-red)}@supports (color:color-mix(in lab, red, red)){.rlh-error-retry-btn:hover{background-color:color-mix(in srgb,var(--rlh-red)18%,transparent)}}.rlh-error-retry-btn:hover{color:#fff}.rlh-search-card,.rlh-filters-card{background:var(--rlh-surface-color);border-radius:16px;flex-direction:column;gap:.9rem;padding:1rem 1.1rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-search-card,.rlh-filters-card{background:color-mix(in srgb,var(--rlh-surface-color)92%,transparent)}}.rlh-search-card,.rlh-filters-card{border:1px solid var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-search-card,.rlh-filters-card{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-search-card,.rlh-filters-card{box-shadow:0 20px 60px -40px var(--rlh-shadow-color)}.rlh-section-title{letter-spacing:.08em;text-transform:uppercase;color:var(--rlh-em-color);font-size:max(.8125rem,13px);font-weight:600}@supports (color:color-mix(in lab, red, red)){.rlh-section-title{color:color-mix(in srgb,var(--rlh-em-color)80%,transparent)}}.rlh-toast-notification.success{background-color:var(--rlh-green)}.rlh-toast-notification.error{background-color:var(--rlh-red)}.rlh-toast-notification.info{background-color:var(--rlh-accent-color)}@media (prefers-reduced-motion:reduce){#regex-lore-hub-panel .rlh-shell,.rlh-toolbar-btn:focus-visible{animation:none}.rlh-toast-notification.visible,.rlh-progress-toast.visible{transition:opacity .2s,transform .2s;animation:none}.rlh-toggle-btn:hover,.rlh-action-btn-icon:hover,.rlh-toolbar-btn:hover,.rlh-toggle-btn:hover i,.rlh-action-btn-icon:hover i,.rlh-toolbar-btn:hover i{transform:none}}.rlh-breadcrumbs{align-items:center;gap:.4rem;margin-bottom:.5rem;font-size:.9rem;display:flex}.rlh-breadcrumb-item{color:var(--rlh-em-color);text-decoration:none;transition:color .2s}.rlh-breadcrumb-item:hover{color:var(--rlh-accent-color)}.rlh-breadcrumb-item.active{color:var(--rlh-text-color);pointer-events:none;font-weight:500}.rlh-breadcrumb-separator{color:var(--rlh-em-color)}.rlh-empty-state{text-align:center;background-color:var(--rlh-hover-bg);border-radius:16px;flex-direction:column;justify-content:center;align-items:center;margin-top:1rem;padding:2rem;display:flex}@supports (color:color-mix(in lab, red, red)){.rlh-empty-state{background-color:color-mix(in srgb,var(--rlh-hover-bg)50%,transparent)}}.rlh-empty-state{border:1px dashed var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-empty-state{border:1px dashed color-mix(in srgb,var(--rlh-border-color)80%,transparent)}}.rlh-empty-icon{color:var(--rlh-accent-color);background-color:var(--rlh-selected-bg);border-radius:9999px;justify-content:center;align-items:center;width:4rem;height:4rem;margin-bottom:1rem;font-size:2rem;display:flex}.rlh-empty-state h4{color:var(--rlh-text-color);margin-bottom:.5rem;font-size:1.1rem;font-weight:600}.rlh-empty-state p{color:var(--rlh-em-color);max-width:300px}.rlh-book-group{transition:box-shadow .2s,border-color .2s;position:relative}.rlh-book-group.enabled{border-left:3px solid var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.enabled{border-left:3px solid color-mix(in srgb,var(--rlh-accent-color)80%,transparent)}}.rlh-book-group.enabled{border-color:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.enabled{border-color:color-mix(in srgb,var(--rlh-accent-color)45%,var(--rlh-border-color))}}.rlh-book-group.enabled{background:linear-gradient(160deg,var(--rlh-accent-color)0%,var(--rlh-surface-color)100%)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.enabled{background:linear-gradient(160deg,color-mix(in srgb,var(--rlh-accent-color)20%,var(--rlh-surface-color))0%,color-mix(in srgb,var(--rlh-surface-color)96%,transparent)100%)}}.rlh-book-group.enabled{box-shadow:0 26px 70px -46px var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-group.enabled{box-shadow:0 26px 70px -46px color-mix(in srgb,var(--rlh-accent-color)58%,transparent)}}.rlh-book-title-wrapper{flex-direction:column;flex:1;gap:.2rem;display:flex}.rlh-book-stats{color:var(--rlh-em-color);font-size:max(.8125rem,13px)}.rlh-book-summary{background-color:var(--rlh-hover-bg);padding:.5rem 1rem;font-size:.85rem}@supports (color:color-mix(in lab, red, red)){.rlh-book-summary{background-color:color-mix(in srgb,var(--rlh-hover-bg)40%,transparent)}}.rlh-book-summary{border-top:1px solid var(--rlh-border-color)}@supports (color:color-mix(in lab, red, red)){.rlh-book-summary{border-top:1px solid color-mix(in srgb,var(--rlh-border-color)55%,transparent)}}.rlh-used-by-chars span{background-color:var(--rlh-selected-bg);border-radius:9999px;margin:.1rem;padding:.1rem .5rem;font-size:max(.8125rem,13px);display:inline-block}.rlh-edit-depth,.rlh-edit-order,.rlh-edit-probability,.rlh-edit-depth-min,.rlh-edit-depth-max,.rlh-modal-input{border:1px solid var(--rlh-border-color);border-radius:12px;padding:.45rem .65rem}@supports (color:color-mix(in lab, red, red)){.rlh-edit-depth,.rlh-edit-order,.rlh-edit-probability,.rlh-edit-depth-min,.rlh-edit-depth-max,.rlh-modal-input{border:1px solid color-mix(in srgb,var(--rlh-border-color)65%,transparent)}}.rlh-edit-depth,.rlh-edit-order,.rlh-edit-probability,.rlh-edit-depth-min,.rlh-edit-depth-max,.rlh-modal-input{background-color:var(--rlh-input-bg);color:var(--rlh-text-color)}.rlh-edit-depth:focus,.rlh-edit-order:focus,.rlh-edit-probability:focus,.rlh-edit-depth-min:focus,.rlh-edit-depth-max:focus,.rlh-modal-input:focus{border-color:var(--rlh-accent-color);outline:none}@supports (color:color-mix(in lab, red, red)){.rlh-edit-depth:focus,.rlh-edit-order:focus,.rlh-edit-probability:focus,.rlh-edit-depth-min:focus,.rlh-edit-depth-max:focus,.rlh-modal-input:focus{border-color:color-mix(in srgb,var(--rlh-accent-color)70%,transparent)}}.rlh-edit-depth:focus,.rlh-edit-order:focus,.rlh-edit-probability:focus,.rlh-edit-depth-min:focus,.rlh-edit-depth-max:focus,.rlh-modal-input:focus{box-shadow:var(--rlh-focus-ring)}.rlh-loading{pointer-events:none;opacity:.5;position:relative}.rlh-loading>i{visibility:hidden}.rlh-loading:after{content:\"\";border:2px solid oklch(70.7% .022 261.325);border-top-color:oklch(62.3% .214 259.815);border-radius:50%;width:16px;height:16px;margin-top:-8px;margin-left:-8px;animation:.8s linear infinite rlh-spin;position:absolute;top:50%;left:50%}.rlh-highlight{color:#1f2937;background-color:#facc15;animation:.5s ease-out rlhHighlightPulse}.rlh-replace-confirm-modal{color:var(--rlh-text-color);flex-direction:column;gap:.6rem;display:flex}.rlh-replace-stats{background:var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-replace-stats{background:color-mix(in srgb,var(--rlh-accent-color)6%,transparent)}}.rlh-replace-stats{border:1px solid var(--rlh-accent-color)}@supports (color:color-mix(in lab, red, red)){.rlh-replace-stats{border:1px solid color-mix(in srgb,var(--rlh-accent-color)22%,transparent)}}.rlh-replace-stats{border-radius:10px;padding:.6rem .8rem}.rlh-replace-stats h4{color:var(--rlh-text-color);margin:0 0 .4rem;font-weight:600}.rlh-replace-stats ul{margin:0;padding-left:1.1rem}.rlh-confirm-scroll-list{border:1px solid var(--rlh-border-color);background:var(--rlh-surface-color);border-radius:10px;max-height:12rem;padding:.4rem .25rem;overflow-y:auto}.rlh-confirm-entry-list{margin:0;padding:.25rem .25rem .25rem .5rem;list-style:none}.rlh-confirm-entry-item{border-radius:8px;padding:.35rem .5rem;transition:background-color .15s}.rlh-confirm-entry-item:hover{background:var(--rlh-hover-bg)}.rlh-toolbar-btn:focus-visible,.rlh-icon-button:focus-visible,.rlh-close-button:focus-visible,.rlh-toggle-btn:focus-visible,.rlh-action-btn-icon:focus-visible,.rlh-toolbar-icon-btn:focus-visible{outline-offset:2px;outline:3px solid var(--rlh-accent-color)!important;box-shadow:0 0 0 5px var(--rlh-accent-color)!important}@supports (color:color-mix(in lab, red, red)){.rlh-toolbar-btn:focus-visible,.rlh-icon-button:focus-visible,.rlh-close-button:focus-visible,.rlh-toggle-btn:focus-visible,.rlh-action-btn-icon:focus-visible,.rlh-toolbar-icon-btn:focus-visible{box-shadow:0 0 0 5px color-mix(in srgb,var(--rlh-accent-color)20%,transparent)!important}}input:focus-visible,select:focus-visible,textarea:focus-visible,[contenteditable]:focus-visible{outline:3px solid var(--rlh-accent-color);outline-offset:2px}}.rlh-toolbar-toggle-btn{background-color:var(--rlh-hover-bg);color:var(--rlh-text-color);border:1px solid var(--rlh-border-color);cursor:pointer;border-radius:8px;justify-content:center;align-items:center;padding:.5rem 1rem;transition:background-color .2s,color .2s;display:inline-flex}.rlh-toolbar-toggle-btn:hover{background-color:var(--rlh-selected-bg);color:var(--rlh-accent-color)}#regex-lore-hub-toolbar-shell{transition:max-height .3s ease-in-out}.rlh-toolbar-shell--collapsed{max-height:0;margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0;overflow:hidden}@media (max-width:640px){.rlh-toggle-btn,.rlh-action-btn-icon,.rlh-toolbar-icon-btn,.rlh-icon-button,.rlh-close-button{width:44px;height:44px;padding:.5rem;min-width:44px!important;min-height:44px!important}.rlh-multi-select-action-btn{padding:.6rem .8rem;min-width:44px!important;min-height:44px!important}.rlh-item-controls{gap:.5rem!important}.rlh-item-controls .rlh-toggle-btn,.rlh-item-controls .rlh-action-btn-icon{width:44px!important;height:44px!important}}\n`;var pl=(()=>{try{return new URL(\"../vendor/Sortable.min.js\",import.meta.url).href}catch(e){return console.error(\"[RegexLoreHub] \\u8BA1\\u7B97 SortableJS \\u672C\\u5730\\u8DEF\\u5F84\\u5931\\u8D25\\uFF1A\",e),\"\"}})(),Lt=e=>!e||typeof e!=\"string\"?\"\":e.trim().replace(/\\\\/g,\"/\").replace(/\\/+$/,\"\"),tt=(e,r)=>{let o=Lt(e);if(!o)return\"\";let a=r.replace(/^\\/+/,\"\");return`${o}/${a}`},ul=(e,r)=>{let o=[],a=l=>{if(!l||typeof l!=\"string\")return;let n=l.trim();n&&(o.includes(n)||o.push(n))};a(tt(t.paths?.vendor,\"Sortable.min.js\")),a(tt(t.paths?.rlhRoot,\"vendor/Sortable.min.js\"));try{a(new URL(\"../vendor/Sortable.min.js\",import.meta.url).href)}catch(l){console.warn(\"[RegexLoreHub] \\u57FA\\u4E8E\\u6A21\\u5757\\u8DEF\\u5F84\\u63A8\\u5BFC Sortable \\u8D44\\u6E90\\u5931\\u8D25\\uFF1A\",l)}try{e&&e.querySelectorAll(\"script[src]\").forEach(n=>{let i=n.getAttribute(\"src\");if(!(!i||!/regex[-_]lore[-_]hub/i.test(i)))try{let b=new URL(i,r?.location?.href||window.location.href),m=Lt(b.href.replace(/\\/[^/]*$/,\"\"));a(tt(m,\"vendor/Sortable.min.js\")),a(tt(m,\"src/vendor/Sortable.min.js\"))}catch(b){console.warn(\"[RegexLoreHub] \\u5BBF\\u4E3B\\u811A\\u672C\\u8DEF\\u5F84\\u63A8\\u5BFC\\u5931\\u8D25\\uFF1A\",b)}})}catch(l){console.warn(\"[RegexLoreHub] \\u904D\\u5386\\u5BBF\\u4E3B\\u811A\\u672C\\u8282\\u70B9\\u5931\\u8D25\\uFF1A\",l)}return a(pl),a(\"https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js\"),o.filter(Boolean)};function wo(e){let r=ce(),o=be(),a=_e(),l=e();function n(){let m=o.getElementById(`${ue}-styles`);if(m){m.textContent=Et;return}let u=o.createElement(\"style\");u.id=`${ue}-styles`,u.textContent=Et,o.head.appendChild(u)}function i(m){if(t.isDragSortDisabled=!1,a.Sortable){if(typeof m==\"function\")try{m()}catch(S){console.error(\"[RegexLoreHub] \\u521D\\u59CB\\u5316\\u56DE\\u8C03\\u6267\\u884C\\u5931\\u8D25\\uFF1A\",S)}return}let u=!1,h=()=>{if(!u&&(u=!0,typeof m==\"function\"))try{m()}catch(S){console.error(\"[RegexLoreHub] \\u521D\\u59CB\\u5316\\u56DE\\u8C03\\u6267\\u884C\\u5931\\u8D25\\uFF1A\",S)}},f=ul(o,a),w=S=>{if(!o){t.isDragSortDisabled=!0,console.error(\"[RegexLoreHub] \\u65E0\\u6CD5\\u52A0\\u8F7D SortableJS\\uFF1A\\u5BBF\\u4E3B\\u6587\\u6863\\u4E0D\\u53EF\\u8BBF\\u95EE\\u3002\",S),h();return}let x=f.length?`\\u5C1D\\u8BD5\\u8DEF\\u5F84\\uFF1A${f.join(\", \")}`:\"\\u672A\\u627E\\u5230\\u53EF\\u7528\\u5019\\u9009\\u8DEF\\u5F84\\u3002\";(async()=>{if(typeof(a.fetch||window.fetch)!=\"function\")throw S||new Error(\"fetch not available\");let s=a.fetch?a.fetch.bind(a):window.fetch.bind(window),v=(()=>{try{return new URL(\"../vendor/Sortable.min.js\",import.meta.url).href}catch(T){return console.warn(\"[RegexLoreHub] \\u5185\\u8054\\u56DE\\u9000\\u8DEF\\u5F84\\u89E3\\u6790\\u5931\\u8D25\\uFF1A\",T),\"\"}})()||f[0]||\"\";if(!v)throw S||new Error(\"missing inline url\");let k=await s(v,{cache:\"no-cache\"});if(!k.ok)throw new Error(`HTTP ${k.status} ${k.statusText}`);let A=await k.text(),M=o.createElement(\"script\");M.textContent=A,o.head.appendChild(M),console.warn(\"[RegexLoreHub] SortableJS \\u5DF2\\u901A\\u8FC7\\u5185\\u8054\\u6A21\\u5F0F\\u52A0\\u8F7D\\u3002\"),t.isDragSortDisabled=!1,h()})().catch(s=>{t.isDragSortDisabled=!0,console.error(\"[RegexLoreHub] Failed to load SortableJS.\",s??S),X({type:\"alert\",title:\"\\u9519\\u8BEF\",text:`\\u65E0\\u6CD5\\u52A0\\u8F7D\\u62D6\\u62FD\\u6392\\u5E8F\\u5E93\\uFF0C\\u8BF7\\u68C0\\u67E5\\u8D44\\u6E90\\u8DEF\\u5F84\\u914D\\u7F6E\\u3002${x}`}).catch(()=>{}),h()}).finally(()=>{})};if(!f.length){w(new Error(\"Sortable candidate URLs not found.\"));return}let E=S=>{if(S>=f.length){w(new Error(\"All Sortable candidates failed.\"));return}let x=f[S],N=a.document.createElement(\"script\");N.src=x,N.dataset.rlhSortableCandidate=String(S),N.onload=()=>{t.isDragSortDisabled=!1,console.log(\"[RegexLoreHub] SortableJS loaded successfully.\",x),t.paths=t.paths||{},t.paths.vendor=Lt(x.replace(/\\/Sortable\\.min\\.js(?:\\?.*)?$/,\"\")),t.paths.rlhRoot=t.paths.vendor?.replace(/\\/vendor$/,\"\")||t.paths.rlhRoot||\"\",h()},N.onerror=s=>{N.remove(),console.warn(\"[RegexLoreHub] SortableJS \\u52A0\\u8F7D\\u5931\\u8D25\\uFF0C\\u5C1D\\u8BD5\\u4E0B\\u4E00\\u4E2A\\u5019\\u9009\\u3002\",x,s?.error),E(S+1)},a.document.head.appendChild(N)};E(0)}function b(){if(console.log(\"[RegexLoreHub] Initializing UI and button...\"),r(`#${ue}`,o).length>0){console.log(\"[RegexLoreHub] Panel already exists. Skipping UI creation.\");return}n();let m=`\n      <div id=\"${ue}\">\n\n        <div class=\"rlh-shell\">\n\n          <header class=\"rlh-shell-header\">\n\n            <div class=\"rlh-shell-title\">\n\n              <h4>${nt}</h4>\n\n              <p class=\"rlh-shell-meta\"><span class=\"rlh-shell-version\">v3.1</span><span class=\"rlh-shell-dot\">\\xB7</span><span class=\"rlh-shell-updated\">\\u66F4\\u65B0\\u4E8E 2025 \\u5E74 10 \\u6708 19 \\u65E5</span></p>\n\n            </div>\n\n            <div class=\"rlh-shell-right\">\n\n              <div id=\"${Pr}\" class=\"rlh-prefetch-indicator\" data-visible=\"false\" aria-hidden=\"true\">\n\n                <div id=\"${zr}\" class=\"rlh-prefetch-text\" aria-live=\"polite\">\\u540E\\u53F0\\u52A0\\u8F7D\\u4E16\\u754C\\u4E66 (0/0)\\uFF0C\\u4E0D\\u5F71\\u54CD\\u5176\\u4ED6\\u64CD\\u4F5C</div>\n\n                <div class=\"rlh-prefetch-bar\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\">\n\n                  <span id=\"${Fr}\" class=\"rlh-prefetch-bar-inner\"></span>\n\n                </div>\n\n              </div>\n\n              <button type=\"button\" id=\"${We.TOGGLE_TOOLBAR_BTN}\" class=\"rlh-toolbar-toggle-btn\" title=\"\\u6298\\u53E0\\u5DE5\\u5177\\u680F\" aria-controls=\"${We.TOOLBAR_SHELL}\" aria-expanded=\"true\">\\u6298\\u53E0\\u5DE5\\u5177\\u680F</button>\n\n              <div class=\"rlh-shell-actions\">\n\n                <button type=\"button\" id=\"${Er}\" class=\"rlh-icon-button rlh-refresh-button\" title=\"\\u5237\\u65B0\\u6570\\u636E\">\n\n                  <i class=\"fa-solid fa-arrows-rotate\"></i>\n\n                </button>\n\n                <button type=\"button\" id=\"${it}\" class=\"rlh-icon-button rlh-close-button\" title=\"\\u5173\\u95ED\\u9762\\u677F\">\n\n                  <i class=\"fa-solid fa-xmark\"></i>\n\n                </button>\n\n              </div>\n\n            </div>\n\n          </header>\n\n\n\n\n\n          <nav class=\"rlh-tab-nav\">\n\n            <div class=\"rlh-tab active\" data-tab=\"global-lore\"><span class=\"rlh-tab-text-full\">\\u5168\\u5C40\\u4E16\\u754C\\u4E66</span><span class=\"rlh-tab-text-short\">\\u5168\\u5C40\\u4E66</span></div>\n\n            <div class=\"rlh-tab\" data-tab=\"char-lore\"><span class=\"rlh-tab-text-full\">\\u89D2\\u8272\\u4E16\\u754C\\u4E66</span><span class=\"rlh-tab-text-short\">\\u89D2\\u8272\\u4E66</span></div>\n\n            <div class=\"rlh-tab\" data-tab=\"chat-lore\"><span class=\"rlh-tab-text-full\">\\u804A\\u5929\\u4E16\\u754C\\u4E66</span><span class=\"rlh-tab-text-short\">\\u804A\\u5929\\u4E66</span></div>\n\n            <div class=\"rlh-tab\" data-tab=\"global-regex\"><span class=\"rlh-tab-text-full\">\\u5168\\u5C40\\u6B63\\u5219</span><span class=\"rlh-tab-text-short\">\\u5168\\u5C40\\u6B63\\u5219</span></div>\n\n            <div class=\"rlh-tab\" data-tab=\"char-regex\"><span class=\"rlh-tab-text-full\">\\u89D2\\u8272\\u6B63\\u5219</span><span class=\"rlh-tab-text-short\">\\u89D2\\u8272\\u6B63\\u5219</span></div>\n\n          </nav>\n\n          <div id=\"${We.TOOLBAR_SHELL}\" class=\"rlh-toolbar-shell\">\n\n            <div id=\"${Lr}\" class=\"rlh-toolbar-container\"></div>\n\n            <div id=\"${Cr}\" class=\"rlh-replace-container\"></div>\n\n          </div>\n\n          <div class=\"rlh-content-pane\">\n\n            <div id=\"${ue}-content\"></div>\n\n          </div>\n\n          <footer class=\"rlh-shell-footer\">\n\n            <div id=\"regex-lore-hub-save-status\" class=\"rlh-save-status\"></div>\n\n          </footer>\n\n        </div>\n\n      </div>`;r(\"body\",o).append(m);let u=`<div id=\"${Je}\" class=\"list-group-item flex-container flexGap5 interactable\" title=\"${nt}\"><span class=\"rlh-menu-icon\"><i class=\"fa-solid fa-layer-group\"></i></span><span>${Rt}</span></div>`,h=r(\"#extensionsMenu\",o);h.find(`#${Je}`).length===0&&(h.append(u),console.log(`[RegexLoreHub] Button #${Je} appended to #extensionsMenu.`));let f=r(`#${ue}`,o);if(f.addClass(\"dark\"),r(\"body\",o).off(\".rlh\").on(\"click.rlh\",`#${Je}`,l.togglePanel),f.off(\".rlh\").on(\"click.rlh\",`#${it}`,l.togglePanel).on(\"click.rlh\",\".rlh-tab\",l.switchTab).on(\"click.rlh\",\".rlh-item-header, .rlh-global-book-header\",l.handleHeaderClick).on(\"click.rlh\",\".rlh-item-container\",l.handleMultiSelectContainerClick).on(\"click.rlh\",\".rlh-book-group\",l.handleMultiSelectContainerClick).on(\"click.rlh\",\".rlh-back-to-list-btn\",l.handleExitLorebookDetail).on(\"click.rlh\",\".rlh-toggle-btn\",l.handleToggleState).on(\"click.rlh\",\".rlh-refresh-detail-btn\",l.handleRefreshLorebookDetail).on(\"click.rlh\",\".rlh-entry-edit-btn\",l.handleEntryEnterEdit).on(\"click.rlh\",\".rlh-entry-view-btn\",l.handleEntryExitEdit).on(\"click.rlh\",\".rlh-regex-edit-btn\",l.handleRegexEnterEdit).on(\"click.rlh\",\".rlh-regex-view-btn\",l.handleRegexExitEdit).on(\"keydown.rlh\",`#${er}`,l.handleSearchInputKeydown).on(\"click.rlh\",\"#rlh-search-clear-btn\",l.handleSearchClear).on(\"input.rlh\",`#${er}, #${br}`,l.handleGlobalSearch).on(\"change.rlh\",\"#rlh-search-filters-container input\",le).on(\"change.rlh\",`#${Hr}`,l.handleCharacterBookSwitch).on(\"click.rlh\",`#${mr}`,l.handleToolbarToggleCollapse).on(\"click.rlh\",`#${rr}`,l.handleSortMenuToggle).on(\"click.rlh\",\".rlh-sort-option\",l.handleSortOptionSelect).on(\"click.rlh\",`#${qe}`,l.handlePositionMenuToggle).on(\"click.rlh\",\".rlh-position-option\",l.handlePositionOptionSelect).on(\"click.rlh\",`#${tr}`,l.handleUnifiedStatusMenuToggle).on(\"click.rlh\",\".rlh-unified-status-option\",l.handleUnifiedStatusOptionSelect).on(\"change.rlh\",\".rlh-multi-select-checkbox\",l.handleSelectionCheckboxChange).on(\"click.rlh\",`#${Er}`,l.handleRefresh).on(\"click.rlh\",\"#rlh-multi-select-btn\",l.toggleMultiSelectMode).on(\"click.rlh\",\"#rlh-select-all-btn\",l.handleSelectAll).on(\"click.rlh\",\"#rlh-select-none-btn\",l.handleSelectNone).on(\"click.rlh\",\"#rlh-select-invert-btn\",l.handleSelectInvert).on(\"click.rlh\",\"#rlh-batch-enable-btn\",l.handleBatchEnable).on(\"click.rlh\",\"#rlh-batch-disable-btn\",l.handleBatchDisable).on(\"click.rlh\",\"#rlh-batch-delete-btn\",l.handleBatchDelete).on(\"click.rlh\",\".rlh-clean-orphan-books-btn\",l.handleCleanOrphanLorebooks).on(\"click.rlh\",`#${Ur}`,l.handlePrimaryCreateButtonClick).on(\"click.rlh\",\".rlh-rename-book-btn\",l.handleRenameBook).on(\"click.rlh\",\".rlh-edit-entries-btn\",l.handleEditEntriesToggle).on(\"click.rlh\",\".rlh-delete-book-btn\",l.handleDeleteLorebook).on(\"click.rlh\",\".rlh-create-entry-btn\",l.handleCreateEntry).on(\"click.rlh\",\"#regex-lore-hub-create-lorebook-btn\",l.handleCreateLorebook).on(\"click.rlh\",\".rlh-delete-entry-btn\",l.handleDeleteEntry).on(\"click.rlh\",\".rlh-batch-recursion-btn\",l.handleBatchSetRecursion).on(\"click.rlh\",\".rlh-fix-keywords-btn\",l.handleFixKeywords).on(\"click.rlh\",\".rlh-rename-btn\",l.handleRename).on(\"click.rlh\",\".rlh-rename-save-btn\",l.handleConfirmRename).on(\"keydown.rlh\",\".rlh-rename-input\",l.handleRenameKeydown).on(\"change.rlh\",\".rlh-edit-position\",l.handlePositionChange).on(\"click.rlh\",\"#rlh-create-chat-lore-btn\",l.handleCreateChatLorebook).on(\"click.rlh\",\".rlh-unlink-chat-lore-btn\",l.handleUnlinkChatLorebook).on(\"click.rlh\",`#${We.TOGGLE_TOOLBAR_BTN}`,vo).on(\"click.rlh\",\"#rlh-replace-btn\",l.handleReplace),t.isToolbarCollapsed){r(`#${We.TOOLBAR_SHELL}`,o).addClass(\"rlh-toolbar-shell--collapsed\");let S=r(`#${We.TOGGLE_TOOLBAR_BTN}`,o);S.length&&S.text(\"\\u5C55\\u5F00\\u5DE5\\u5177\\u680F\").attr(\"aria-expanded\",\"false\").attr(\"title\",\"\\u5C55\\u5F00\\u5DE5\\u5177\\u680F\")}console.log(\"[RegexLoreHub] All UI and events initialized.\"),ze()}i(b)}var Ct=null,Tt=null;function bl(e,r){Ct=e,Tt=r}function ce(){if(Ct)return Ct;let e=window.parent||window;return e?.jQuery?e.jQuery:null}function ge(){if(Tt)return Tt;let e=window.parent||window;return e?.TavernHelper?e.TavernHelper:null}function ml(e){let r=\"#extensionsMenu\",a=0;console.log(`[RegexLoreHub] Starting readiness check. Polling for DOM element \"${r}\" AND core APIs (TavernHelper, jQuery).`);let l=setInterval(()=>{let n=window.parent?.document,i=window.parent,b=!!n&&n.querySelector(r)!==null,m=!!(i&&i.TavernHelper)&&typeof i.TavernHelper.getCharData==\"function\"&&!!i.jQuery;if(b&&m){clearInterval(l),console.log(`[RegexLoreHub] SUCCESS: Both DOM (\"${r}\") and Core APIs are ready. Initializing script.`);try{let u=e(i.jQuery,i.TavernHelper);u?.catch&&u.catch(h=>{console.error(\"[RegexLoreHub] FATAL: Error during main callback execution.\",h)})}catch(u){console.error(\"[RegexLoreHub] FATAL: Error during main callback execution.\",u)}}else a++,a>100&&(clearInterval(l),console.error(\"[RegexLoreHub] FATAL: Readiness check timed out.\"),b||console.error(`[RegexLoreHub] -> Failure: DOM element \"${r}\" not found.`),m||console.error(`[RegexLoreHub] -> Failure: Core APIs not available. TavernHelper: ${!!i?.TavernHelper}, jQuery: ${!!i?.jQuery}`))},150)}async function fl(e,r){bl(e,r);try{await wo(ko)}catch(o){console.error(\"[RegexLoreHub] FATAL: Failed to bootstrap application.\",o)}}ml(fl);\n//# sourceMappingURL=bundle.js.map\n",
  "info": "",
  "buttons": [],
  "data": {}
}
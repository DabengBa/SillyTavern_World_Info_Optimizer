这是一个为 [SillyTavern](https://github.com/SillyTavern/SillyTavern) 量身打造的增强版脚本，需要预先安装 [JS-Slash-Runner](https://github.com/N0VI028/JS-Slash-Runner) 扩展。它通过一个独立的、功能强大的面板，让你能在一个界面中掌控全局、角色乃至当前聊天的所有世界书与正则表达式。

本脚本由在 [DISCO](https://discord.com/channels/1291925535324110879/1389953145035296858/1393474010511048764) 社区网友分享版本的基础上，进行了大量的交互重构与功能增强，旨在解决用户在管理大量条目时的核心痛点。

---

## 🚀 v2.6 版本核心亮点

最新版本围绕 **“交互体验”** 和 **“功能完整性”** 进行了全面升级，让管理工作流更加顺畅自然。

- ✨ **交互重构，告别误触**：引入“编辑条目”模式，彻底分离“选择书”与“选择条目”的操作，逻辑更清晰。
- 📖 **新增聊天世界书支持**：现在可以为每个聊天会话创建、绑定和管理专属世界书，实现更精细的上下文控制。
- 🗑️ **批量删除再进化**：多选模式下不仅能删世界书，还能精确到删除单个或多个条目，清理工作从未如此轻松。
- 🛠️ **健壮性大幅提升**：修复了在未加载角色或聊天时打开面板可能导致崩溃的严重问题，使用更安心。
- 🎨 **UI/UX 持续优化**：为耗时操作增加了进度条，统一了界面元素，优化了视觉反馈，体验更上一层楼。

---

## 📋 功能一览表 (🆕in V2.6)

| 功能分类 | 具体功能 | 状态 |
| --- | --- | --- |
| **世界书管理** | 创建、删除、重命名世界书 | ✅ 完整支持 |
| | 世界书使用者追踪显示 | ✅ 完整支持 |
| | 批量启用/禁用世界书 | ✅ 完整支持 |
| | 世界书条目编辑 | ✅ 完整支持 |
| | **聊天世界书支持**(与当前聊天绑定的世界书) | 🆕 **完整支持** |
| **正则管理** | 正则表达式编辑 | ✅ 完整支持 |
| | 执行顺序可视化 | 🆕 新增功能 |
| | 拖拽调整顺序 | 🆕 新增功能 |
| | 与默认管理器一致性 | 🆕 新增功能 |
| **批量操作** | 多选模式 | ✅ 完整支持 |
| | 批量启用/禁用 | ✅ 完整支持 |
| | **批量删除书/条目** | 🆕 **功能增强** |
| | 一键开启防递归 | ✅ 完整支持 |
| | 一键修复关键词 | ✅ 完整支持 |
| **界面体验** | 浅色/深色主题支持 | 🆕 优化完善 |
| | 搜索与过滤 | ✅ 完整支持 |
| | 实时数据同步 | ✅ 完整支持 |

---

## 🔥 核心功能详解

### 1. 统一管理面板

在一个清爽的面板中，通过标签页轻松切换和管理五种核心资源：
- **全局世界书**
- **角色世界书**
- **聊天世界书 (新增!)**
- **全局正则表达式**
- **角色正则表达式**

![image-20250812170047041](assets/image-20250812170047041.png)

### 2. 强大的编辑与过滤

- **即时搜索**：全局搜索框，快速定位任何项目。
- **组合过滤**：针对世界书，可按“书名”、“条目名”、“关键词”、“内容”组合筛选。
- **完整编辑**：创建、重命名、删除世界书/条目，所有条目选项（插入位置、权重、激活逻辑等）均可在线编辑。
- **一键开关**：即时切换世界书、条目或正则的启用状态。

### 3. 批量操作，效率翻倍

进入 **多选模式**，即可解锁强大的批量处理能力：
- **批量启用/禁用**
- **批量删除 (支持世界书和条目混合选择)**

![image-20250812170237628](assets/image-20250812170237628.png)

### 4. 世界书专属增强

- 🔄 **智能重命名**：重命名世界书时，自动更新所有角色卡、全局设置和聊天中的绑定关系，安全无忧。
- 🔗 **使用者追踪**：清晰列出每本全局世界书被哪些角色使用，方便清理和维护。
- 🔧 **一键工具箱**：
    - **[全开防递]**：一键为书中所有条目开启“防止递归”。
    - **[修复关键词]**：一键将所有中文逗号 `，` 替换为英文逗号 `,`，确保触发无误。

![image-20250812170346924](assets/image-20250812170346924.png)

### 5. 正则表达式顺序管理

- #️⃣ **顺序可视化**：与SillyTavern默认管理器完全一致的顺序显示（#1, #2...）。
- ↕️ **拖拽排序**：通过拖拽即可调整正则表达式的执行优先级。

![image-20250812170400185](assets/image-20250812170400185.png)

### 6. 完美的UI体验

- 🎨 **主题兼容**：完美适配浅色与深色主题，修复了原版在浅色主题下的显示问题。
- 🛡️ **样式隔离**：CSS作用域严格限制，绝不污染酒馆其他界面。

---

## 🛠️ 安装与使用

### 方法1: 导入Release中的Json文件 (推荐)

1. 确保您的酒馆安装了 [JS-Slash-Runner](https://github.com/N0VI028/JS-Slash-Runner) 扩展。
2. 前往本项目的 Releases 页面下载最新的 `.json` 文件。
   ![image-20250804154445387](assets/image-20250804154445387.png)
3. 在SillyTavern的“扩展”界面中，找到“JS-Slash-Runner”，点击“导入脚本”。
   ![image-20250804154836205](assets/image-20250804154836205.png)4. 选择下载的 `.json` 文件，并确保脚本类型为 **“全局脚本”**。
5. 激活脚本，然后刷新浏览器。
   ![image-20250804154953630](assets/image-20250804154953630.png)
6. 点击右上角的魔术棒图标，即可找到并打开【世界书＆正则便捷管理】。
   ![image-20250716145103026](assets/image-20250716145103026.png)

### 方法2: 直接复制源代码

1.  确保您的酒馆安装了 [JS-Slash-Runner](https://github.com/N0VI028/JS-Slash-Runner)。
2.  在“JS-Slash-Runner”的设置页面下，点击“添加新脚本”。
    ![image-20250716144907304](assets/image-20250716144907304.png)
3.  为脚本起一个名字（例如 `WI_Optimizer`），将 `WI_Optimizer.js` 文件的全部内容复制进去，然后保存。
    ![image-20250716145018978](assets/image-20250716145018978.png)
4.  激活脚本，刷新浏览器，即可在魔术棒菜单中使用。

---

## 📜 更新日志

### v2.6 Bug修复与体验优化 (最新)
- 🔧 **关键Bug修复**: 修复了在“全局正则”和“角色正则”标签页中，批量删除功能无法正常工作的问题。现在可以正确地批量删除正则表达式了。
- 🎨 **提示信息优化**: 改进了批量删除时的确认提示信息，使其能准确反映将要删除的项目类型（世界书、条目、正则）。
- 🔍 **搜索功能增强**: 在世界书搜索过滤器中新增“内容”选项，用户现在可以按条目内容进行搜索。

### v2.5 交互重构与功能完善
- 🆕 **聊天世界书 (Chat Lore)**: 添加了对聊天专用世界书的全面支持，包括创建、绑定、解绑和重命名。
- 🚀 **批量删除增强**: 多选模式下现在不仅可以删除整个世界书，还可以精确选择并删除单个条目。
- ✨ **核心交互重构**: 引入“编辑条目”模式，彻底分离了“选择世界书”和“选择条目”的操作，解决了点击混淆问题。
- 🔧 **健壮性修复**: 修复了在未加载角色或聊天时打开面板可能导致脚本崩溃的严重问题。
- 🎨 **UI/UX 优化**: 为长时间运行的操作（如批量删除）添加了进度条反馈，统一了所有视图中条目的删除按钮，优化了选中项的视觉高亮效果。

### v2.0 增强版
- 🔧 **功能修复**：修复了世界书重命名功能中的一个错误。
- 🆕 **正则顺序管理**：添加执行顺序可视化和拖拽调整功能。
- 🆕 **世界书重命名**：支持世界书重命名并自动维护绑定关系。
- 🆕 **主题兼容性**：修复浅色主题显示问题，避免影响酒馆其他界面。
- 🔧 **顺序一致性**：确保正则显示顺序与 SillyTavern 默认管理器完全一致。
- 🎨 **视觉优化**：添加执行顺序标识符，改善禁用状态显示效果。

### v1.0 基础版
- ✅ 世界书使用者追踪
- ✅ 批量操作功能
- ✅ 一键开启防递归
- ✅ 关键词修复功能
- ✅ 多选模式
- ✅ 搜索与过滤

---

## 🤝 贡献与反馈

如果您在使用过程中遇到问题或有改进建议，欢迎：
- 提交 Issue 报告问题
- 提交 Pull Request 贡献代码
- 在社区中分享使用心得

## 许可证

AGPL-3.0